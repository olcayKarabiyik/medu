{"remainingRequest":"/wiki/node_modules/babel-loader/lib/index.js??ref--0-1!/wiki/node_modules/webpack-modernizr-loader/index.js!/wiki/client/.modernizrrc.js","dependencies":[{"path":"/wiki/client/.modernizrrc.js","mtime":1716084843839},{"path":"/wiki/.babelrc","mtime":1716084843827},{"path":"/wiki/node_modules/cache-loader/dist/cjs.js","mtime":1716088090639},{"path":"/wiki/node_modules/babel-loader/lib/index.js","mtime":1716088089693},{"path":"/wiki/node_modules/webpack-modernizr-loader/index.js","mtime":1716088158525}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:OwoKKGZ1bmN0aW9uICh3aW5kb3cpIHsKICB2YXIgaGFkR2xvYmFsID0gKCdNb2Rlcm5penInIGluIHdpbmRvdyk7CiAgdmFyIG9sZEdsb2JhbCA9IHdpbmRvdy5Nb2Rlcm5penI7CiAgLyohCiAgKiBtb2Rlcm5penIgdjMuMTEuMgogICogQnVpbGQgaHR0cHM6Ly9tb2Rlcm5penIuY29tL2Rvd25sb2FkPy1iYWNrZHJvcGZpbHRlci1zZXRjbGFzc2VzLWRvbnRtaW4tY3NzY2xhc3NwcmVmaXg6bWR6LQogICoKICAqIENvcHlyaWdodCAoYykKICAqICBGYXJ1ayBBdGVzCiAgKiAgUGF1bCBJcmlzaAogICogIEFsZXggU2V4dG9uCiAgKiAgUnlhbiBTZWRkb24KICAqICBQYXRyaWNrIEtldHRuZXIKICAqICBTdHUgQ294CiAgKiAgUmljaGFyZCBIZXJyZXJhCiAgKiAgVmVlY2sKICAqIE1JVCBMaWNlbnNlCiAgKi8KCiAgLyoKICAgKiBNb2Rlcm5penIgdGVzdHMgd2hpY2ggbmF0aXZlIENTUzMgYW5kIEhUTUw1IGZlYXR1cmVzIGFyZSBhdmFpbGFibGUgaW4gdGhlCiAgICogY3VycmVudCBVQSBhbmQgbWFrZXMgdGhlIHJlc3VsdHMgYXZhaWxhYmxlIHRvIHlvdSBpbiB0d28gd2F5czogYXMgcHJvcGVydGllcyBvbgogICAqIGEgZ2xvYmFsIGBNb2Rlcm5penJgIG9iamVjdCwgYW5kIGFzIGNsYXNzZXMgb24gdGhlIGA8aHRtbD5gIGVsZW1lbnQuIFRoaXMKICAgKiBpbmZvcm1hdGlvbiBhbGxvd3MgeW91IHRvIHByb2dyZXNzaXZlbHkgZW5oYW5jZSB5b3VyIHBhZ2VzIHdpdGggYSBncmFudWxhciBsZXZlbAogICAqIG9mIGNvbnRyb2wgb3ZlciB0aGUgZXhwZXJpZW5jZS4KICAqLwoKICA7CgogIChmdW5jdGlvbiAoc2NyaXB0R2xvYmFsT2JqZWN0LCB3aW5kb3csIGRvY3VtZW50LCB1bmRlZmluZWQpIHsKICAgIHZhciB0ZXN0cyA9IFtdOwogICAgLyoqCiAgICAgKiBNb2Rlcm5penJQcm90byBpcyB0aGUgY29uc3RydWN0b3IgZm9yIE1vZGVybml6cgogICAgICoKICAgICAqIEBjbGFzcwogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqLwoKICAgIHZhciBNb2Rlcm5penJQcm90byA9IHsKICAgICAgLy8gVGhlIGN1cnJlbnQgdmVyc2lvbiwgZHVtbXkKICAgICAgX3ZlcnNpb246ICczLjExLjInLAogICAgICAvLyBBbnkgc2V0dGluZ3MgdGhhdCBkb24ndCB3b3JrIGFzIHNlcGFyYXRlIG1vZHVsZXMKICAgICAgLy8gY2FuIGdvIGluIGhlcmUgYXMgY29uZmlndXJhdGlvbi4KICAgICAgX2NvbmZpZzogewogICAgICAgICdjbGFzc1ByZWZpeCc6ICdtZHotJywKICAgICAgICAnZW5hYmxlQ2xhc3Nlcyc6IHRydWUsCiAgICAgICAgJ2VuYWJsZUpTQ2xhc3MnOiB0cnVlLAogICAgICAgICd1c2VQcmVmaXhlcyc6IHRydWUKICAgICAgfSwKICAgICAgLy8gUXVldWUgb2YgdGVzdHMKICAgICAgX3E6IFtdLAogICAgICAvLyBTdHViIHRoZXNlIGZvciBwZW9wbGUgd2hvIGFyZSBsaXN0ZW5pbmcKICAgICAgb246IGZ1bmN0aW9uICh0ZXN0LCBjYikgewogICAgICAgIC8vIEkgZG9uJ3QgcmVhbGx5IHRoaW5rIHBlb3BsZSBzaG91bGQgZG8gdGhpcywgYnV0IHdlIGNhbgogICAgICAgIC8vIHNhZmUgZ3VhcmQgaXQgYSBiaXQuCiAgICAgICAgLy8gLS0gTk9URTo6IHRoaXMgZ2V0cyBXQVkgb3ZlcnJpZGRlbiBpbiBzcmMvYWRkVGVzdCBmb3IgYWN0dWFsIGFzeW5jIHRlc3RzLgogICAgICAgIC8vIFRoaXMgaXMgaW4gY2FzZSBwZW9wbGUgbGlzdGVuIHRvIHN5bmNocm9ub3VzIHRlc3RzLiBJIHdvdWxkIGxlYXZlIGl0IG91dCwKICAgICAgICAvLyBidXQgdGhlIGNvZGUgdG8gKmRpc2FsbG93KiBzeW5jIHRlc3RzIGluIHRoZSByZWFsIHZlcnNpb24gb2YgdGhpcwogICAgICAgIC8vIGZ1bmN0aW9uIGlzIGFjdHVhbGx5IGxhcmdlciB0aGFuIHRoaXMuCiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgY2Ioc2VsZlt0ZXN0XSk7CiAgICAgICAgfSwgMCk7CiAgICAgIH0sCiAgICAgIGFkZFRlc3Q6IGZ1bmN0aW9uIChuYW1lLCBmbiwgb3B0aW9ucykgewogICAgICAgIHRlc3RzLnB1c2goewogICAgICAgICAgbmFtZTogbmFtZSwKICAgICAgICAgIGZuOiBmbiwKICAgICAgICAgIG9wdGlvbnM6IG9wdGlvbnMKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgYWRkQXN5bmNUZXN0OiBmdW5jdGlvbiAoZm4pIHsKICAgICAgICB0ZXN0cy5wdXNoKHsKICAgICAgICAgIG5hbWU6IG51bGwsCiAgICAgICAgICBmbjogZm4KICAgICAgICB9KTsKICAgICAgfQogICAgfTsgLy8gRmFrZSBzb21lIG9mIE9iamVjdC5jcmVhdGUgc28gd2UgY2FuIGZvcmNlIG5vbiB0ZXN0IHJlc3VsdHMgdG8gYmUgbm9uICJvd24iIHByb3BlcnRpZXMuCgogICAgdmFyIE1vZGVybml6ciA9IGZ1bmN0aW9uICgpIHt9OwoKICAgIE1vZGVybml6ci5wcm90b3R5cGUgPSBNb2Rlcm5penJQcm90bzsgLy8gTGVhayBtb2Rlcm5penIgZ2xvYmFsbHkgd2hlbiB5b3UgYHJlcXVpcmVgIGl0IHJhdGhlciB0aGFuIGZvcmNlIGl0IGhlcmUuCiAgICAvLyBPdmVyd3JpdGUgbmFtZSBzbyBjb25zdHJ1Y3RvciBuYW1lIGlzIG5pY2VyIDpECgogICAgTW9kZXJuaXpyID0gbmV3IE1vZGVybml6cigpOwogICAgdmFyIGNsYXNzZXMgPSBbXTsKICAgIC8qKgogICAgICogaXMgcmV0dXJucyBhIGJvb2xlYW4gaWYgdGhlIHR5cGVvZiBhbiBvYmogaXMgZXhhY3RseSB0eXBlLgogICAgICoKICAgICAqIEBhY2Nlc3MgcHJpdmF0ZQogICAgICogQGZ1bmN0aW9uIGlzCiAgICAgKiBAcGFyYW0geyp9IG9iaiAtIEEgdGhpbmcgd2Ugd2FudCB0byBjaGVjayB0aGUgdHlwZSBvZgogICAgICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgLSBBIHN0cmluZyB0byBjb21wYXJlIHRoZSB0eXBlb2YgYWdhaW5zdAogICAgICogQHJldHVybnMge2Jvb2xlYW59IHRydWUgaWYgdGhlIHR5cGVvZiB0aGUgZmlyc3QgcGFyYW1ldGVyIGlzIGV4YWN0bHkgdGhlIHNwZWNpZmllZCB0eXBlLCBmYWxzZSBvdGhlcndpc2UKICAgICAqLwoKICAgIGZ1bmN0aW9uIGlzKG9iaiwgdHlwZSkgewogICAgICByZXR1cm4gdHlwZW9mIG9iaiA9PT0gdHlwZTsKICAgIH0KCiAgICA7CiAgICAvKioKICAgICAqIFJ1biB0aHJvdWdoIGFsbCB0ZXN0cyBhbmQgZGV0ZWN0IHRoZWlyIHN1cHBvcnQgaW4gdGhlIGN1cnJlbnQgVUEuCiAgICAgKgogICAgICogQGFjY2VzcyBwcml2YXRlCiAgICAgKiBAcmV0dXJucyB7dm9pZH0KICAgICAqLwoKICAgIGZ1bmN0aW9uIHRlc3RSdW5uZXIoKSB7CiAgICAgIHZhciBmZWF0dXJlTmFtZXM7CiAgICAgIHZhciBmZWF0dXJlOwogICAgICB2YXIgYWxpYXNJZHg7CiAgICAgIHZhciByZXN1bHQ7CiAgICAgIHZhciBuYW1lSWR4OwogICAgICB2YXIgZmVhdHVyZU5hbWU7CiAgICAgIHZhciBmZWF0dXJlTmFtZVNwbGl0OwoKICAgICAgZm9yICh2YXIgZmVhdHVyZUlkeCBpbiB0ZXN0cykgewogICAgICAgIGlmICh0ZXN0cy5oYXNPd25Qcm9wZXJ0eShmZWF0dXJlSWR4KSkgewogICAgICAgICAgZmVhdHVyZU5hbWVzID0gW107CiAgICAgICAgICBmZWF0dXJlID0gdGVzdHNbZmVhdHVyZUlkeF07IC8vIHJ1biB0aGUgdGVzdCwgdGhyb3cgdGhlIHJldHVybiB2YWx1ZSBpbnRvIHRoZSBNb2Rlcm5penIsCiAgICAgICAgICAvLyB0aGVuIGJhc2VkIG9uIHRoYXQgYm9vbGVhbiwgZGVmaW5lIGFuIGFwcHJvcHJpYXRlIGNsYXNzTmFtZQogICAgICAgICAgLy8gYW5kIHB1c2ggaXQgaW50byBhbiBhcnJheSBvZiBjbGFzc2VzIHdlJ2xsIGpvaW4gbGF0ZXIuCiAgICAgICAgICAvLwogICAgICAgICAgLy8gSWYgdGhlcmUgaXMgbm8gbmFtZSwgaXQncyBhbiAnYXN5bmMnIHRlc3QgdGhhdCBpcyBydW4sCiAgICAgICAgICAvLyBidXQgbm90IGRpcmVjdGx5IGFkZGVkIHRvIHRoZSBvYmplY3QuIFRoYXQgc2hvdWxkCiAgICAgICAgICAvLyBiZSBkb25lIHdpdGggYSBwb3N0LXJ1biBhZGRUZXN0IGNhbGwuCgogICAgICAgICAgaWYgKGZlYXR1cmUubmFtZSkgewogICAgICAgICAgICBmZWF0dXJlTmFtZXMucHVzaChmZWF0dXJlLm5hbWUudG9Mb3dlckNhc2UoKSk7CgogICAgICAgICAgICBpZiAoZmVhdHVyZS5vcHRpb25zICYmIGZlYXR1cmUub3B0aW9ucy5hbGlhc2VzICYmIGZlYXR1cmUub3B0aW9ucy5hbGlhc2VzLmxlbmd0aCkgewogICAgICAgICAgICAgIC8vIEFkZCBhbGwgdGhlIGFsaWFzZXMgaW50byB0aGUgbmFtZXMgbGlzdAogICAgICAgICAgICAgIGZvciAoYWxpYXNJZHggPSAwOyBhbGlhc0lkeCA8IGZlYXR1cmUub3B0aW9ucy5hbGlhc2VzLmxlbmd0aDsgYWxpYXNJZHgrKykgewogICAgICAgICAgICAgICAgZmVhdHVyZU5hbWVzLnB1c2goZmVhdHVyZS5vcHRpb25zLmFsaWFzZXNbYWxpYXNJZHhdLnRvTG93ZXJDYXNlKCkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSAvLyBSdW4gdGhlIHRlc3QsIG9yIHVzZSB0aGUgcmF3IHZhbHVlIGlmIGl0J3Mgbm90IGEgZnVuY3Rpb24KCgogICAgICAgICAgcmVzdWx0ID0gaXMoZmVhdHVyZS5mbiwgJ2Z1bmN0aW9uJykgPyBmZWF0dXJlLmZuKCkgOiBmZWF0dXJlLmZuOyAvLyBTZXQgZWFjaCBvZiB0aGUgbmFtZXMgb24gdGhlIE1vZGVybml6ciBvYmplY3QKCiAgICAgICAgICBmb3IgKG5hbWVJZHggPSAwOyBuYW1lSWR4IDwgZmVhdHVyZU5hbWVzLmxlbmd0aDsgbmFtZUlkeCsrKSB7CiAgICAgICAgICAgIGZlYXR1cmVOYW1lID0gZmVhdHVyZU5hbWVzW25hbWVJZHhdOyAvLyBTdXBwb3J0IGRvdCBwcm9wZXJ0aWVzIGFzIHN1YiB0ZXN0cy4gV2UgZG9uJ3QgZG8gY2hlY2tpbmcgdG8gbWFrZSBzdXJlCiAgICAgICAgICAgIC8vIHRoYXQgdGhlIGltcGxpZWQgcGFyZW50IHRlc3RzIGhhdmUgYmVlbiBhZGRlZC4gWW91IG11c3QgY2FsbCB0aGVtIGluCiAgICAgICAgICAgIC8vIG9yZGVyIChlaXRoZXIgaW4gdGhlIHRlc3QsIG9yIG1ha2UgdGhlIHBhcmVudCB0ZXN0IGEgZGVwZW5kZW5jeSkuCiAgICAgICAgICAgIC8vCiAgICAgICAgICAgIC8vIENhcCBpdCB0byBUV08gdG8gbWFrZSB0aGUgbG9naWMgc2ltcGxlIGFuZCBiZWNhdXNlIHdobyBuZWVkcyB0aGF0IGtpbmQgb2Ygc3VidGVzdGluZwogICAgICAgICAgICAvLyBoYXNodGFnIGZhbW91cyBsYXN0IHdvcmRzCgogICAgICAgICAgICBmZWF0dXJlTmFtZVNwbGl0ID0gZmVhdHVyZU5hbWUuc3BsaXQoJy4nKTsKCiAgICAgICAgICAgIGlmIChmZWF0dXJlTmFtZVNwbGl0Lmxlbmd0aCA9PT0gMSkgewogICAgICAgICAgICAgIE1vZGVybml6cltmZWF0dXJlTmFtZVNwbGl0WzBdXSA9IHJlc3VsdDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAvLyBjYXN0IHRvIGEgQm9vbGVhbiwgaWYgbm90IG9uZSBhbHJlYWR5IG9yIGlmIGl0IGRvZXNudCBleGlzdCB5ZXQgKGxpa2UgaW5wdXR0eXBlcykKICAgICAgICAgICAgICBpZiAoIU1vZGVybml6cltmZWF0dXJlTmFtZVNwbGl0WzBdXSB8fCBNb2Rlcm5penJbZmVhdHVyZU5hbWVTcGxpdFswXV0gJiYgIShNb2Rlcm5penJbZmVhdHVyZU5hbWVTcGxpdFswXV0gaW5zdGFuY2VvZiBCb29sZWFuKSkgewogICAgICAgICAgICAgICAgTW9kZXJuaXpyW2ZlYXR1cmVOYW1lU3BsaXRbMF1dID0gbmV3IEJvb2xlYW4oTW9kZXJuaXpyW2ZlYXR1cmVOYW1lU3BsaXRbMF1dKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIE1vZGVybml6cltmZWF0dXJlTmFtZVNwbGl0WzBdXVtmZWF0dXJlTmFtZVNwbGl0WzFdXSA9IHJlc3VsdDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY2xhc3Nlcy5wdXNoKChyZXN1bHQgPyAnJyA6ICduby0nKSArIGZlYXR1cmVOYW1lU3BsaXQuam9pbignLScpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICA7CiAgICAvKioKICAgICAqIGRvY0VsZW1lbnQgaXMgYSBjb252ZW5pZW5jZSB3cmFwcGVyIHRvIGdyYWIgdGhlIHJvb3QgZWxlbWVudCBvZiB0aGUgZG9jdW1lbnQKICAgICAqCiAgICAgKiBAYWNjZXNzIHByaXZhdGUKICAgICAqIEByZXR1cm5zIHtIVE1MRWxlbWVudHxTVkdFbGVtZW50fSBUaGUgcm9vdCBlbGVtZW50IG9mIHRoZSBkb2N1bWVudAogICAgICovCgogICAgdmFyIGRvY0VsZW1lbnQgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7CiAgICAvKioKICAgICAqIEEgY29udmVuaWVuY2UgaGVscGVyIHRvIGNoZWNrIGlmIHRoZSBkb2N1bWVudCB3ZSBhcmUgcnVubmluZyBpbiBpcyBhbiBTVkcgZG9jdW1lbnQKICAgICAqCiAgICAgKiBAYWNjZXNzIHByaXZhdGUKICAgICAqIEByZXR1cm5zIHtib29sZWFufQogICAgICovCgogICAgdmFyIGlzU1ZHID0gZG9jRWxlbWVudC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSAnc3ZnJzsKICAgIC8qKgogICAgICogc2V0Q2xhc3NlcyB0YWtlcyBhbiBhcnJheSBvZiBjbGFzcyBuYW1lcyBhbmQgYWRkcyB0aGVtIHRvIHRoZSByb290IGVsZW1lbnQKICAgICAqCiAgICAgKiBAYWNjZXNzIHByaXZhdGUKICAgICAqIEBmdW5jdGlvbiBzZXRDbGFzc2VzCiAgICAgKiBAcGFyYW0ge3N0cmluZ1tdfSBjbGFzc2VzIC0gQXJyYXkgb2YgY2xhc3MgbmFtZXMKICAgICAqLwogICAgLy8gUGFzcyBpbiBhbiBhbmQgYXJyYXkgb2YgY2xhc3MgbmFtZXMsIGUuZy46CiAgICAvLyAgWyduby13ZWJwJywgJ2JvcmRlcnJhZGl1cycsIC4uLl0KCiAgICBmdW5jdGlvbiBzZXRDbGFzc2VzKGNsYXNzZXMpIHsKICAgICAgdmFyIGNsYXNzTmFtZSA9IGRvY0VsZW1lbnQuY2xhc3NOYW1lOwogICAgICB2YXIgY2xhc3NQcmVmaXggPSBNb2Rlcm5penIuX2NvbmZpZy5jbGFzc1ByZWZpeCB8fCAnJzsKCiAgICAgIGlmIChpc1NWRykgewogICAgICAgIGNsYXNzTmFtZSA9IGNsYXNzTmFtZS5iYXNlVmFsOwogICAgICB9IC8vIENoYW5nZSBgbm8tanNgIHRvIGBqc2AgKGluZGVwZW5kZW50bHkgb2YgdGhlIGBlbmFibGVDbGFzc2VzYCBvcHRpb24pCiAgICAgIC8vIEhhbmRsZSBjbGFzc1ByZWZpeCBvbiB0aGlzIHRvbwoKCiAgICAgIGlmIChNb2Rlcm5penIuX2NvbmZpZy5lbmFibGVKU0NsYXNzKSB7CiAgICAgICAgdmFyIHJlSlMgPSBuZXcgUmVnRXhwKCcoXnxcXHMpJyArIGNsYXNzUHJlZml4ICsgJ25vLWpzKFxcc3wkKScpOwogICAgICAgIGNsYXNzTmFtZSA9IGNsYXNzTmFtZS5yZXBsYWNlKHJlSlMsICckMScgKyBjbGFzc1ByZWZpeCArICdqcyQyJyk7CiAgICAgIH0KCiAgICAgIGlmIChNb2Rlcm5penIuX2NvbmZpZy5lbmFibGVDbGFzc2VzKSB7CiAgICAgICAgLy8gQWRkIHRoZSBuZXcgY2xhc3NlcwogICAgICAgIGlmIChjbGFzc2VzLmxlbmd0aCA+IDApIHsKICAgICAgICAgIGNsYXNzTmFtZSArPSAnICcgKyBjbGFzc1ByZWZpeCArIGNsYXNzZXMuam9pbignICcgKyBjbGFzc1ByZWZpeCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoaXNTVkcpIHsKICAgICAgICAgIGRvY0VsZW1lbnQuY2xhc3NOYW1lLmJhc2VWYWwgPSBjbGFzc05hbWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGRvY0VsZW1lbnQuY2xhc3NOYW1lID0gY2xhc3NOYW1lOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIDsKICAgIC8qKgogICAgICogSWYgdGhlIGJyb3dzZXJzIGZvbGxvdyB0aGUgc3BlYywgdGhlbiB0aGV5IHdvdWxkIGV4cG9zZSB2ZW5kb3Itc3BlY2lmaWMgc3R5bGVzIGFzOgogICAgICogICBlbGVtLnN0eWxlLldlYmtpdEJvcmRlclJhZGl1cwogICAgICogaW5zdGVhZCBvZiBzb21ldGhpbmcgbGlrZSB0aGUgZm9sbG93aW5nICh3aGljaCBpcyB0ZWNobmljYWxseSBpbmNvcnJlY3QpOgogICAgICogICBlbGVtLnN0eWxlLndlYmtpdEJvcmRlclJhZGl1cwogICAgICoKICAgICAqIFdlYktpdCBnaG9zdHMgdGhlaXIgcHJvcGVydGllcyBpbiBsb3dlcmNhc2UgYnV0IE9wZXJhICYgTW96IGRvIG5vdC4KICAgICAqIE1pY3Jvc29mdCB1c2VzIGEgbG93ZXJjYXNlIGBtc2AgaW5zdGVhZCBvZiB0aGUgY29ycmVjdCBgTXNgIGluIElFOCsKICAgICAqICAgZXJpay5lYWUubmV0L2FyY2hpdmVzLzIwMDgvMDMvMTAvMjEuNDguMTAvCiAgICAgKgogICAgICogTW9yZSBoZXJlOiBnaXRodWIuY29tL01vZGVybml6ci9Nb2Rlcm5penIvaXNzdWVzL2lzc3VlLzIxCiAgICAgKgogICAgICogQGFjY2VzcyBwcml2YXRlCiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBUaGUgc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgdmVuZG9yLXNwZWNpZmljIHN0eWxlIHByb3BlcnRpZXMKICAgICAqLwoKICAgIHZhciBvbVByZWZpeGVzID0gJ01veiBPIG1zIFdlYmtpdCc7CiAgICB2YXIgY3Nzb21QcmVmaXhlcyA9IE1vZGVybml6clByb3RvLl9jb25maWcudXNlUHJlZml4ZXMgPyBvbVByZWZpeGVzLnNwbGl0KCcgJykgOiBbXTsKICAgIE1vZGVybml6clByb3RvLl9jc3NvbVByZWZpeGVzID0gY3Nzb21QcmVmaXhlczsKICAgIC8qKgogICAgICogY29udGFpbnMgY2hlY2tzIHRvIHNlZSBpZiBhIHN0cmluZyBjb250YWlucyBhbm90aGVyIHN0cmluZwogICAgICoKICAgICAqIEBhY2Nlc3MgcHJpdmF0ZQogICAgICogQGZ1bmN0aW9uIGNvbnRhaW5zCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gc3RyIC0gVGhlIHN0cmluZyB3ZSB3YW50IHRvIGNoZWNrIGZvciBzdWJzdHJpbmdzCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gc3Vic3RyIC0gVGhlIHN1YnN0cmluZyB3ZSB3YW50IHRvIHNlYXJjaCB0aGUgZmlyc3Qgc3RyaW5nIGZvcgogICAgICogQHJldHVybnMge2Jvb2xlYW59IHRydWUgaWYgYW5kIG9ubHkgaWYgdGhlIGZpcnN0IHN0cmluZyAnc3RyJyBjb250YWlucyB0aGUgc2Vjb25kIHN0cmluZyAnc3Vic3RyJwogICAgICovCgogICAgZnVuY3Rpb24gY29udGFpbnMoc3RyLCBzdWJzdHIpIHsKICAgICAgcmV0dXJuICEhfignJyArIHN0cikuaW5kZXhPZihzdWJzdHIpOwogICAgfQoKICAgIDsKICAgIC8qKgogICAgICogY3JlYXRlRWxlbWVudCBpcyBhIGNvbnZlbmllbmNlIHdyYXBwZXIgYXJvdW5kIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQuIFNpbmNlIHdlCiAgICAgKiB1c2UgY3JlYXRlRWxlbWVudCBhbGwgb3ZlciB0aGUgcGxhY2UsIHRoaXMgYWxsb3dzIGZvciAoc2xpZ2h0bHkpIHNtYWxsZXIgY29kZQogICAgICogYXMgd2VsbCBhcyBhYnN0cmFjdGluZyBhd2F5IGlzc3VlcyB3aXRoIGNyZWF0aW5nIGVsZW1lbnRzIGluIGNvbnRleHRzIG90aGVyIHRoYW4KICAgICAqIEhUTUwgZG9jdW1lbnRzIChlLmcuIFNWRyBkb2N1bWVudHMpLgogICAgICoKICAgICAqIEBhY2Nlc3MgcHJpdmF0ZQogICAgICogQGZ1bmN0aW9uIGNyZWF0ZUVsZW1lbnQKICAgICAqIEByZXR1cm5zIHtIVE1MRWxlbWVudHxTVkdFbGVtZW50fSBBbiBIVE1MIG9yIFNWRyBlbGVtZW50CiAgICAgKi8KCiAgICBmdW5jdGlvbiBjcmVhdGVFbGVtZW50KCkgewogICAgICBpZiAodHlwZW9mIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQgIT09ICdmdW5jdGlvbicpIHsKICAgICAgICAvLyBUaGlzIGlzIHRoZSBjYXNlIGluIElFNywgd2hlcmUgdGhlIHR5cGUgb2YgY3JlYXRlRWxlbWVudCBpcyAib2JqZWN0Ii4KICAgICAgICAvLyBGb3IgdGhpcyByZWFzb24sIHdlIGNhbm5vdCBjYWxsIGFwcGx5KCkgYXMgT2JqZWN0IGlzIG5vdCBhIEZ1bmN0aW9uLgogICAgICAgIHJldHVybiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGFyZ3VtZW50c1swXSk7CiAgICAgIH0gZWxzZSBpZiAoaXNTVkcpIHsKICAgICAgICByZXR1cm4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TLmNhbGwoZG9jdW1lbnQsICdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsIGFyZ3VtZW50c1swXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQuYXBwbHkoZG9jdW1lbnQsIGFyZ3VtZW50cyk7CiAgICAgIH0KICAgIH0KCiAgICA7CiAgICAvKioKICAgICAqIENyZWF0ZSBvdXIgIm1vZGVybml6ciIgZWxlbWVudCB0aGF0IHdlIGRvIG1vc3QgZmVhdHVyZSB0ZXN0cyBvbi4KICAgICAqCiAgICAgKiBAYWNjZXNzIHByaXZhdGUKICAgICAqLwoKICAgIHZhciBtb2RFbGVtID0gewogICAgICBlbGVtOiBjcmVhdGVFbGVtZW50KCdtb2Rlcm5penInKQogICAgfTsgLy8gQ2xlYW4gdXAgdGhpcyBlbGVtZW50CgogICAgTW9kZXJuaXpyLl9xLnB1c2goZnVuY3Rpb24gKCkgewogICAgICBkZWxldGUgbW9kRWxlbS5lbGVtOwogICAgfSk7CgogICAgdmFyIG1TdHlsZSA9IHsKICAgICAgc3R5bGU6IG1vZEVsZW0uZWxlbS5zdHlsZQogICAgfTsgLy8ga2lsbCByZWYgZm9yIGdjLCBtdXN0IGhhcHBlbiBiZWZvcmUgbW9kLmVsZW0gaXMgcmVtb3ZlZCwgc28gd2UgdW5zaGlmdCBvbiB0bwogICAgLy8gdGhlIGZyb250IG9mIHRoZSBxdWV1ZS4KCiAgICBNb2Rlcm5penIuX3EudW5zaGlmdChmdW5jdGlvbiAoKSB7CiAgICAgIGRlbGV0ZSBtU3R5bGUuc3R5bGU7CiAgICB9KTsKICAgIC8qKgogICAgICogZ2V0Qm9keSByZXR1cm5zIHRoZSBib2R5IG9mIGEgZG9jdW1lbnQsIG9yIGFuIGVsZW1lbnQgdGhhdCBjYW4gc3RhbmQgaW4gZm9yCiAgICAgKiB0aGUgYm9keSBpZiBhIHJlYWwgYm9keSBkb2VzIG5vdCBleGlzdAogICAgICoKICAgICAqIEBhY2Nlc3MgcHJpdmF0ZQogICAgICogQGZ1bmN0aW9uIGdldEJvZHkKICAgICAqIEByZXR1cm5zIHtIVE1MRWxlbWVudHxTVkdFbGVtZW50fSBSZXR1cm5zIHRoZSByZWFsIGJvZHkgb2YgYSBkb2N1bWVudCwgb3IgYW4KICAgICAqIGFydGlmaWNpYWxseSBjcmVhdGVkIGVsZW1lbnQgdGhhdCBzdGFuZHMgaW4gZm9yIHRoZSBib2R5CiAgICAgKi8KCgogICAgZnVuY3Rpb24gZ2V0Qm9keSgpIHsKICAgICAgLy8gQWZ0ZXIgcGFnZSBsb2FkIGluamVjdGluZyBhIGZha2UgYm9keSBkb2Vzbid0IHdvcmsgc28gY2hlY2sgaWYgYm9keSBleGlzdHMKICAgICAgdmFyIGJvZHkgPSBkb2N1bWVudC5ib2R5OwoKICAgICAgaWYgKCFib2R5KSB7CiAgICAgICAgLy8gQ2FuJ3QgdXNlIHRoZSByZWFsIGJvZHkgY3JlYXRlIGEgZmFrZSBvbmUuCiAgICAgICAgYm9keSA9IGNyZWF0ZUVsZW1lbnQoaXNTVkcgPyAnc3ZnJyA6ICdib2R5Jyk7CiAgICAgICAgYm9keS5mYWtlID0gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIGJvZHk7CiAgICB9CgogICAgOwogICAgLyoqCiAgICAgKiBpbmplY3RFbGVtZW50V2l0aFN0eWxlcyBpbmplY3RzIGFuIGVsZW1lbnQgd2l0aCBzdHlsZSBlbGVtZW50IGFuZCBzb21lIENTUyBydWxlcwogICAgICoKICAgICAqIEBhY2Nlc3MgcHJpdmF0ZQogICAgICogQGZ1bmN0aW9uIGluamVjdEVsZW1lbnRXaXRoU3R5bGVzCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gcnVsZSAtIFN0cmluZyByZXByZXNlbnRpbmcgYSBjc3MgcnVsZQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgLSBBIGZ1bmN0aW9uIHRoYXQgaXMgdXNlZCB0byB0ZXN0IHRoZSBpbmplY3RlZCBlbGVtZW50CiAgICAgKiBAcGFyYW0ge251bWJlcn0gW25vZGVzXSAtIEFuIGludGVnZXIgcmVwcmVzZW50aW5nIHRoZSBudW1iZXIgb2YgYWRkaXRpb25hbCBub2RlcyB5b3Ugd2FudCBpbmplY3RlZAogICAgICogQHBhcmFtIHtzdHJpbmdbXX0gW3Rlc3RuYW1lc10gLSBBbiBhcnJheSBvZiBzdHJpbmdzIHRoYXQgYXJlIHVzZWQgYXMgaWRzIGZvciB0aGUgYWRkaXRpb25hbCBub2RlcwogICAgICogQHJldHVybnMge2Jvb2xlYW59IHRoZSByZXN1bHQgb2YgdGhlIHNwZWNpZmllZCBjYWxsYmFjayB0ZXN0CiAgICAgKi8KCiAgICBmdW5jdGlvbiBpbmplY3RFbGVtZW50V2l0aFN0eWxlcyhydWxlLCBjYWxsYmFjaywgbm9kZXMsIHRlc3RuYW1lcykgewogICAgICB2YXIgbW9kID0gJ21vZGVybml6cic7CiAgICAgIHZhciBzdHlsZTsKICAgICAgdmFyIHJldDsKICAgICAgdmFyIG5vZGU7CiAgICAgIHZhciBkb2NPdmVyZmxvdzsKICAgICAgdmFyIGRpdiA9IGNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICB2YXIgYm9keSA9IGdldEJvZHkoKTsKCiAgICAgIGlmIChwYXJzZUludChub2RlcywgMTApKSB7CiAgICAgICAgLy8gSW4gb3JkZXIgbm90IHRvIGdpdmUgZmFsc2UgcG9zaXRpdmVzIHdlIGNyZWF0ZSBhIG5vZGUgZm9yIGVhY2ggdGVzdAogICAgICAgIC8vIFRoaXMgYWxzbyBhbGxvd3MgdGhlIG1ldGhvZCB0byBzY2FsZSBmb3IgdW5zcGVjaWZpZWQgdXNlcwogICAgICAgIHdoaWxlIChub2Rlcy0tKSB7CiAgICAgICAgICBub2RlID0gY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICBub2RlLmlkID0gdGVzdG5hbWVzID8gdGVzdG5hbWVzW25vZGVzXSA6IG1vZCArIChub2RlcyArIDEpOwogICAgICAgICAgZGl2LmFwcGVuZENoaWxkKG5vZGUpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgc3R5bGUgPSBjcmVhdGVFbGVtZW50KCdzdHlsZScpOwogICAgICBzdHlsZS50eXBlID0gJ3RleHQvY3NzJzsKICAgICAgc3R5bGUuaWQgPSAncycgKyBtb2Q7IC8vIElFNiB3aWxsIGZhbHNlIHBvc2l0aXZlIG9uIHNvbWUgdGVzdHMgZHVlIHRvIHRoZSBzdHlsZSBlbGVtZW50IGluc2lkZSB0aGUgdGVzdCBkaXYgc29tZWhvdyBpbnRlcmZlcmluZyBvZmZzZXRIZWlnaHQsIHNvIGluc2VydCBpdCBpbnRvIGJvZHkgb3IgZmFrZWJvZHkuCiAgICAgIC8vIE9wZXJhIHdpbGwgYWN0IGFsbCBxdWlya3kgd2hlbiBpbmplY3RpbmcgZWxlbWVudHMgaW4gZG9jdW1lbnRFbGVtZW50IHdoZW4gcGFnZSBpcyBzZXJ2ZWQgYXMgeG1sLCBuZWVkcyBmYWtlYm9keSB0b28uICMyNzAKCiAgICAgICghYm9keS5mYWtlID8gZGl2IDogYm9keSkuYXBwZW5kQ2hpbGQoc3R5bGUpOwogICAgICBib2R5LmFwcGVuZENoaWxkKGRpdik7CgogICAgICBpZiAoc3R5bGUuc3R5bGVTaGVldCkgewogICAgICAgIHN0eWxlLnN0eWxlU2hlZXQuY3NzVGV4dCA9IHJ1bGU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc3R5bGUuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUocnVsZSkpOwogICAgICB9CgogICAgICBkaXYuaWQgPSBtb2Q7CgogICAgICBpZiAoYm9keS5mYWtlKSB7CiAgICAgICAgLy9hdm9pZCBjcmFzaGluZyBJRTgsIGlmIGJhY2tncm91bmQgaW1hZ2UgaXMgdXNlZAogICAgICAgIGJvZHkuc3R5bGUuYmFja2dyb3VuZCA9ICcnOyAvL1NhZmFyaSA1LjEzLzUuMS40IE9TWCBzdG9wcyBsb2FkaW5nIGlmIDo6LXdlYmtpdC1zY3JvbGxiYXIgaXMgdXNlZCBhbmQgc2Nyb2xsYmFycyBhcmUgdmlzaWJsZQoKICAgICAgICBib2R5LnN0eWxlLm92ZXJmbG93ID0gJ2hpZGRlbic7CiAgICAgICAgZG9jT3ZlcmZsb3cgPSBkb2NFbGVtZW50LnN0eWxlLm92ZXJmbG93OwogICAgICAgIGRvY0VsZW1lbnQuc3R5bGUub3ZlcmZsb3cgPSAnaGlkZGVuJzsKICAgICAgICBkb2NFbGVtZW50LmFwcGVuZENoaWxkKGJvZHkpOwogICAgICB9CgogICAgICByZXQgPSBjYWxsYmFjayhkaXYsIHJ1bGUpOyAvLyBJZiB0aGlzIGlzIGRvbmUgYWZ0ZXIgcGFnZSBsb2FkIHdlIGRvbid0IHdhbnQgdG8gcmVtb3ZlIHRoZSBib2R5IHNvIGNoZWNrIGlmIGJvZHkgZXhpc3RzCgogICAgICBpZiAoYm9keS5mYWtlKSB7CiAgICAgICAgYm9keS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGJvZHkpOwogICAgICAgIGRvY0VsZW1lbnQuc3R5bGUub3ZlcmZsb3cgPSBkb2NPdmVyZmxvdzsgLy8gVHJpZ2dlciBsYXlvdXQgc28ga2luZXRpYyBzY3JvbGxpbmcgaXNuJ3QgZGlzYWJsZWQgaW4gaU9TNisKICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUKCiAgICAgICAgZG9jRWxlbWVudC5vZmZzZXRIZWlnaHQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGl2LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZGl2KTsKICAgICAgfQoKICAgICAgcmV0dXJuICEhcmV0OwogICAgfQoKICAgIDsKICAgIC8qKgogICAgICogZG9tVG9DU1MgdGFrZXMgYSBjYW1lbENhc2Ugc3RyaW5nIGFuZCBjb252ZXJ0cyBpdCB0byBrZWJhYi1jYXNlCiAgICAgKiBlLmcuIGJveFNpemluZyAtPiBib3gtc2l6aW5nCiAgICAgKgogICAgICogQGFjY2VzcyBwcml2YXRlCiAgICAgKiBAZnVuY3Rpb24gZG9tVG9DU1MKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gU3RyaW5nIG5hbWUgb2YgY2FtZWxDYXNlIHByb3Agd2Ugd2FudCB0byBjb252ZXJ0CiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBUaGUga2ViYWItY2FzZSB2ZXJzaW9uIG9mIHRoZSBzdXBwbGllZCBuYW1lCiAgICAgKi8KCiAgICBmdW5jdGlvbiBkb21Ub0NTUyhuYW1lKSB7CiAgICAgIHJldHVybiBuYW1lLnJlcGxhY2UoLyhbQS1aXSkvZywgZnVuY3Rpb24gKHN0ciwgbTEpIHsKICAgICAgICByZXR1cm4gJy0nICsgbTEudG9Mb3dlckNhc2UoKTsKICAgICAgfSkucmVwbGFjZSgvXm1zLS8sICctbXMtJyk7CiAgICB9CgogICAgOwogICAgLyoqCiAgICAgKiB3cmFwcGVyIGFyb3VuZCBnZXRDb21wdXRlZFN0eWxlLCB0byBmaXggaXNzdWVzIHdpdGggRmlyZWZveCByZXR1cm5pbmcgbnVsbCB3aGVuCiAgICAgKiBjYWxsZWQgaW5zaWRlIG9mIGEgaGlkZGVuIGlmcmFtZQogICAgICoKICAgICAqIEBhY2Nlc3MgcHJpdmF0ZQogICAgICogQGZ1bmN0aW9uIGNvbXB1dGVkU3R5bGUKICAgICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR8U1ZHRWxlbWVudH0gZWxlbSAtIFRoZSBlbGVtZW50IHdlIHdhbnQgdG8gZmluZCB0aGUgY29tcHV0ZWQgc3R5bGVzIG9mCiAgICAgKiBAcGFyYW0ge3N0cmluZ3xudWxsfSBbcHNldWRvXSAtIEFuIG9wdGlvbmFsIHBzZXVkbyBlbGVtZW50IHNlbGVjdG9yIChlLmcuIDpiZWZvcmUpLCBvZiBudWxsIGlmIG5vbmUKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBwcm9wIC0gQSBDU1MgcHJvcGVydHkKICAgICAqIEByZXR1cm5zIHtDU1NTdHlsZURlY2xhcmF0aW9ufSB0aGUgdmFsdWUgb2YgdGhlIHNwZWNpZmllZCBDU1MgcHJvcGVydHkKICAgICAqLwoKICAgIGZ1bmN0aW9uIGNvbXB1dGVkU3R5bGUoZWxlbSwgcHNldWRvLCBwcm9wKSB7CiAgICAgIHZhciByZXN1bHQ7CgogICAgICBpZiAoJ2dldENvbXB1dGVkU3R5bGUnIGluIHdpbmRvdykgewogICAgICAgIHJlc3VsdCA9IGdldENvbXB1dGVkU3R5bGUuY2FsbCh3aW5kb3csIGVsZW0sIHBzZXVkbyk7CiAgICAgICAgdmFyIGNvbnNvbGUgPSB3aW5kb3cuY29uc29sZTsKCiAgICAgICAgaWYgKHJlc3VsdCAhPT0gbnVsbCkgewogICAgICAgICAgaWYgKHByb3ApIHsKICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmdldFByb3BlcnR5VmFsdWUocHJvcCk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChjb25zb2xlKSB7CiAgICAgICAgICAgIHZhciBtZXRob2QgPSBjb25zb2xlLmVycm9yID8gJ2Vycm9yJyA6ICdsb2cnOwogICAgICAgICAgICBjb25zb2xlW21ldGhvZF0uY2FsbChjb25zb2xlLCAnZ2V0Q29tcHV0ZWRTdHlsZSByZXR1cm5pbmcgbnVsbCwgaXRzIHBvc3NpYmxlIG1vZGVybml6ciB0ZXN0IHJlc3VsdHMgYXJlIGluYWNjdXJhdGUnKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVzdWx0ID0gIXBzZXVkbyAmJiBlbGVtLmN1cnJlbnRTdHlsZSAmJiBlbGVtLmN1cnJlbnRTdHlsZVtwcm9wXTsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgICA7CiAgICAvKioKICAgICAqIG5hdGl2ZVRlc3RQcm9wcyBhbGxvd3MgZm9yIHVzIHRvIHVzZSBuYXRpdmUgZmVhdHVyZSBkZXRlY3Rpb24gZnVuY3Rpb25hbGl0eSBpZiBhdmFpbGFibGUuCiAgICAgKiBzb21lIHByZWZpeGVkIGZvcm0sIG9yIGZhbHNlLCBpbiB0aGUgY2FzZSBvZiBhbiB1bnN1cHBvcnRlZCBydWxlCiAgICAgKgogICAgICogQGFjY2VzcyBwcml2YXRlCiAgICAgKiBAZnVuY3Rpb24gbmF0aXZlVGVzdFByb3BzCiAgICAgKiBAcGFyYW0ge0FycmF5fSBwcm9wcyAtIEFuIGFycmF5IG9mIHByb3BlcnR5IG5hbWVzCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUgLSBBIHN0cmluZyByZXByZXNlbnRpbmcgdGhlIHZhbHVlIHdlIHdhbnQgdG8gY2hlY2sgdmlhIEBzdXBwb3J0cwogICAgICogQHJldHVybnMge2Jvb2xlYW58dW5kZWZpbmVkfSBBIGJvb2xlYW4gd2hlbiBAc3VwcG9ydHMgZXhpc3RzLCB1bmRlZmluZWQgb3RoZXJ3aXNlCiAgICAgKi8KICAgIC8vIEFjY2VwdHMgYSBsaXN0IG9mIHByb3BlcnR5IG5hbWVzIGFuZCBhIHNpbmdsZSB2YWx1ZQogICAgLy8gUmV0dXJucyBgdW5kZWZpbmVkYCBpZiBuYXRpdmUgZGV0ZWN0aW9uIG5vdCBhdmFpbGFibGUKCiAgICBmdW5jdGlvbiBuYXRpdmVUZXN0UHJvcHMocHJvcHMsIHZhbHVlKSB7CiAgICAgIHZhciBpID0gcHJvcHMubGVuZ3RoOyAvLyBTdGFydCB3aXRoIHRoZSBKUyBBUEk6IGh0dHBzOi8vd3d3LnczLm9yZy9UUi9jc3MzLWNvbmRpdGlvbmFsLyN0aGUtY3NzLWludGVyZmFjZQoKICAgICAgaWYgKCdDU1MnIGluIHdpbmRvdyAmJiAnc3VwcG9ydHMnIGluIHdpbmRvdy5DU1MpIHsKICAgICAgICAvLyBUcnkgZXZlcnkgcHJlZml4ZWQgdmFyaWFudCBvZiB0aGUgcHJvcGVydHkKICAgICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgICBpZiAod2luZG93LkNTUy5zdXBwb3J0cyhkb21Ub0NTUyhwcm9wc1tpXSksIHZhbHVlKSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSAvLyBPdGhlcndpc2UgZmFsbCBiYWNrIHRvIGF0LXJ1bGUgKGZvciBPcGVyYSAxMi54KQogICAgICBlbHNlIGlmICgnQ1NTU3VwcG9ydHNSdWxlJyBpbiB3aW5kb3cpIHsKICAgICAgICAgIC8vIEJ1aWxkIGEgY29uZGl0aW9uIHN0cmluZyBmb3IgZXZlcnkgcHJlZml4ZWQgdmFyaWFudAogICAgICAgICAgdmFyIGNvbmRpdGlvblRleHQgPSBbXTsKCiAgICAgICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgICAgIGNvbmRpdGlvblRleHQucHVzaCgnKCcgKyBkb21Ub0NTUyhwcm9wc1tpXSkgKyAnOicgKyB2YWx1ZSArICcpJyk7CiAgICAgICAgICB9CgogICAgICAgICAgY29uZGl0aW9uVGV4dCA9IGNvbmRpdGlvblRleHQuam9pbignIG9yICcpOwogICAgICAgICAgcmV0dXJuIGluamVjdEVsZW1lbnRXaXRoU3R5bGVzKCdAc3VwcG9ydHMgKCcgKyBjb25kaXRpb25UZXh0ICsgJykgeyAjbW9kZXJuaXpyIHsgcG9zaXRpb246IGFic29sdXRlOyB9IH0nLCBmdW5jdGlvbiAobm9kZSkgewogICAgICAgICAgICByZXR1cm4gY29tcHV0ZWRTdHlsZShub2RlLCBudWxsLCAncG9zaXRpb24nKSA9PT0gJ2Fic29sdXRlJzsKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICB9CgogICAgOwogICAgLyoqCiAgICAgKiBjc3NUb0RPTSB0YWtlcyBhIGtlYmFiLWNhc2Ugc3RyaW5nIGFuZCBjb252ZXJ0cyBpdCB0byBjYW1lbENhc2UKICAgICAqIGUuZy4gYm94LXNpemluZyAtPiBib3hTaXppbmcKICAgICAqCiAgICAgKiBAYWNjZXNzIHByaXZhdGUKICAgICAqIEBmdW5jdGlvbiBjc3NUb0RPTQogICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBTdHJpbmcgbmFtZSBvZiBrZWJhYi1jYXNlIHByb3Agd2Ugd2FudCB0byBjb252ZXJ0CiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBUaGUgY2FtZWxDYXNlIHZlcnNpb24gb2YgdGhlIHN1cHBsaWVkIG5hbWUKICAgICAqLwoKICAgIGZ1bmN0aW9uIGNzc1RvRE9NKG5hbWUpIHsKICAgICAgcmV0dXJuIG5hbWUucmVwbGFjZSgvKFthLXpdKS0oW2Etel0pL2csIGZ1bmN0aW9uIChzdHIsIG0xLCBtMikgewogICAgICAgIHJldHVybiBtMSArIG0yLnRvVXBwZXJDYXNlKCk7CiAgICAgIH0pLnJlcGxhY2UoL14tLywgJycpOwogICAgfQoKICAgIDsgLy8gdGVzdFByb3BzIGlzIGEgZ2VuZXJpYyBDU1MgLyBET00gcHJvcGVydHkgdGVzdC4KICAgIC8vIEluIHRlc3Rpbmcgc3VwcG9ydCBmb3IgYSBnaXZlbiBDU1MgcHJvcGVydHksIGl0J3MgbGVnaXQgdG8gdGVzdDoKICAgIC8vICAgIGBlbGVtLnN0eWxlW3N0eWxlTmFtZV0gIT09IHVuZGVmaW5lZGAKICAgIC8vIElmIHRoZSBwcm9wZXJ0eSBpcyBzdXBwb3J0ZWQgaXQgd2lsbCByZXR1cm4gYW4gZW1wdHkgc3RyaW5nLAogICAgLy8gaWYgdW5zdXBwb3J0ZWQgaXQgd2lsbCByZXR1cm4gdW5kZWZpbmVkLgogICAgLy8gV2UnbGwgdGFrZSBhZHZhbnRhZ2Ugb2YgdGhpcyBxdWljayB0ZXN0IGFuZCBza2lwIHNldHRpbmcgYSBzdHlsZQogICAgLy8gb24gb3VyIG1vZGVybml6ciBlbGVtZW50LCBidXQgaW5zdGVhZCBqdXN0IHRlc3RpbmcgdW5kZWZpbmVkIHZzCiAgICAvLyBlbXB0eSBzdHJpbmcuCiAgICAvLyBQcm9wZXJ0eSBuYW1lcyBjYW4gYmUgcHJvdmlkZWQgaW4gZWl0aGVyIGNhbWVsQ2FzZSBvciBrZWJhYi1jYXNlLgoKICAgIGZ1bmN0aW9uIHRlc3RQcm9wcyhwcm9wcywgcHJlZml4ZWQsIHZhbHVlLCBza2lwVmFsdWVUZXN0KSB7CiAgICAgIHNraXBWYWx1ZVRlc3QgPSBpcyhza2lwVmFsdWVUZXN0LCAndW5kZWZpbmVkJykgPyBmYWxzZSA6IHNraXBWYWx1ZVRlc3Q7IC8vIFRyeSBuYXRpdmUgZGV0ZWN0IGZpcnN0CgogICAgICBpZiAoIWlzKHZhbHVlLCAndW5kZWZpbmVkJykpIHsKICAgICAgICB2YXIgcmVzdWx0ID0gbmF0aXZlVGVzdFByb3BzKHByb3BzLCB2YWx1ZSk7CgogICAgICAgIGlmICghaXMocmVzdWx0LCAndW5kZWZpbmVkJykpIHsKICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICB9IC8vIE90aGVyd2lzZSBkbyBpdCBwcm9wZXJseQoKCiAgICAgIHZhciBhZnRlckluaXQsIGksIHByb3BzTGVuZ3RoLCBwcm9wLCBiZWZvcmU7IC8vIElmIHdlIGRvbid0IGhhdmUgYSBzdHlsZSBlbGVtZW50LCB0aGF0IG1lYW5zIHdlJ3JlIHJ1bm5pbmcgYXN5bmMgb3IgYWZ0ZXIKICAgICAgLy8gdGhlIGNvcmUgdGVzdHMsIHNvIHdlJ2xsIG5lZWQgdG8gY3JlYXRlIG91ciBvd24gZWxlbWVudHMgdG8gdXNlLgogICAgICAvLyBJbnNpZGUgb2YgYW4gU1ZHIGVsZW1lbnQsIGluIGNlcnRhaW4gYnJvd3NlcnMsIHRoZSBgc3R5bGVgIGVsZW1lbnQgaXMgb25seQogICAgICAvLyBkZWZpbmVkIGZvciB2YWxpZCB0YWdzLiBUaGVyZWZvcmUsIGlmIGBtb2Rlcm5penJgIGRvZXMgbm90IGhhdmUgb25lLCB3ZQogICAgICAvLyBmYWxsIGJhY2sgdG8gYSBsZXNzIHVzZWQgZWxlbWVudCBhbmQgaG9wZSBmb3IgdGhlIGJlc3QuCiAgICAgIC8vIEZvciBzdHJpY3QgWEhUTUwgYnJvd3NlcnMgdGhlIGhhcmRseSB1c2VkIHNhbXAgZWxlbWVudCBpcyB1c2VkLgoKICAgICAgdmFyIGVsZW1zID0gWydtb2Rlcm5penInLCAndHNwYW4nLCAnc2FtcCddOwoKICAgICAgd2hpbGUgKCFtU3R5bGUuc3R5bGUgJiYgZWxlbXMubGVuZ3RoKSB7CiAgICAgICAgYWZ0ZXJJbml0ID0gdHJ1ZTsKICAgICAgICBtU3R5bGUubW9kRWxlbSA9IGNyZWF0ZUVsZW1lbnQoZWxlbXMuc2hpZnQoKSk7CiAgICAgICAgbVN0eWxlLnN0eWxlID0gbVN0eWxlLm1vZEVsZW0uc3R5bGU7CiAgICAgIH0gLy8gRGVsZXRlIHRoZSBvYmplY3RzIGlmIHdlIGNyZWF0ZWQgdGhlbS4KCgogICAgICBmdW5jdGlvbiBjbGVhbkVsZW1zKCkgewogICAgICAgIGlmIChhZnRlckluaXQpIHsKICAgICAgICAgIGRlbGV0ZSBtU3R5bGUuc3R5bGU7CiAgICAgICAgICBkZWxldGUgbVN0eWxlLm1vZEVsZW07CiAgICAgICAgfQogICAgICB9CgogICAgICBwcm9wc0xlbmd0aCA9IHByb3BzLmxlbmd0aDsKCiAgICAgIGZvciAoaSA9IDA7IGkgPCBwcm9wc0xlbmd0aDsgaSsrKSB7CiAgICAgICAgcHJvcCA9IHByb3BzW2ldOwogICAgICAgIGJlZm9yZSA9IG1TdHlsZS5zdHlsZVtwcm9wXTsKCiAgICAgICAgaWYgKGNvbnRhaW5zKHByb3AsICctJykpIHsKICAgICAgICAgIHByb3AgPSBjc3NUb0RPTShwcm9wKTsKICAgICAgICB9CgogICAgICAgIGlmIChtU3R5bGUuc3R5bGVbcHJvcF0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgLy8gSWYgdmFsdWUgdG8gdGVzdCBoYXMgYmVlbiBwYXNzZWQgaW4sIGRvIGEgc2V0LWFuZC1jaGVjayB0ZXN0LgogICAgICAgICAgLy8gMCAoaW50ZWdlcikgaXMgYSB2YWxpZCBwcm9wZXJ0eSB2YWx1ZSwgc28gY2hlY2sgdGhhdCBgdmFsdWVgIGlzbid0CiAgICAgICAgICAvLyB1bmRlZmluZWQsIHJhdGhlciB0aGFuIGp1c3QgY2hlY2tpbmcgaXQncyB0cnV0aHkuCiAgICAgICAgICBpZiAoIXNraXBWYWx1ZVRlc3QgJiYgIWlzKHZhbHVlLCAndW5kZWZpbmVkJykpIHsKICAgICAgICAgICAgLy8gTmVlZHMgYSB0cnkgY2F0Y2ggYmxvY2sgYmVjYXVzZSBvZiBvbGQgSUUuIFRoaXMgaXMgc2xvdywgYnV0IHdpbGwKICAgICAgICAgICAgLy8gYmUgYXZvaWRlZCBpbiBtb3N0IGNhc2VzIGJlY2F1c2UgYHNraXBWYWx1ZVRlc3RgIHdpbGwgYmUgdXNlZC4KICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBtU3R5bGUuc3R5bGVbcHJvcF0gPSB2YWx1ZTsKICAgICAgICAgICAgfSBjYXRjaCAoZSkge30gLy8gSWYgdGhlIHByb3BlcnR5IHZhbHVlIGhhcyBjaGFuZ2VkLCB3ZSBhc3N1bWUgdGhlIHZhbHVlIHVzZWQgaXMKICAgICAgICAgICAgLy8gc3VwcG9ydGVkLiBJZiBgdmFsdWVgIGlzIGVtcHR5IHN0cmluZywgaXQnbGwgZmFpbCBoZXJlIChiZWNhdXNlCiAgICAgICAgICAgIC8vIGl0IGhhc24ndCBjaGFuZ2VkKSwgd2hpY2ggbWF0Y2hlcyBob3cgYnJvd3NlcnMgaGF2ZSBpbXBsZW1lbnRlZAogICAgICAgICAgICAvLyBDU1Muc3VwcG9ydHMoKQoKCiAgICAgICAgICAgIGlmIChtU3R5bGUuc3R5bGVbcHJvcF0gIT09IGJlZm9yZSkgewogICAgICAgICAgICAgIGNsZWFuRWxlbXMoKTsKICAgICAgICAgICAgICByZXR1cm4gcHJlZml4ZWQgPT09ICdwZngnID8gcHJvcCA6IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gLy8gT3RoZXJ3aXNlIGp1c3QgcmV0dXJuIHRydWUsIG9yIHRoZSBwcm9wZXJ0eSBuYW1lIGlmIHRoaXMgaXMgYQogICAgICAgICAgLy8gYHByZWZpeGVkKClgIGNhbGwKICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIGNsZWFuRWxlbXMoKTsKICAgICAgICAgICAgICByZXR1cm4gcHJlZml4ZWQgPT09ICdwZngnID8gcHJvcCA6IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNsZWFuRWxlbXMoKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIDsKICAgIC8qKgogICAgICogTGlzdCBvZiBKYXZhU2NyaXB0IERPTSB2YWx1ZXMgdXNlZCBmb3IgdGVzdHMKICAgICAqCiAgICAgKiBAbWVtYmVyT2YgTW9kZXJuaXpyCiAgICAgKiBAbmFtZSBNb2Rlcm5penIuX2RvbVByZWZpeGVzCiAgICAgKiBAb3B0aW9uTmFtZSBNb2Rlcm5penIuX2RvbVByZWZpeGVzCiAgICAgKiBAb3B0aW9uUHJvcCBkb21QcmVmaXhlcwogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEBleGFtcGxlCiAgICAgKgogICAgICogTW9kZXJuaXpyLl9kb21QcmVmaXhlcyBpcyBleGFjdGx5IHRoZSBzYW1lIGFzIFtfcHJlZml4ZXNdKCNtb2Rlcm5penItX3ByZWZpeGVzKSwgYnV0IHJhdGhlcgogICAgICogdGhhbiBrZWJhYi1jYXNlIHByb3BlcnRpZXMsIGFsbCBwcm9wZXJ0aWVzIGFyZSB0aGVpciBDYXBpdGFsaXplZCB2YXJpYW50CiAgICAgKgogICAgICogYGBganMKICAgICAqIE1vZGVybml6ci5fZG9tUHJlZml4ZXMgPT09IFsgIk1veiIsICJPIiwgIm1zIiwgIldlYmtpdCIgXTsKICAgICAqIGBgYAogICAgICovCgogICAgdmFyIGRvbVByZWZpeGVzID0gTW9kZXJuaXpyUHJvdG8uX2NvbmZpZy51c2VQcmVmaXhlcyA/IG9tUHJlZml4ZXMudG9Mb3dlckNhc2UoKS5zcGxpdCgnICcpIDogW107CiAgICBNb2Rlcm5penJQcm90by5fZG9tUHJlZml4ZXMgPSBkb21QcmVmaXhlczsKICAgIC8qKgogICAgICogZm5CaW5kIGlzIGEgc3VwZXIgc21hbGwgW2JpbmRdKGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL0Z1bmN0aW9uL2JpbmQpIHBvbHlmaWxsLgogICAgICoKICAgICAqIEBhY2Nlc3MgcHJpdmF0ZQogICAgICogQGZ1bmN0aW9uIGZuQmluZAogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZm4gLSBhIGZ1bmN0aW9uIHlvdSB3YW50IHRvIGNoYW5nZSBgdGhpc2AgcmVmZXJlbmNlIHRvCiAgICAgKiBAcGFyYW0ge29iamVjdH0gdGhhdCAtIHRoZSBgdGhpc2AgeW91IHdhbnQgdG8gY2FsbCB0aGUgZnVuY3Rpb24gd2l0aAogICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBUaGUgd3JhcHBlZCB2ZXJzaW9uIG9mIHRoZSBzdXBwbGllZCBmdW5jdGlvbgogICAgICovCgogICAgZnVuY3Rpb24gZm5CaW5kKGZuLCB0aGF0KSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIGZuLmFwcGx5KHRoYXQsIGFyZ3VtZW50cyk7CiAgICAgIH07CiAgICB9CgogICAgOwogICAgLyoqCiAgICAgKiB0ZXN0RE9NUHJvcHMgaXMgYSBnZW5lcmljIERPTSBwcm9wZXJ0eSB0ZXN0OyBpZiBhIGJyb3dzZXIgc3VwcG9ydHMKICAgICAqICAgYSBjZXJ0YWluIHByb3BlcnR5LCBpdCB3b24ndCByZXR1cm4gdW5kZWZpbmVkIGZvciBpdC4KICAgICAqCiAgICAgKiBAYWNjZXNzIHByaXZhdGUKICAgICAqIEBmdW5jdGlvbiB0ZXN0RE9NUHJvcHMKICAgICAqIEBwYXJhbSB7QXJyYXk8c3RyaW5nPn0gcHJvcHMgLSBBbiBhcnJheSBvZiBwcm9wZXJ0aWVzIHRvIHRlc3QgZm9yCiAgICAgKiBAcGFyYW0ge29iamVjdH0gb2JqIC0gQW4gb2JqZWN0IG9yIEVsZW1lbnQgeW91IHdhbnQgdG8gdXNlIHRvIHRlc3QgdGhlIHBhcmFtZXRlcnMgYWdhaW4KICAgICAqIEBwYXJhbSB7Ym9vbGVhbnxvYmplY3R9IGVsZW0gLSBBbiBFbGVtZW50IHRvIGJpbmQgdGhlIHByb3BlcnR5IGxvb2t1cCBhZ2Fpbi4gVXNlIGBmYWxzZWAgdG8gcHJldmVudCB0aGUgY2hlY2sKICAgICAqIEByZXR1cm5zIHtib29sZWFufCp9IHJldHVybnMgYGZhbHNlYCBpZiB0aGUgcHJvcCBpcyB1bnN1cHBvcnRlZCwgb3RoZXJ3aXNlIHRoZSB2YWx1ZSB0aGF0IGlzIHN1cHBvcnRlZAogICAgICovCgogICAgZnVuY3Rpb24gdGVzdERPTVByb3BzKHByb3BzLCBvYmosIGVsZW0pIHsKICAgICAgdmFyIGl0ZW07CgogICAgICBmb3IgKHZhciBpIGluIHByb3BzKSB7CiAgICAgICAgaWYgKHByb3BzW2ldIGluIG9iaikgewogICAgICAgICAgLy8gcmV0dXJuIHRoZSBwcm9wZXJ0eSBuYW1lIGFzIGEgc3RyaW5nCiAgICAgICAgICBpZiAoZWxlbSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgcmV0dXJuIHByb3BzW2ldOwogICAgICAgICAgfQoKICAgICAgICAgIGl0ZW0gPSBvYmpbcHJvcHNbaV1dOyAvLyBsZXQncyBiaW5kIGEgZnVuY3Rpb24KCiAgICAgICAgICBpZiAoaXMoaXRlbSwgJ2Z1bmN0aW9uJykpIHsKICAgICAgICAgICAgLy8gYmluZCB0byBvYmogdW5sZXNzIG92ZXJyaWRkZW4KICAgICAgICAgICAgcmV0dXJuIGZuQmluZChpdGVtLCBlbGVtIHx8IG9iaik7CiAgICAgICAgICB9IC8vIHJldHVybiB0aGUgdW5ib3VuZCBmdW5jdGlvbiBvciBvYmogb3IgdmFsdWUKCgogICAgICAgICAgcmV0dXJuIGl0ZW07CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgOwogICAgLyoqCiAgICAgKiB0ZXN0UHJvcHNBbGwgdGVzdHMgYSBsaXN0IG9mIERPTSBwcm9wZXJ0aWVzIHdlIHdhbnQgdG8gY2hlY2sgYWdhaW5zdC4KICAgICAqIFdlIHNwZWNpZnkgbGl0ZXJhbGx5IEFMTCBwb3NzaWJsZSAoa25vd24gYW5kL29yIGxpa2VseSkgcHJvcGVydGllcyBvbgogICAgICogdGhlIGVsZW1lbnQgaW5jbHVkaW5nIHRoZSBub24tdmVuZG9yIHByZWZpeGVkIG9uZSwgZm9yIGZvcndhcmQtCiAgICAgKiBjb21wYXRpYmlsaXR5LgogICAgICoKICAgICAqIEBhY2Nlc3MgcHJpdmF0ZQogICAgICogQGZ1bmN0aW9uIHRlc3RQcm9wc0FsbAogICAgICogQHBhcmFtIHtzdHJpbmd9IHByb3AgLSBBIHN0cmluZyBvZiB0aGUgcHJvcGVydHkgdG8gdGVzdCBmb3IKICAgICAqIEBwYXJhbSB7c3RyaW5nfG9iamVjdH0gW3ByZWZpeGVkXSAtIEFuIG9iamVjdCB0byBjaGVjayB0aGUgcHJlZml4ZWQgcHJvcGVydGllcyBvbi4gVXNlIGEgc3RyaW5nIHRvIHNraXAKICAgICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR8U1ZHRWxlbWVudH0gW2VsZW1dIC0gQW4gZWxlbWVudCB1c2VkIHRvIHRlc3QgdGhlIHByb3BlcnR5IGFuZCB2YWx1ZSBhZ2FpbnN0CiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW3ZhbHVlXSAtIEEgc3RyaW5nIG9mIGEgY3NzIHZhbHVlCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtza2lwVmFsdWVUZXN0XSAtIEFuIGJvb2xlYW4gcmVwcmVzZW50aW5nIGlmIHlvdSB3YW50IHRvIHRlc3QgaWYgdmFsdWUgc3RpY2tzIHdoZW4gc2V0CiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfGJvb2xlYW59IHJldHVybnMgdGhlIHN0cmluZyB2ZXJzaW9uIG9mIHRoZSBwcm9wZXJ0eSwgb3IgYGZhbHNlYCBpZiBpdCBpcyB1bnN1cHBvcnRlZAogICAgICovCgogICAgZnVuY3Rpb24gdGVzdFByb3BzQWxsKHByb3AsIHByZWZpeGVkLCBlbGVtLCB2YWx1ZSwgc2tpcFZhbHVlVGVzdCkgewogICAgICB2YXIgdWNQcm9wID0gcHJvcC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHByb3Auc2xpY2UoMSksCiAgICAgICAgICBwcm9wcyA9IChwcm9wICsgJyAnICsgY3Nzb21QcmVmaXhlcy5qb2luKHVjUHJvcCArICcgJykgKyB1Y1Byb3ApLnNwbGl0KCcgJyk7IC8vIGRpZCB0aGV5IGNhbGwgLnByZWZpeGVkKCdib3hTaXppbmcnKSBvciBhcmUgd2UganVzdCB0ZXN0aW5nIGEgcHJvcD8KCiAgICAgIGlmIChpcyhwcmVmaXhlZCwgJ3N0cmluZycpIHx8IGlzKHByZWZpeGVkLCAndW5kZWZpbmVkJykpIHsKICAgICAgICByZXR1cm4gdGVzdFByb3BzKHByb3BzLCBwcmVmaXhlZCwgdmFsdWUsIHNraXBWYWx1ZVRlc3QpOyAvLyBvdGhlcndpc2UsIHRoZXkgY2FsbGVkIC5wcmVmaXhlZCgncmVxdWVzdEFuaW1hdGlvbkZyYW1lJywgd2luZG93WywgZWxlbV0pCiAgICAgIH0gZWxzZSB7CiAgICAgICAgcHJvcHMgPSAocHJvcCArICcgJyArIGRvbVByZWZpeGVzLmpvaW4odWNQcm9wICsgJyAnKSArIHVjUHJvcCkuc3BsaXQoJyAnKTsKICAgICAgICByZXR1cm4gdGVzdERPTVByb3BzKHByb3BzLCBwcmVmaXhlZCwgZWxlbSk7CiAgICAgIH0KICAgIH0gLy8gTW9kZXJuaXpyLnRlc3RBbGxQcm9wcygpIGludmVzdGlnYXRlcyB3aGV0aGVyIGEgZ2l2ZW4gc3R5bGUgcHJvcGVydHksCiAgICAvLyBvciBhbnkgb2YgaXRzIHZlbmRvci1wcmVmaXhlZCB2YXJpYW50cywgaXMgcmVjb2duaXplZAogICAgLy8KICAgIC8vIE5vdGUgdGhhdCB0aGUgcHJvcGVydHkgbmFtZXMgbXVzdCBiZSBwcm92aWRlZCBpbiB0aGUgY2FtZWxDYXNlIHZhcmlhbnQuCiAgICAvLyBNb2Rlcm5penIudGVzdEFsbFByb3BzKCdib3hTaXppbmcnKQoKCiAgICBNb2Rlcm5penJQcm90by50ZXN0QWxsUHJvcHMgPSB0ZXN0UHJvcHNBbGw7CiAgICAvKioKICAgICAqIHRlc3RBbGxQcm9wcyBkZXRlcm1pbmVzIHdoZXRoZXIgYSBnaXZlbiBDU1MgcHJvcGVydHkgaXMgc3VwcG9ydGVkIGluIHRoZSBicm93c2VyCiAgICAgKgogICAgICogQG1lbWJlck9mIE1vZGVybml6cgogICAgICogQG5hbWUgTW9kZXJuaXpyLnRlc3RBbGxQcm9wcwogICAgICogQG9wdGlvbk5hbWUgTW9kZXJuaXpyLnRlc3RBbGxQcm9wcygpCiAgICAgKiBAb3B0aW9uUHJvcCB0ZXN0QWxsUHJvcHMKICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAZnVuY3Rpb24gdGVzdEFsbFByb3BzCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gcHJvcCAtIFN0cmluZyBuYW1pbmcgdGhlIHByb3BlcnR5IHRvIHRlc3QgKGVpdGhlciBjYW1lbENhc2Ugb3Iga2ViYWItY2FzZSkKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbdmFsdWVdIC0gU3RyaW5nIG9mIHRoZSB2YWx1ZSB0byB0ZXN0CiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtza2lwVmFsdWVUZXN0PWZhbHNlXSAtIFdoZXRoZXIgdG8gc2tpcCB0ZXN0aW5nIHRoYXQgdGhlIHZhbHVlIGlzIHN1cHBvcnRlZCB3aGVuIHVzaW5nIG5vbi1uYXRpdmUgZGV0ZWN0aW9uCiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfGJvb2xlYW59IHJldHVybnMgdGhlIHN0cmluZyB2ZXJzaW9uIG9mIHRoZSBwcm9wZXJ0eSwgb3IgYGZhbHNlYCBpZiBpdCBpcyB1bnN1cHBvcnRlZAogICAgICogQGV4YW1wbGUKICAgICAqCiAgICAgKiB0ZXN0QWxsUHJvcHMgZGV0ZXJtaW5lcyB3aGV0aGVyIGEgZ2l2ZW4gQ1NTIHByb3BlcnR5LCBpbiBzb21lIHByZWZpeGVkIGZvcm0sCiAgICAgKiBpcyBzdXBwb3J0ZWQgYnkgdGhlIGJyb3dzZXIuCiAgICAgKgogICAgICogYGBganMKICAgICAqIHRlc3RBbGxQcm9wcygnYm94U2l6aW5nJykgIC8vIHRydWUKICAgICAqIGBgYAogICAgICoKICAgICAqIEl0IGNhbiBvcHRpb25hbGx5IGJlIGdpdmVuIGEgQ1NTIHZhbHVlIGluIHN0cmluZyBmb3JtIHRvIHRlc3QgaWYgYSBwcm9wZXJ0eQogICAgICogdmFsdWUgaXMgdmFsaWQKICAgICAqCiAgICAgKiBgYGBqcwogICAgICogdGVzdEFsbFByb3BzKCdkaXNwbGF5JywgJ2Jsb2NrJykgLy8gdHJ1ZQogICAgICogdGVzdEFsbFByb3BzKCdkaXNwbGF5JywgJ3Blbmd1aW4nKSAvLyBmYWxzZQogICAgICogYGBgCiAgICAgKgogICAgICogQSBib29sZWFuIGNhbiBiZSBwYXNzZWQgYXMgYSB0aGlyZCBwYXJhbWV0ZXIgdG8gc2tpcCB0aGUgdmFsdWUgY2hlY2sgd2hlbgogICAgICogbmF0aXZlIGRldGVjdGlvbiAoQHN1cHBvcnRzKSBpc24ndCBhdmFpbGFibGUuCiAgICAgKgogICAgICogYGBganMKICAgICAqIHRlc3RBbGxQcm9wcygnc2hhcGVPdXRzaWRlJywgJ2NvbnRlbnQtYm94JywgdHJ1ZSk7CiAgICAgKiBgYGAKICAgICAqLwoKICAgIGZ1bmN0aW9uIHRlc3RBbGxQcm9wcyhwcm9wLCB2YWx1ZSwgc2tpcFZhbHVlVGVzdCkgewogICAgICByZXR1cm4gdGVzdFByb3BzQWxsKHByb3AsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB2YWx1ZSwgc2tpcFZhbHVlVGVzdCk7CiAgICB9CgogICAgTW9kZXJuaXpyUHJvdG8udGVzdEFsbFByb3BzID0gdGVzdEFsbFByb3BzOwogICAgLyohCiAgICB7CiAgICAgICJuYW1lIjogIkJhY2tkcm9wIEZpbHRlciIsCiAgICAgICJwcm9wZXJ0eSI6ICJiYWNrZHJvcGZpbHRlciIsCiAgICAgICJhdXRob3JzIjogWyJCcmlhbiBTZXdhcmQiXSwKICAgICAgInRhZ3MiOiBbImNzcyJdLAogICAgICAiY2FuaXVzZSI6ICJjc3MtYmFja2Ryb3AtZmlsdGVyIiwKICAgICAgIm5vdGVzIjogW3sKICAgICAgICAibmFtZSI6ICJXM0MgRWRpdG9y4oCZcyBEcmFmdCBTcGVjIiwKICAgICAgICAiaHJlZiI6ICJodHRwczovL2RyYWZ0cy5meHRmLm9yZy9maWx0ZXJzLTIvI0JhY2tkcm9wRmlsdGVyUHJvcGVydHkiCiAgICAgIH0sIHsKICAgICAgICAibmFtZSI6ICJXZWJLaXQgQmxvZyBpbnRyb2R1Y3Rpb24gKyBEZW1vIiwKICAgICAgICAiaHJlZiI6ICJodHRwczovL3d3dy53ZWJraXQub3JnL2Jsb2cvMzYzMi9pbnRyb2R1Y2luZy1iYWNrZHJvcC1maWx0ZXJzLyIKICAgICAgfV0KICAgIH0KICAgICEqLwoKICAgIC8qIERPQwogICAgRGV0ZWN0cyBzdXBwb3J0IGZvciBDU1MgQmFja2Ryb3AgRmlsdGVycywgYWxsb3dpbmcgZm9yIGJhY2tncm91bmQgYmx1ciBlZmZlY3RzIGxpa2UgdGhvc2UgaW50cm9kdWNlZCBpbiBpT1MgNy4gU3VwcG9ydCBmb3IgdGhpcyB3YXMgYWRkZWQgdG8gaU9TIFNhZmFyaS9XZWJLaXQgaW4gaU9TIDkuCiAgICAqLwoKICAgIE1vZGVybml6ci5hZGRUZXN0KCdiYWNrZHJvcGZpbHRlcicsIHRlc3RBbGxQcm9wcygnYmFja2Ryb3BGaWx0ZXInKSk7IC8vIFJ1biBlYWNoIHRlc3QKCiAgICB0ZXN0UnVubmVyKCk7IC8vIFJlbW92ZSB0aGUgIm5vLWpzIiBjbGFzcyBpZiBpdCBleGlzdHMKCiAgICBzZXRDbGFzc2VzKGNsYXNzZXMpOwogICAgZGVsZXRlIE1vZGVybml6clByb3RvLmFkZFRlc3Q7CiAgICBkZWxldGUgTW9kZXJuaXpyUHJvdG8uYWRkQXN5bmNUZXN0OyAvLyBSdW4gdGhlIHRoaW5ncyB0aGF0IGFyZSBzdXBwb3NlZCB0byBydW4gYWZ0ZXIgdGhlIHRlc3RzCgogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBNb2Rlcm5penIuX3EubGVuZ3RoOyBpKyspIHsKICAgICAgTW9kZXJuaXpyLl9xW2ldKCk7CiAgICB9IC8vIExlYWsgTW9kZXJuaXpyIG5hbWVzcGFjZQoKCiAgICBzY3JpcHRHbG9iYWxPYmplY3QuTW9kZXJuaXpyID0gTW9kZXJuaXpyOwogICAgOwogIH0pKHdpbmRvdywgd2luZG93LCBkb2N1bWVudCk7CgogIG1vZHVsZS5leHBvcnRzID0gd2luZG93Lk1vZGVybml6cjsKCiAgaWYgKGhhZEdsb2JhbCkgewogICAgd2luZG93Lk1vZGVybml6ciA9IG9sZEdsb2JhbDsKICB9IGVsc2UgewogICAgZGVsZXRlIHdpbmRvdy5Nb2Rlcm5penI7CiAgfQp9KSh3aW5kb3cpOw=="},null]}