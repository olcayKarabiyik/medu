{"remainingRequest":"/wiki/node_modules/babel-loader/lib/index.js??ref--0-1!/wiki/client/libs/codemirror-merge/diff-match-patch.js","dependencies":[{"path":"/wiki/client/libs/codemirror-merge/diff-match-patch.js","mtime":1716084843949},{"path":"/wiki/.babelrc","mtime":1716084843827},{"path":"/wiki/node_modules/cache-loader/dist/cjs.js","mtime":1716088090639},{"path":"/wiki/node_modules/babel-loader/lib/index.js","mtime":1716088089693}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:dmFyIGRpZmZfbWF0Y2hfcGF0Y2ggPSBmdW5jdGlvbiAoKSB7CiAgdGhpcy5EaWZmX1RpbWVvdXQgPSAxOwogIHRoaXMuRGlmZl9FZGl0Q29zdCA9IDQ7CiAgdGhpcy5NYXRjaF9UaHJlc2hvbGQgPSAuNTsKICB0aGlzLk1hdGNoX0Rpc3RhbmNlID0gMUUzOwogIHRoaXMuUGF0Y2hfRGVsZXRlVGhyZXNob2xkID0gLjU7CiAgdGhpcy5QYXRjaF9NYXJnaW4gPSA0OwogIHRoaXMuTWF0Y2hfTWF4Qml0cyA9IDMyOwp9LAogICAgRElGRl9ERUxFVEUgPSAtMSwKICAgIERJRkZfSU5TRVJUID0gMSwKICAgIERJRkZfRVFVQUwgPSAwOwoKZGlmZl9tYXRjaF9wYXRjaC5EaWZmID0gZnVuY3Rpb24gKGEsIGIpIHsKICB0aGlzWzBdID0gYTsKICB0aGlzWzFdID0gYjsKfTsKCmRpZmZfbWF0Y2hfcGF0Y2guRGlmZi5wcm90b3R5cGUubGVuZ3RoID0gMjsKCmRpZmZfbWF0Y2hfcGF0Y2guRGlmZi5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIHRoaXNbMF0gKyAiLCIgKyB0aGlzWzFdOwp9OwoKZGlmZl9tYXRjaF9wYXRjaC5wcm90b3R5cGUuZGlmZl9tYWluID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHsKICAidW5kZWZpbmVkIiA9PSB0eXBlb2YgZCAmJiAoZCA9IDAgPj0gdGhpcy5EaWZmX1RpbWVvdXQgPyBOdW1iZXIuTUFYX1ZBTFVFIDogbmV3IERhdGUoKS5nZXRUaW1lKCkgKyAxRTMgKiB0aGlzLkRpZmZfVGltZW91dCk7CiAgaWYgKG51bGwgPT0gYSB8fCBudWxsID09IGIpIHRocm93IEVycm9yKCJOdWxsIGlucHV0LiAoZGlmZl9tYWluKSIpOwogIGlmIChhID09IGIpIHJldHVybiBhID8gW25ldyBkaWZmX21hdGNoX3BhdGNoLkRpZmYoRElGRl9FUVVBTCwgYSldIDogW107CiAgInVuZGVmaW5lZCIgPT0gdHlwZW9mIGMgJiYgKGMgPSAhMCk7CiAgdmFyIGUgPSBjLAogICAgICBmID0gdGhpcy5kaWZmX2NvbW1vblByZWZpeChhLCBiKTsKICBjID0gYS5zdWJzdHJpbmcoMCwgZik7CiAgYSA9IGEuc3Vic3RyaW5nKGYpOwogIGIgPSBiLnN1YnN0cmluZyhmKTsKICBmID0gdGhpcy5kaWZmX2NvbW1vblN1ZmZpeChhLCBiKTsKICB2YXIgZyA9IGEuc3Vic3RyaW5nKGEubGVuZ3RoIC0gZik7CiAgYSA9IGEuc3Vic3RyaW5nKDAsIGEubGVuZ3RoIC0gZik7CiAgYiA9IGIuc3Vic3RyaW5nKDAsIGIubGVuZ3RoIC0gZik7CiAgYSA9IHRoaXMuZGlmZl9jb21wdXRlXyhhLCBiLCBlLCBkKTsKICBjICYmIGEudW5zaGlmdChuZXcgZGlmZl9tYXRjaF9wYXRjaC5EaWZmKERJRkZfRVFVQUwsIGMpKTsKICBnICYmIGEucHVzaChuZXcgZGlmZl9tYXRjaF9wYXRjaC5EaWZmKERJRkZfRVFVQUwsIGcpKTsKICB0aGlzLmRpZmZfY2xlYW51cE1lcmdlKGEpOwogIHJldHVybiBhOwp9OwoKZGlmZl9tYXRjaF9wYXRjaC5wcm90b3R5cGUuZGlmZl9jb21wdXRlXyA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkKSB7CiAgaWYgKCFhKSByZXR1cm4gW25ldyBkaWZmX21hdGNoX3BhdGNoLkRpZmYoRElGRl9JTlNFUlQsIGIpXTsKICBpZiAoIWIpIHJldHVybiBbbmV3IGRpZmZfbWF0Y2hfcGF0Y2guRGlmZihESUZGX0RFTEVURSwgYSldOwogIHZhciBlID0gYS5sZW5ndGggPiBiLmxlbmd0aCA/IGEgOiBiLAogICAgICBmID0gYS5sZW5ndGggPiBiLmxlbmd0aCA/IGIgOiBhLAogICAgICBnID0gZS5pbmRleE9mKGYpOwogIHJldHVybiAtMSAhPSBnID8gKGMgPSBbbmV3IGRpZmZfbWF0Y2hfcGF0Y2guRGlmZihESUZGX0lOU0VSVCwgZS5zdWJzdHJpbmcoMCwgZykpLCBuZXcgZGlmZl9tYXRjaF9wYXRjaC5EaWZmKERJRkZfRVFVQUwsIGYpLCBuZXcgZGlmZl9tYXRjaF9wYXRjaC5EaWZmKERJRkZfSU5TRVJULCBlLnN1YnN0cmluZyhnICsgZi5sZW5ndGgpKV0sIGEubGVuZ3RoID4gYi5sZW5ndGggJiYgKGNbMF1bMF0gPSBjWzJdWzBdID0gRElGRl9ERUxFVEUpLCBjKSA6IDEgPT0gZi5sZW5ndGggPyBbbmV3IGRpZmZfbWF0Y2hfcGF0Y2guRGlmZihESUZGX0RFTEVURSwgYSksIG5ldyBkaWZmX21hdGNoX3BhdGNoLkRpZmYoRElGRl9JTlNFUlQsIGIpXSA6IChlID0gdGhpcy5kaWZmX2hhbGZNYXRjaF8oYSwgYikpID8gKGIgPSBlWzFdLCBmID0gZVszXSwgYSA9IGVbNF0sIGUgPSB0aGlzLmRpZmZfbWFpbihlWzBdLCBlWzJdLCBjLCBkKSwgYyA9IHRoaXMuZGlmZl9tYWluKGIsIGYsIGMsIGQpLCBlLmNvbmNhdChbbmV3IGRpZmZfbWF0Y2hfcGF0Y2guRGlmZihESUZGX0VRVUFMLCBhKV0sIGMpKSA6IGMgJiYgMTAwIDwgYS5sZW5ndGggJiYgMTAwIDwgYi5sZW5ndGggPyB0aGlzLmRpZmZfbGluZU1vZGVfKGEsIGIsIGQpIDogdGhpcy5kaWZmX2Jpc2VjdF8oYSwgYiwgZCk7Cn07CgpkaWZmX21hdGNoX3BhdGNoLnByb3RvdHlwZS5kaWZmX2xpbmVNb2RlXyA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7CiAgdmFyIGQgPSB0aGlzLmRpZmZfbGluZXNUb0NoYXJzXyhhLCBiKTsKICBhID0gZC5jaGFyczE7CiAgYiA9IGQuY2hhcnMyOwogIGQgPSBkLmxpbmVBcnJheTsKICBhID0gdGhpcy5kaWZmX21haW4oYSwgYiwgITEsIGMpOwogIHRoaXMuZGlmZl9jaGFyc1RvTGluZXNfKGEsIGQpOwogIHRoaXMuZGlmZl9jbGVhbnVwU2VtYW50aWMoYSk7CiAgYS5wdXNoKG5ldyBkaWZmX21hdGNoX3BhdGNoLkRpZmYoRElGRl9FUVVBTCwgIiIpKTsKCiAgZm9yICh2YXIgZSA9IGQgPSBiID0gMCwgZiA9ICIiLCBnID0gIiI7IGIgPCBhLmxlbmd0aDspIHsKICAgIHN3aXRjaCAoYVtiXVswXSkgewogICAgICBjYXNlIERJRkZfSU5TRVJUOgogICAgICAgIGUrKzsKICAgICAgICBnICs9IGFbYl1bMV07CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIERJRkZfREVMRVRFOgogICAgICAgIGQrKzsKICAgICAgICBmICs9IGFbYl1bMV07CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIERJRkZfRVFVQUw6CiAgICAgICAgaWYgKDEgPD0gZCAmJiAxIDw9IGUpIHsKICAgICAgICAgIGEuc3BsaWNlKGIgLSBkIC0gZSwgZCArIGUpOwogICAgICAgICAgYiA9IGIgLSBkIC0gZTsKICAgICAgICAgIGQgPSB0aGlzLmRpZmZfbWFpbihmLCBnLCAhMSwgYyk7CgogICAgICAgICAgZm9yIChlID0gZC5sZW5ndGggLSAxOyAwIDw9IGU7IGUtLSkgYS5zcGxpY2UoYiwgMCwgZFtlXSk7CgogICAgICAgICAgYiArPSBkLmxlbmd0aDsKICAgICAgICB9CgogICAgICAgIGQgPSBlID0gMDsKICAgICAgICBnID0gZiA9ICIiOwogICAgfQoKICAgIGIrKzsKICB9CgogIGEucG9wKCk7CiAgcmV0dXJuIGE7Cn07CgpkaWZmX21hdGNoX3BhdGNoLnByb3RvdHlwZS5kaWZmX2Jpc2VjdF8gPSBmdW5jdGlvbiAoYSwgYiwgYykgewogIGZvciAodmFyIGQgPSBhLmxlbmd0aCwgZSA9IGIubGVuZ3RoLCBmID0gTWF0aC5jZWlsKChkICsgZSkgLyAyKSwgZyA9IDIgKiBmLCBoID0gQXJyYXkoZyksIGwgPSBBcnJheShnKSwgayA9IDA7IGsgPCBnOyBrKyspIGhba10gPSAtMSwgbFtrXSA9IC0xOwoKICBoW2YgKyAxXSA9IDA7CiAgbFtmICsgMV0gPSAwOwogIGsgPSBkIC0gZTsKCiAgZm9yICh2YXIgbSA9IDAgIT0gayAlIDIsIHAgPSAwLCB4ID0gMCwgdyA9IDAsIHEgPSAwLCB0ID0gMDsgdCA8IGYgJiYgIShuZXcgRGF0ZSgpLmdldFRpbWUoKSA+IGMpOyB0KyspIHsKICAgIGZvciAodmFyIHYgPSAtdCArIHA7IHYgPD0gdCAtIHg7IHYgKz0gMikgewogICAgICB2YXIgbiA9IGYgKyB2OwogICAgICB2YXIgciA9IHYgPT0gLXQgfHwgdiAhPSB0ICYmIGhbbiAtIDFdIDwgaFtuICsgMV0gPyBoW24gKyAxXSA6IGhbbiAtIDFdICsgMTsKCiAgICAgIGZvciAodmFyIHkgPSByIC0gdjsgciA8IGQgJiYgeSA8IGUgJiYgYS5jaGFyQXQocikgPT0gYi5jaGFyQXQoeSk7KSByKyssIHkrKzsKCiAgICAgIGhbbl0gPSByOwogICAgICBpZiAociA+IGQpIHggKz0gMjtlbHNlIGlmICh5ID4gZSkgcCArPSAyO2Vsc2UgaWYgKG0gJiYgKG4gPSBmICsgayAtIHYsIDAgPD0gbiAmJiBuIDwgZyAmJiAtMSAhPSBsW25dKSkgewogICAgICAgIHZhciB1ID0gZCAtIGxbbl07CiAgICAgICAgaWYgKHIgPj0gdSkgcmV0dXJuIHRoaXMuZGlmZl9iaXNlY3RTcGxpdF8oYSwgYiwgciwgeSwgYyk7CiAgICAgIH0KICAgIH0KCiAgICBmb3IgKHYgPSAtdCArIHc7IHYgPD0gdCAtIHE7IHYgKz0gMikgewogICAgICBuID0gZiArIHY7CiAgICAgIHUgPSB2ID09IC10IHx8IHYgIT0gdCAmJiBsW24gLSAxXSA8IGxbbiArIDFdID8gbFtuICsgMV0gOiBsW24gLSAxXSArIDE7CgogICAgICBmb3IgKHIgPSB1IC0gdjsgdSA8IGQgJiYgciA8IGUgJiYgYS5jaGFyQXQoZCAtIHUgLSAxKSA9PSBiLmNoYXJBdChlIC0gciAtIDEpOykgdSsrLCByKys7CgogICAgICBsW25dID0gdTsKICAgICAgaWYgKHUgPiBkKSBxICs9IDI7ZWxzZSBpZiAociA+IGUpIHcgKz0gMjtlbHNlIGlmICghbSAmJiAobiA9IGYgKyBrIC0gdiwgMCA8PSBuICYmIG4gPCBnICYmIC0xICE9IGhbbl0gJiYgKHIgPSBoW25dLCB5ID0gZiArIHIgLSBuLCB1ID0gZCAtIHUsIHIgPj0gdSkpKSByZXR1cm4gdGhpcy5kaWZmX2Jpc2VjdFNwbGl0XyhhLCBiLCByLCB5LCBjKTsKICAgIH0KICB9CgogIHJldHVybiBbbmV3IGRpZmZfbWF0Y2hfcGF0Y2guRGlmZihESUZGX0RFTEVURSwgYSksIG5ldyBkaWZmX21hdGNoX3BhdGNoLkRpZmYoRElGRl9JTlNFUlQsIGIpXTsKfTsKCmRpZmZfbWF0Y2hfcGF0Y2gucHJvdG90eXBlLmRpZmZfYmlzZWN0U3BsaXRfID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQsIGUpIHsKICB2YXIgZiA9IGEuc3Vic3RyaW5nKDAsIGMpLAogICAgICBnID0gYi5zdWJzdHJpbmcoMCwgZCk7CiAgYSA9IGEuc3Vic3RyaW5nKGMpOwogIGIgPSBiLnN1YnN0cmluZyhkKTsKICBmID0gdGhpcy5kaWZmX21haW4oZiwgZywgITEsIGUpOwogIGUgPSB0aGlzLmRpZmZfbWFpbihhLCBiLCAhMSwgZSk7CiAgcmV0dXJuIGYuY29uY2F0KGUpOwp9OwoKZGlmZl9tYXRjaF9wYXRjaC5wcm90b3R5cGUuZGlmZl9saW5lc1RvQ2hhcnNfID0gZnVuY3Rpb24gKGEsIGIpIHsKICBmdW5jdGlvbiBjKGEpIHsKICAgIGZvciAodmFyIGIgPSAiIiwgYyA9IDAsIGcgPSAtMSwgaCA9IGQubGVuZ3RoOyBnIDwgYS5sZW5ndGggLSAxOykgewogICAgICBnID0gYS5pbmRleE9mKCJcbiIsIGMpOwogICAgICAtMSA9PSBnICYmIChnID0gYS5sZW5ndGggLSAxKTsKICAgICAgdmFyIGwgPSBhLnN1YnN0cmluZyhjLCBnICsgMSk7CiAgICAgIChlLmhhc093blByb3BlcnR5ID8gZS5oYXNPd25Qcm9wZXJ0eShsKSA6IHZvaWQgMCAhPT0gZVtsXSkgPyBiICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoZVtsXSkgOiAoaCA9PSBmICYmIChsID0gYS5zdWJzdHJpbmcoYyksIGcgPSBhLmxlbmd0aCksIGIgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShoKSwgZVtsXSA9IGgsIGRbaCsrXSA9IGwpOwogICAgICBjID0gZyArIDE7CiAgICB9CgogICAgcmV0dXJuIGI7CiAgfQoKICB2YXIgZCA9IFtdLAogICAgICBlID0ge307CiAgZFswXSA9ICIiOwogIHZhciBmID0gNEU0LAogICAgICBnID0gYyhhKTsKICBmID0gNjU1MzU7CiAgdmFyIGggPSBjKGIpOwogIHJldHVybiB7CiAgICBjaGFyczE6IGcsCiAgICBjaGFyczI6IGgsCiAgICBsaW5lQXJyYXk6IGQKICB9Owp9OwoKZGlmZl9tYXRjaF9wYXRjaC5wcm90b3R5cGUuZGlmZl9jaGFyc1RvTGluZXNfID0gZnVuY3Rpb24gKGEsIGIpIHsKICBmb3IgKHZhciBjID0gMDsgYyA8IGEubGVuZ3RoOyBjKyspIHsKICAgIGZvciAodmFyIGQgPSBhW2NdWzFdLCBlID0gW10sIGYgPSAwOyBmIDwgZC5sZW5ndGg7IGYrKykgZVtmXSA9IGJbZC5jaGFyQ29kZUF0KGYpXTsKCiAgICBhW2NdWzFdID0gZS5qb2luKCIiKTsKICB9Cn07CgpkaWZmX21hdGNoX3BhdGNoLnByb3RvdHlwZS5kaWZmX2NvbW1vblByZWZpeCA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgaWYgKCFhIHx8ICFiIHx8IGEuY2hhckF0KDApICE9IGIuY2hhckF0KDApKSByZXR1cm4gMDsKCiAgZm9yICh2YXIgYyA9IDAsIGQgPSBNYXRoLm1pbihhLmxlbmd0aCwgYi5sZW5ndGgpLCBlID0gZCwgZiA9IDA7IGMgPCBlOykgYS5zdWJzdHJpbmcoZiwgZSkgPT0gYi5zdWJzdHJpbmcoZiwgZSkgPyBmID0gYyA9IGUgOiBkID0gZSwgZSA9IE1hdGguZmxvb3IoKGQgLSBjKSAvIDIgKyBjKTsKCiAgcmV0dXJuIGU7Cn07CgpkaWZmX21hdGNoX3BhdGNoLnByb3RvdHlwZS5kaWZmX2NvbW1vblN1ZmZpeCA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgaWYgKCFhIHx8ICFiIHx8IGEuY2hhckF0KGEubGVuZ3RoIC0gMSkgIT0gYi5jaGFyQXQoYi5sZW5ndGggLSAxKSkgcmV0dXJuIDA7CgogIGZvciAodmFyIGMgPSAwLCBkID0gTWF0aC5taW4oYS5sZW5ndGgsIGIubGVuZ3RoKSwgZSA9IGQsIGYgPSAwOyBjIDwgZTspIGEuc3Vic3RyaW5nKGEubGVuZ3RoIC0gZSwgYS5sZW5ndGggLSBmKSA9PSBiLnN1YnN0cmluZyhiLmxlbmd0aCAtIGUsIGIubGVuZ3RoIC0gZikgPyBmID0gYyA9IGUgOiBkID0gZSwgZSA9IE1hdGguZmxvb3IoKGQgLSBjKSAvIDIgKyBjKTsKCiAgcmV0dXJuIGU7Cn07CgpkaWZmX21hdGNoX3BhdGNoLnByb3RvdHlwZS5kaWZmX2NvbW1vbk92ZXJsYXBfID0gZnVuY3Rpb24gKGEsIGIpIHsKICB2YXIgYyA9IGEubGVuZ3RoLAogICAgICBkID0gYi5sZW5ndGg7CiAgaWYgKDAgPT0gYyB8fCAwID09IGQpIHJldHVybiAwOwogIGMgPiBkID8gYSA9IGEuc3Vic3RyaW5nKGMgLSBkKSA6IGMgPCBkICYmIChiID0gYi5zdWJzdHJpbmcoMCwgYykpOwogIGMgPSBNYXRoLm1pbihjLCBkKTsKICBpZiAoYSA9PSBiKSByZXR1cm4gYzsKICBkID0gMDsKCiAgZm9yICh2YXIgZSA9IDE7OykgewogICAgdmFyIGYgPSBhLnN1YnN0cmluZyhjIC0gZSk7CiAgICBmID0gYi5pbmRleE9mKGYpOwogICAgaWYgKC0xID09IGYpIHJldHVybiBkOwogICAgZSArPSBmOwogICAgaWYgKDAgPT0gZiB8fCBhLnN1YnN0cmluZyhjIC0gZSkgPT0gYi5zdWJzdHJpbmcoMCwgZSkpIGQgPSBlLCBlKys7CiAgfQp9OwoKZGlmZl9tYXRjaF9wYXRjaC5wcm90b3R5cGUuZGlmZl9oYWxmTWF0Y2hfID0gZnVuY3Rpb24gKGEsIGIpIHsKICBmdW5jdGlvbiBjKGEsIGIsIGMpIHsKICAgIGZvciAodmFyIGQgPSBhLnN1YnN0cmluZyhjLCBjICsgTWF0aC5mbG9vcihhLmxlbmd0aCAvIDQpKSwgZSA9IC0xLCBnID0gIiIsIGgsIGssIGwsIG07IC0xICE9IChlID0gYi5pbmRleE9mKGQsIGUgKyAxKSk7KSB7CiAgICAgIHZhciBwID0gZi5kaWZmX2NvbW1vblByZWZpeChhLnN1YnN0cmluZyhjKSwgYi5zdWJzdHJpbmcoZSkpLAogICAgICAgICAgdSA9IGYuZGlmZl9jb21tb25TdWZmaXgoYS5zdWJzdHJpbmcoMCwgYyksIGIuc3Vic3RyaW5nKDAsIGUpKTsKICAgICAgZy5sZW5ndGggPCB1ICsgcCAmJiAoZyA9IGIuc3Vic3RyaW5nKGUgLSB1LCBlKSArIGIuc3Vic3RyaW5nKGUsIGUgKyBwKSwgaCA9IGEuc3Vic3RyaW5nKDAsIGMgLSB1KSwgayA9IGEuc3Vic3RyaW5nKGMgKyBwKSwgbCA9IGIuc3Vic3RyaW5nKDAsIGUgLSB1KSwgbSA9IGIuc3Vic3RyaW5nKGUgKyBwKSk7CiAgICB9CgogICAgcmV0dXJuIDIgKiBnLmxlbmd0aCA+PSBhLmxlbmd0aCA/IFtoLCBrLCBsLCBtLCBnXSA6IG51bGw7CiAgfQoKICBpZiAoMCA+PSB0aGlzLkRpZmZfVGltZW91dCkgcmV0dXJuIG51bGw7CiAgdmFyIGQgPSBhLmxlbmd0aCA+IGIubGVuZ3RoID8gYSA6IGIsCiAgICAgIGUgPSBhLmxlbmd0aCA+IGIubGVuZ3RoID8gYiA6IGE7CiAgaWYgKDQgPiBkLmxlbmd0aCB8fCAyICogZS5sZW5ndGggPCBkLmxlbmd0aCkgcmV0dXJuIG51bGw7CiAgdmFyIGYgPSB0aGlzLAogICAgICBnID0gYyhkLCBlLCBNYXRoLmNlaWwoZC5sZW5ndGggLyA0KSk7CiAgZCA9IGMoZCwgZSwgTWF0aC5jZWlsKGQubGVuZ3RoIC8gMikpOwogIGlmIChnIHx8IGQpIGcgPSBkID8gZyA/IGdbNF0ubGVuZ3RoID4gZFs0XS5sZW5ndGggPyBnIDogZCA6IGQgOiBnO2Vsc2UgcmV0dXJuIG51bGw7CgogIGlmIChhLmxlbmd0aCA+IGIubGVuZ3RoKSB7CiAgICBkID0gZ1swXTsKICAgIGUgPSBnWzFdOwogICAgdmFyIGggPSBnWzJdOwogICAgdmFyIGwgPSBnWzNdOwogIH0gZWxzZSBoID0gZ1swXSwgbCA9IGdbMV0sIGQgPSBnWzJdLCBlID0gZ1szXTsKCiAgcmV0dXJuIFtkLCBlLCBoLCBsLCBnWzRdXTsKfTsKCmRpZmZfbWF0Y2hfcGF0Y2gucHJvdG90eXBlLmRpZmZfY2xlYW51cFNlbWFudGljID0gZnVuY3Rpb24gKGEpIHsKICBmb3IgKHZhciBiID0gITEsIGMgPSBbXSwgZCA9IDAsIGUgPSBudWxsLCBmID0gMCwgZyA9IDAsIGggPSAwLCBsID0gMCwgayA9IDA7IGYgPCBhLmxlbmd0aDspIGFbZl1bMF0gPT0gRElGRl9FUVVBTCA/IChjW2QrK10gPSBmLCBnID0gbCwgaCA9IGssIGsgPSBsID0gMCwgZSA9IGFbZl1bMV0pIDogKGFbZl1bMF0gPT0gRElGRl9JTlNFUlQgPyBsICs9IGFbZl1bMV0ubGVuZ3RoIDogayArPSBhW2ZdWzFdLmxlbmd0aCwgZSAmJiBlLmxlbmd0aCA8PSBNYXRoLm1heChnLCBoKSAmJiBlLmxlbmd0aCA8PSBNYXRoLm1heChsLCBrKSAmJiAoYS5zcGxpY2UoY1tkIC0gMV0sIDAsIG5ldyBkaWZmX21hdGNoX3BhdGNoLkRpZmYoRElGRl9ERUxFVEUsIGUpKSwgYVtjW2QgLSAxXSArIDFdWzBdID0gRElGRl9JTlNFUlQsIGQtLSwgZC0tLCBmID0gMCA8IGQgPyBjW2QgLSAxXSA6IC0xLCBrID0gbCA9IGggPSBnID0gMCwgZSA9IG51bGwsIGIgPSAhMCkpLCBmKys7CgogIGIgJiYgdGhpcy5kaWZmX2NsZWFudXBNZXJnZShhKTsKICB0aGlzLmRpZmZfY2xlYW51cFNlbWFudGljTG9zc2xlc3MoYSk7CgogIGZvciAoZiA9IDE7IGYgPCBhLmxlbmd0aDspIHsKICAgIGlmIChhW2YgLSAxXVswXSA9PSBESUZGX0RFTEVURSAmJiBhW2ZdWzBdID09IERJRkZfSU5TRVJUKSB7CiAgICAgIGIgPSBhW2YgLSAxXVsxXTsKICAgICAgYyA9IGFbZl1bMV07CiAgICAgIGQgPSB0aGlzLmRpZmZfY29tbW9uT3ZlcmxhcF8oYiwgYyk7CiAgICAgIGUgPSB0aGlzLmRpZmZfY29tbW9uT3ZlcmxhcF8oYywgYik7CgogICAgICBpZiAoZCA+PSBlKSB7CiAgICAgICAgaWYgKGQgPj0gYi5sZW5ndGggLyAyIHx8IGQgPj0gYy5sZW5ndGggLyAyKSBhLnNwbGljZShmLCAwLCBuZXcgZGlmZl9tYXRjaF9wYXRjaC5EaWZmKERJRkZfRVFVQUwsIGMuc3Vic3RyaW5nKDAsIGQpKSksIGFbZiAtIDFdWzFdID0gYi5zdWJzdHJpbmcoMCwgYi5sZW5ndGggLSBkKSwgYVtmICsgMV1bMV0gPSBjLnN1YnN0cmluZyhkKSwgZisrOwogICAgICB9IGVsc2UgaWYgKGUgPj0gYi5sZW5ndGggLyAyIHx8IGUgPj0gYy5sZW5ndGggLyAyKSBhLnNwbGljZShmLCAwLCBuZXcgZGlmZl9tYXRjaF9wYXRjaC5EaWZmKERJRkZfRVFVQUwsIGIuc3Vic3RyaW5nKDAsIGUpKSksIGFbZiAtIDFdWzBdID0gRElGRl9JTlNFUlQsIGFbZiAtIDFdWzFdID0gYy5zdWJzdHJpbmcoMCwgYy5sZW5ndGggLSBlKSwgYVtmICsgMV1bMF0gPSBESUZGX0RFTEVURSwgYVtmICsgMV1bMV0gPSBiLnN1YnN0cmluZyhlKSwgZisrOwoKICAgICAgZisrOwogICAgfQoKICAgIGYrKzsKICB9Cn07CgpkaWZmX21hdGNoX3BhdGNoLnByb3RvdHlwZS5kaWZmX2NsZWFudXBTZW1hbnRpY0xvc3NsZXNzID0gZnVuY3Rpb24gKGEpIHsKICBmdW5jdGlvbiBiKGEsIGIpIHsKICAgIGlmICghYSB8fCAhYikgcmV0dXJuIDY7CiAgICB2YXIgYyA9IGEuY2hhckF0KGEubGVuZ3RoIC0gMSksCiAgICAgICAgZCA9IGIuY2hhckF0KDApLAogICAgICAgIGUgPSBjLm1hdGNoKGRpZmZfbWF0Y2hfcGF0Y2gubm9uQWxwaGFOdW1lcmljUmVnZXhfKSwKICAgICAgICBmID0gZC5tYXRjaChkaWZmX21hdGNoX3BhdGNoLm5vbkFscGhhTnVtZXJpY1JlZ2V4XyksCiAgICAgICAgZyA9IGUgJiYgYy5tYXRjaChkaWZmX21hdGNoX3BhdGNoLndoaXRlc3BhY2VSZWdleF8pLAogICAgICAgIGggPSBmICYmIGQubWF0Y2goZGlmZl9tYXRjaF9wYXRjaC53aGl0ZXNwYWNlUmVnZXhfKTsKICAgIGMgPSBnICYmIGMubWF0Y2goZGlmZl9tYXRjaF9wYXRjaC5saW5lYnJlYWtSZWdleF8pOwogICAgZCA9IGggJiYgZC5tYXRjaChkaWZmX21hdGNoX3BhdGNoLmxpbmVicmVha1JlZ2V4Xyk7CiAgICB2YXIgayA9IGMgJiYgYS5tYXRjaChkaWZmX21hdGNoX3BhdGNoLmJsYW5rbGluZUVuZFJlZ2V4XyksCiAgICAgICAgbCA9IGQgJiYgYi5tYXRjaChkaWZmX21hdGNoX3BhdGNoLmJsYW5rbGluZVN0YXJ0UmVnZXhfKTsKICAgIHJldHVybiBrIHx8IGwgPyA1IDogYyB8fCBkID8gNCA6IGUgJiYgIWcgJiYgaCA/IDMgOiBnIHx8IGggPyAyIDogZSB8fCBmID8gMSA6IDA7CiAgfQoKICBmb3IgKHZhciBjID0gMTsgYyA8IGEubGVuZ3RoIC0gMTspIHsKICAgIGlmIChhW2MgLSAxXVswXSA9PSBESUZGX0VRVUFMICYmIGFbYyArIDFdWzBdID09IERJRkZfRVFVQUwpIHsKICAgICAgdmFyIGQgPSBhW2MgLSAxXVsxXSwKICAgICAgICAgIGUgPSBhW2NdWzFdLAogICAgICAgICAgZiA9IGFbYyArIDFdWzFdLAogICAgICAgICAgZyA9IHRoaXMuZGlmZl9jb21tb25TdWZmaXgoZCwgZSk7CgogICAgICBpZiAoZykgewogICAgICAgIHZhciBoID0gZS5zdWJzdHJpbmcoZS5sZW5ndGggLSBnKTsKICAgICAgICBkID0gZC5zdWJzdHJpbmcoMCwgZC5sZW5ndGggLSBnKTsKICAgICAgICBlID0gaCArIGUuc3Vic3RyaW5nKDAsIGUubGVuZ3RoIC0gZyk7CiAgICAgICAgZiA9IGggKyBmOwogICAgICB9CgogICAgICBnID0gZDsKICAgICAgaCA9IGU7CgogICAgICBmb3IgKHZhciBsID0gZiwgayA9IGIoZCwgZSkgKyBiKGUsIGYpOyBlLmNoYXJBdCgwKSA9PT0gZi5jaGFyQXQoMCk7KSB7CiAgICAgICAgZCArPSBlLmNoYXJBdCgwKTsKICAgICAgICBlID0gZS5zdWJzdHJpbmcoMSkgKyBmLmNoYXJBdCgwKTsKICAgICAgICBmID0gZi5zdWJzdHJpbmcoMSk7CiAgICAgICAgdmFyIG0gPSBiKGQsIGUpICsgYihlLCBmKTsKICAgICAgICBtID49IGsgJiYgKGsgPSBtLCBnID0gZCwgaCA9IGUsIGwgPSBmKTsKICAgICAgfQoKICAgICAgYVtjIC0gMV1bMV0gIT0gZyAmJiAoZyA/IGFbYyAtIDFdWzFdID0gZyA6IChhLnNwbGljZShjIC0gMSwgMSksIGMtLSksIGFbY11bMV0gPSBoLCBsID8gYVtjICsgMV1bMV0gPSBsIDogKGEuc3BsaWNlKGMgKyAxLCAxKSwgYy0tKSk7CiAgICB9CgogICAgYysrOwogIH0KfTsKCmRpZmZfbWF0Y2hfcGF0Y2gubm9uQWxwaGFOdW1lcmljUmVnZXhfID0gL1teYS16QS1aMC05XS87CmRpZmZfbWF0Y2hfcGF0Y2gud2hpdGVzcGFjZVJlZ2V4XyA9IC9ccy87CmRpZmZfbWF0Y2hfcGF0Y2gubGluZWJyZWFrUmVnZXhfID0gL1tcclxuXS87CmRpZmZfbWF0Y2hfcGF0Y2guYmxhbmtsaW5lRW5kUmVnZXhfID0gL1xuXHI/XG4kLzsKZGlmZl9tYXRjaF9wYXRjaC5ibGFua2xpbmVTdGFydFJlZ2V4XyA9IC9eXHI/XG5ccj9cbi87CgpkaWZmX21hdGNoX3BhdGNoLnByb3RvdHlwZS5kaWZmX2NsZWFudXBFZmZpY2llbmN5ID0gZnVuY3Rpb24gKGEpIHsKICBmb3IgKHZhciBiID0gITEsIGMgPSBbXSwgZCA9IDAsIGUgPSBudWxsLCBmID0gMCwgZyA9ICExLCBoID0gITEsIGwgPSAhMSwgayA9ICExOyBmIDwgYS5sZW5ndGg7KSBhW2ZdWzBdID09IERJRkZfRVFVQUwgPyAoYVtmXVsxXS5sZW5ndGggPCB0aGlzLkRpZmZfRWRpdENvc3QgJiYgKGwgfHwgaykgPyAoY1tkKytdID0gZiwgZyA9IGwsIGggPSBrLCBlID0gYVtmXVsxXSkgOiAoZCA9IDAsIGUgPSBudWxsKSwgbCA9IGsgPSAhMSkgOiAoYVtmXVswXSA9PSBESUZGX0RFTEVURSA/IGsgPSAhMCA6IGwgPSAhMCwgZSAmJiAoZyAmJiBoICYmIGwgJiYgayB8fCBlLmxlbmd0aCA8IHRoaXMuRGlmZl9FZGl0Q29zdCAvIDIgJiYgMyA9PSBnICsgaCArIGwgKyBrKSAmJiAoYS5zcGxpY2UoY1tkIC0gMV0sIDAsIG5ldyBkaWZmX21hdGNoX3BhdGNoLkRpZmYoRElGRl9ERUxFVEUsIGUpKSwgYVtjW2QgLSAxXSArIDFdWzBdID0gRElGRl9JTlNFUlQsIGQtLSwgZSA9IG51bGwsIGcgJiYgaCA/IChsID0gayA9ICEwLCBkID0gMCkgOiAoZC0tLCBmID0gMCA8IGQgPyBjW2QgLSAxXSA6IC0xLCBsID0gayA9ICExKSwgYiA9ICEwKSksIGYrKzsKCiAgYiAmJiB0aGlzLmRpZmZfY2xlYW51cE1lcmdlKGEpOwp9OwoKZGlmZl9tYXRjaF9wYXRjaC5wcm90b3R5cGUuZGlmZl9jbGVhbnVwTWVyZ2UgPSBmdW5jdGlvbiAoYSkgewogIGEucHVzaChuZXcgZGlmZl9tYXRjaF9wYXRjaC5EaWZmKERJRkZfRVFVQUwsICIiKSk7CgogIGZvciAodmFyIGIgPSAwLCBjID0gMCwgZCA9IDAsIGUgPSAiIiwgZiA9ICIiLCBnOyBiIDwgYS5sZW5ndGg7KSBzd2l0Y2ggKGFbYl1bMF0pIHsKICAgIGNhc2UgRElGRl9JTlNFUlQ6CiAgICAgIGQrKzsKICAgICAgZiArPSBhW2JdWzFdOwogICAgICBiKys7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgRElGRl9ERUxFVEU6CiAgICAgIGMrKzsKICAgICAgZSArPSBhW2JdWzFdOwogICAgICBiKys7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgRElGRl9FUVVBTDoKICAgICAgMSA8IGMgKyBkID8gKDAgIT09IGMgJiYgMCAhPT0gZCAmJiAoZyA9IHRoaXMuZGlmZl9jb21tb25QcmVmaXgoZiwgZSksIDAgIT09IGcgJiYgKDAgPCBiIC0gYyAtIGQgJiYgYVtiIC0gYyAtIGQgLSAxXVswXSA9PSBESUZGX0VRVUFMID8gYVtiIC0gYyAtIGQgLSAxXVsxXSArPSBmLnN1YnN0cmluZygwLCBnKSA6IChhLnNwbGljZSgwLCAwLCBuZXcgZGlmZl9tYXRjaF9wYXRjaC5EaWZmKERJRkZfRVFVQUwsIGYuc3Vic3RyaW5nKDAsIGcpKSksIGIrKyksIGYgPSBmLnN1YnN0cmluZyhnKSwgZSA9IGUuc3Vic3RyaW5nKGcpKSwgZyA9IHRoaXMuZGlmZl9jb21tb25TdWZmaXgoZiwgZSksIDAgIT09IGcgJiYgKGFbYl1bMV0gPSBmLnN1YnN0cmluZyhmLmxlbmd0aCAtIGcpICsgYVtiXVsxXSwgZiA9IGYuc3Vic3RyaW5nKDAsIGYubGVuZ3RoIC0gZyksIGUgPSBlLnN1YnN0cmluZygwLCBlLmxlbmd0aCAtIGcpKSksIGIgLT0gYyArIGQsIGEuc3BsaWNlKGIsIGMgKyBkKSwgZS5sZW5ndGggJiYgKGEuc3BsaWNlKGIsIDAsIG5ldyBkaWZmX21hdGNoX3BhdGNoLkRpZmYoRElGRl9ERUxFVEUsIGUpKSwgYisrKSwgZi5sZW5ndGggJiYgKGEuc3BsaWNlKGIsIDAsIG5ldyBkaWZmX21hdGNoX3BhdGNoLkRpZmYoRElGRl9JTlNFUlQsIGYpKSwgYisrKSwgYisrKSA6IDAgIT09IGIgJiYgYVtiIC0gMV1bMF0gPT0gRElGRl9FUVVBTCA/IChhW2IgLSAxXVsxXSArPSBhW2JdWzFdLCBhLnNwbGljZShiLCAxKSkgOiBiKyssIGMgPSBkID0gMCwgZiA9IGUgPSAiIjsKICB9CgogICIiID09PSBhW2EubGVuZ3RoIC0gMV1bMV0gJiYgYS5wb3AoKTsKICBjID0gITE7CgogIGZvciAoYiA9IDE7IGIgPCBhLmxlbmd0aCAtIDE7KSBhW2IgLSAxXVswXSA9PSBESUZGX0VRVUFMICYmIGFbYiArIDFdWzBdID09IERJRkZfRVFVQUwgJiYgKGFbYl1bMV0uc3Vic3RyaW5nKGFbYl1bMV0ubGVuZ3RoIC0gYVtiIC0gMV1bMV0ubGVuZ3RoKSA9PSBhW2IgLSAxXVsxXSA/IChhW2JdWzFdID0gYVtiIC0gMV1bMV0gKyBhW2JdWzFdLnN1YnN0cmluZygwLCBhW2JdWzFdLmxlbmd0aCAtIGFbYiAtIDFdWzFdLmxlbmd0aCksIGFbYiArIDFdWzFdID0gYVtiIC0gMV1bMV0gKyBhW2IgKyAxXVsxXSwgYS5zcGxpY2UoYiAtIDEsIDEpLCBjID0gITApIDogYVtiXVsxXS5zdWJzdHJpbmcoMCwgYVtiICsgMV1bMV0ubGVuZ3RoKSA9PSBhW2IgKyAxXVsxXSAmJiAoYVtiIC0gMV1bMV0gKz0gYVtiICsgMV1bMV0sIGFbYl1bMV0gPSBhW2JdWzFdLnN1YnN0cmluZyhhW2IgKyAxXVsxXS5sZW5ndGgpICsgYVtiICsgMV1bMV0sIGEuc3BsaWNlKGIgKyAxLCAxKSwgYyA9ICEwKSksIGIrKzsKCiAgYyAmJiB0aGlzLmRpZmZfY2xlYW51cE1lcmdlKGEpOwp9OwoKZGlmZl9tYXRjaF9wYXRjaC5wcm90b3R5cGUuZGlmZl94SW5kZXggPSBmdW5jdGlvbiAoYSwgYikgewogIHZhciBjID0gMCwKICAgICAgZCA9IDAsCiAgICAgIGUgPSAwLAogICAgICBmID0gMCwKICAgICAgZzsKCiAgZm9yIChnID0gMDsgZyA8IGEubGVuZ3RoOyBnKyspIHsKICAgIGFbZ11bMF0gIT09IERJRkZfSU5TRVJUICYmIChjICs9IGFbZ11bMV0ubGVuZ3RoKTsKICAgIGFbZ11bMF0gIT09IERJRkZfREVMRVRFICYmIChkICs9IGFbZ11bMV0ubGVuZ3RoKTsKICAgIGlmIChjID4gYikgYnJlYWs7CiAgICBlID0gYzsKICAgIGYgPSBkOwogIH0KCiAgcmV0dXJuIGEubGVuZ3RoICE9IGcgJiYgYVtnXVswXSA9PT0gRElGRl9ERUxFVEUgPyBmIDogZiArIChiIC0gZSk7Cn07CgpkaWZmX21hdGNoX3BhdGNoLnByb3RvdHlwZS5kaWZmX3ByZXR0eUh0bWwgPSBmdW5jdGlvbiAoYSkgewogIGZvciAodmFyIGIgPSBbXSwgYyA9IC8mL2csIGQgPSAvPC9nLCBlID0gLz4vZywgZiA9IC9cbi9nLCBnID0gMDsgZyA8IGEubGVuZ3RoOyBnKyspIHsKICAgIHZhciBoID0gYVtnXVswXSwKICAgICAgICBsID0gYVtnXVsxXS5yZXBsYWNlKGMsICImYW1wOyIpLnJlcGxhY2UoZCwgIiZsdDsiKS5yZXBsYWNlKGUsICImZ3Q7IikucmVwbGFjZShmLCAiJnBhcmE7PGJyPiIpOwoKICAgIHN3aXRjaCAoaCkgewogICAgICBjYXNlIERJRkZfSU5TRVJUOgogICAgICAgIGJbZ10gPSAnPGlucyBzdHlsZT0iYmFja2dyb3VuZDojZTZmZmU2OyI+JyArIGwgKyAiPC9pbnM+IjsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgRElGRl9ERUxFVEU6CiAgICAgICAgYltnXSA9ICc8ZGVsIHN0eWxlPSJiYWNrZ3JvdW5kOiNmZmU2ZTY7Ij4nICsgbCArICI8L2RlbD4iOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSBESUZGX0VRVUFMOgogICAgICAgIGJbZ10gPSAiPHNwYW4+IiArIGwgKyAiPC9zcGFuPiI7CiAgICB9CiAgfQoKICByZXR1cm4gYi5qb2luKCIiKTsKfTsKCmRpZmZfbWF0Y2hfcGF0Y2gucHJvdG90eXBlLmRpZmZfdGV4dDEgPSBmdW5jdGlvbiAoYSkgewogIGZvciAodmFyIGIgPSBbXSwgYyA9IDA7IGMgPCBhLmxlbmd0aDsgYysrKSBhW2NdWzBdICE9PSBESUZGX0lOU0VSVCAmJiAoYltjXSA9IGFbY11bMV0pOwoKICByZXR1cm4gYi5qb2luKCIiKTsKfTsKCmRpZmZfbWF0Y2hfcGF0Y2gucHJvdG90eXBlLmRpZmZfdGV4dDIgPSBmdW5jdGlvbiAoYSkgewogIGZvciAodmFyIGIgPSBbXSwgYyA9IDA7IGMgPCBhLmxlbmd0aDsgYysrKSBhW2NdWzBdICE9PSBESUZGX0RFTEVURSAmJiAoYltjXSA9IGFbY11bMV0pOwoKICByZXR1cm4gYi5qb2luKCIiKTsKfTsKCmRpZmZfbWF0Y2hfcGF0Y2gucHJvdG90eXBlLmRpZmZfbGV2ZW5zaHRlaW4gPSBmdW5jdGlvbiAoYSkgewogIGZvciAodmFyIGIgPSAwLCBjID0gMCwgZCA9IDAsIGUgPSAwOyBlIDwgYS5sZW5ndGg7IGUrKykgewogICAgdmFyIGYgPSBhW2VdWzFdOwoKICAgIHN3aXRjaCAoYVtlXVswXSkgewogICAgICBjYXNlIERJRkZfSU5TRVJUOgogICAgICAgIGMgKz0gZi5sZW5ndGg7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIERJRkZfREVMRVRFOgogICAgICAgIGQgKz0gZi5sZW5ndGg7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIERJRkZfRVFVQUw6CiAgICAgICAgYiArPSBNYXRoLm1heChjLCBkKSwgZCA9IGMgPSAwOwogICAgfQogIH0KCiAgcmV0dXJuIGIgKz0gTWF0aC5tYXgoYywgZCk7Cn07CgpkaWZmX21hdGNoX3BhdGNoLnByb3RvdHlwZS5kaWZmX3RvRGVsdGEgPSBmdW5jdGlvbiAoYSkgewogIGZvciAodmFyIGIgPSBbXSwgYyA9IDA7IGMgPCBhLmxlbmd0aDsgYysrKSBzd2l0Y2ggKGFbY11bMF0pIHsKICAgIGNhc2UgRElGRl9JTlNFUlQ6CiAgICAgIGJbY10gPSAiKyIgKyBlbmNvZGVVUkkoYVtjXVsxXSk7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgRElGRl9ERUxFVEU6CiAgICAgIGJbY10gPSAiLSIgKyBhW2NdWzFdLmxlbmd0aDsKICAgICAgYnJlYWs7CgogICAgY2FzZSBESUZGX0VRVUFMOgogICAgICBiW2NdID0gIj0iICsgYVtjXVsxXS5sZW5ndGg7CiAgfQoKICByZXR1cm4gYi5qb2luKCJcdCIpLnJlcGxhY2UoLyUyMC9nLCAiICIpOwp9OwoKZGlmZl9tYXRjaF9wYXRjaC5wcm90b3R5cGUuZGlmZl9mcm9tRGVsdGEgPSBmdW5jdGlvbiAoYSwgYikgewogIGZvciAodmFyIGMgPSBbXSwgZCA9IDAsIGUgPSAwLCBmID0gYi5zcGxpdCgvXHQvZyksIGcgPSAwOyBnIDwgZi5sZW5ndGg7IGcrKykgewogICAgdmFyIGggPSBmW2ddLnN1YnN0cmluZygxKTsKCiAgICBzd2l0Y2ggKGZbZ10uY2hhckF0KDApKSB7CiAgICAgIGNhc2UgIisiOgogICAgICAgIHRyeSB7CiAgICAgICAgICBjW2QrK10gPSBuZXcgZGlmZl9tYXRjaF9wYXRjaC5EaWZmKERJRkZfSU5TRVJULCBkZWNvZGVVUkkoaCkpOwogICAgICAgIH0gY2F0Y2ggKGspIHsKICAgICAgICAgIHRocm93IEVycm9yKCJJbGxlZ2FsIGVzY2FwZSBpbiBkaWZmX2Zyb21EZWx0YTogIiArIGgpOwogICAgICAgIH0KCiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICItIjoKICAgICAgY2FzZSAiPSI6CiAgICAgICAgdmFyIGwgPSBwYXJzZUludChoLCAxMCk7CiAgICAgICAgaWYgKGlzTmFOKGwpIHx8IDAgPiBsKSB0aHJvdyBFcnJvcigiSW52YWxpZCBudW1iZXIgaW4gZGlmZl9mcm9tRGVsdGE6ICIgKyBoKTsKICAgICAgICBoID0gYS5zdWJzdHJpbmcoZSwgZSArPSBsKTsKICAgICAgICAiPSIgPT0gZltnXS5jaGFyQXQoMCkgPyBjW2QrK10gPSBuZXcgZGlmZl9tYXRjaF9wYXRjaC5EaWZmKERJRkZfRVFVQUwsIGgpIDogY1tkKytdID0gbmV3IGRpZmZfbWF0Y2hfcGF0Y2guRGlmZihESUZGX0RFTEVURSwgaCk7CiAgICAgICAgYnJlYWs7CgogICAgICBkZWZhdWx0OgogICAgICAgIGlmIChmW2ddKSB0aHJvdyBFcnJvcigiSW52YWxpZCBkaWZmIG9wZXJhdGlvbiBpbiBkaWZmX2Zyb21EZWx0YTogIiArIGZbZ10pOwogICAgfQogIH0KCiAgaWYgKGUgIT0gYS5sZW5ndGgpIHRocm93IEVycm9yKCJEZWx0YSBsZW5ndGggKCIgKyBlICsgIikgZG9lcyBub3QgZXF1YWwgc291cmNlIHRleHQgbGVuZ3RoICgiICsgYS5sZW5ndGggKyAiKS4iKTsKICByZXR1cm4gYzsKfTsKCmRpZmZfbWF0Y2hfcGF0Y2gucHJvdG90eXBlLm1hdGNoX21haW4gPSBmdW5jdGlvbiAoYSwgYiwgYykgewogIGlmIChudWxsID09IGEgfHwgbnVsbCA9PSBiIHx8IG51bGwgPT0gYykgdGhyb3cgRXJyb3IoIk51bGwgaW5wdXQuIChtYXRjaF9tYWluKSIpOwogIGMgPSBNYXRoLm1heCgwLCBNYXRoLm1pbihjLCBhLmxlbmd0aCkpOwogIHJldHVybiBhID09IGIgPyAwIDogYS5sZW5ndGggPyBhLnN1YnN0cmluZyhjLCBjICsgYi5sZW5ndGgpID09IGIgPyBjIDogdGhpcy5tYXRjaF9iaXRhcF8oYSwgYiwgYykgOiAtMTsKfTsKCmRpZmZfbWF0Y2hfcGF0Y2gucHJvdG90eXBlLm1hdGNoX2JpdGFwXyA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7CiAgZnVuY3Rpb24gZChhLCBkKSB7CiAgICB2YXIgZSA9IGEgLyBiLmxlbmd0aCwKICAgICAgICBnID0gTWF0aC5hYnMoYyAtIGQpOwogICAgcmV0dXJuIGYuTWF0Y2hfRGlzdGFuY2UgPyBlICsgZyAvIGYuTWF0Y2hfRGlzdGFuY2UgOiBnID8gMSA6IGU7CiAgfQoKICBpZiAoYi5sZW5ndGggPiB0aGlzLk1hdGNoX01heEJpdHMpIHRocm93IEVycm9yKCJQYXR0ZXJuIHRvbyBsb25nIGZvciB0aGlzIGJyb3dzZXIuIik7CiAgdmFyIGUgPSB0aGlzLm1hdGNoX2FscGhhYmV0XyhiKSwKICAgICAgZiA9IHRoaXMsCiAgICAgIGcgPSB0aGlzLk1hdGNoX1RocmVzaG9sZCwKICAgICAgaCA9IGEuaW5kZXhPZihiLCBjKTsKICAtMSAhPSBoICYmIChnID0gTWF0aC5taW4oZCgwLCBoKSwgZyksIGggPSBhLmxhc3RJbmRleE9mKGIsIGMgKyBiLmxlbmd0aCksIC0xICE9IGggJiYgKGcgPSBNYXRoLm1pbihkKDAsIGgpLCBnKSkpOwogIHZhciBsID0gMSA8PCBiLmxlbmd0aCAtIDE7CiAgaCA9IC0xOwoKICBmb3IgKHZhciBrLCBtLCBwID0gYi5sZW5ndGggKyBhLmxlbmd0aCwgeCwgdyA9IDA7IHcgPCBiLmxlbmd0aDsgdysrKSB7CiAgICBrID0gMDsKCiAgICBmb3IgKG0gPSBwOyBrIDwgbTspIGQodywgYyArIG0pIDw9IGcgPyBrID0gbSA6IHAgPSBtLCBtID0gTWF0aC5mbG9vcigocCAtIGspIC8gMiArIGspOwoKICAgIHAgPSBtOwogICAgayA9IE1hdGgubWF4KDEsIGMgLSBtICsgMSk7CiAgICB2YXIgcSA9IE1hdGgubWluKGMgKyBtLCBhLmxlbmd0aCkgKyBiLmxlbmd0aDsKICAgIG0gPSBBcnJheShxICsgMik7CgogICAgZm9yIChtW3EgKyAxXSA9ICgxIDw8IHcpIC0gMTsgcSA+PSBrOyBxLS0pIHsKICAgICAgdmFyIHQgPSBlW2EuY2hhckF0KHEgLSAxKV07CiAgICAgIG1bcV0gPSAwID09PSB3ID8gKG1bcSArIDFdIDw8IDEgfCAxKSAmIHQgOiAobVtxICsgMV0gPDwgMSB8IDEpICYgdCB8ICh4W3EgKyAxXSB8IHhbcV0pIDw8IDEgfCAxIHwgeFtxICsgMV07CiAgICAgIGlmIChtW3FdICYgbCAmJiAodCA9IGQodywgcSAtIDEpLCB0IDw9IGcpKSBpZiAoZyA9IHQsIGggPSBxIC0gMSwgaCA+IGMpIGsgPSBNYXRoLm1heCgxLCAyICogYyAtIGgpO2Vsc2UgYnJlYWs7CiAgICB9CgogICAgaWYgKGQodyArIDEsIGMpID4gZykgYnJlYWs7CiAgICB4ID0gbTsKICB9CgogIHJldHVybiBoOwp9OwoKZGlmZl9tYXRjaF9wYXRjaC5wcm90b3R5cGUubWF0Y2hfYWxwaGFiZXRfID0gZnVuY3Rpb24gKGEpIHsKICBmb3IgKHZhciBiID0ge30sIGMgPSAwOyBjIDwgYS5sZW5ndGg7IGMrKykgYlthLmNoYXJBdChjKV0gPSAwOwoKICBmb3IgKGMgPSAwOyBjIDwgYS5sZW5ndGg7IGMrKykgYlthLmNoYXJBdChjKV0gfD0gMSA8PCBhLmxlbmd0aCAtIGMgLSAxOwoKICByZXR1cm4gYjsKfTsKCmRpZmZfbWF0Y2hfcGF0Y2gucHJvdG90eXBlLnBhdGNoX2FkZENvbnRleHRfID0gZnVuY3Rpb24gKGEsIGIpIHsKICBpZiAoMCAhPSBiLmxlbmd0aCkgewogICAgaWYgKG51bGwgPT09IGEuc3RhcnQyKSB0aHJvdyBFcnJvcigicGF0Y2ggbm90IGluaXRpYWxpemVkIik7CgogICAgZm9yICh2YXIgYyA9IGIuc3Vic3RyaW5nKGEuc3RhcnQyLCBhLnN0YXJ0MiArIGEubGVuZ3RoMSksIGQgPSAwOyBiLmluZGV4T2YoYykgIT0gYi5sYXN0SW5kZXhPZihjKSAmJiBjLmxlbmd0aCA8IHRoaXMuTWF0Y2hfTWF4Qml0cyAtIHRoaXMuUGF0Y2hfTWFyZ2luIC0gdGhpcy5QYXRjaF9NYXJnaW47KSBkICs9IHRoaXMuUGF0Y2hfTWFyZ2luLCBjID0gYi5zdWJzdHJpbmcoYS5zdGFydDIgLSBkLCBhLnN0YXJ0MiArIGEubGVuZ3RoMSArIGQpOwoKICAgIGQgKz0gdGhpcy5QYXRjaF9NYXJnaW47CiAgICAoYyA9IGIuc3Vic3RyaW5nKGEuc3RhcnQyIC0gZCwgYS5zdGFydDIpKSAmJiBhLmRpZmZzLnVuc2hpZnQobmV3IGRpZmZfbWF0Y2hfcGF0Y2guRGlmZihESUZGX0VRVUFMLCBjKSk7CiAgICAoZCA9IGIuc3Vic3RyaW5nKGEuc3RhcnQyICsgYS5sZW5ndGgxLCBhLnN0YXJ0MiArIGEubGVuZ3RoMSArIGQpKSAmJiBhLmRpZmZzLnB1c2gobmV3IGRpZmZfbWF0Y2hfcGF0Y2guRGlmZihESUZGX0VRVUFMLCBkKSk7CiAgICBhLnN0YXJ0MSAtPSBjLmxlbmd0aDsKICAgIGEuc3RhcnQyIC09IGMubGVuZ3RoOwogICAgYS5sZW5ndGgxICs9IGMubGVuZ3RoICsgZC5sZW5ndGg7CiAgICBhLmxlbmd0aDIgKz0gYy5sZW5ndGggKyBkLmxlbmd0aDsKICB9Cn07CgpkaWZmX21hdGNoX3BhdGNoLnByb3RvdHlwZS5wYXRjaF9tYWtlID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsKICBpZiAoInN0cmluZyIgPT0gdHlwZW9mIGEgJiYgInN0cmluZyIgPT0gdHlwZW9mIGIgJiYgInVuZGVmaW5lZCIgPT0gdHlwZW9mIGMpIHsKICAgIHZhciBkID0gYTsKICAgIGIgPSB0aGlzLmRpZmZfbWFpbihkLCBiLCAhMCk7CiAgICAyIDwgYi5sZW5ndGggJiYgKHRoaXMuZGlmZl9jbGVhbnVwU2VtYW50aWMoYiksIHRoaXMuZGlmZl9jbGVhbnVwRWZmaWNpZW5jeShiKSk7CiAgfSBlbHNlIGlmIChhICYmICJvYmplY3QiID09IHR5cGVvZiBhICYmICJ1bmRlZmluZWQiID09IHR5cGVvZiBiICYmICJ1bmRlZmluZWQiID09IHR5cGVvZiBjKSBiID0gYSwgZCA9IHRoaXMuZGlmZl90ZXh0MShiKTtlbHNlIGlmICgic3RyaW5nIiA9PSB0eXBlb2YgYSAmJiBiICYmICJvYmplY3QiID09IHR5cGVvZiBiICYmICJ1bmRlZmluZWQiID09IHR5cGVvZiBjKSBkID0gYTtlbHNlIGlmICgic3RyaW5nIiA9PSB0eXBlb2YgYSAmJiAic3RyaW5nIiA9PSB0eXBlb2YgYiAmJiBjICYmICJvYmplY3QiID09IHR5cGVvZiBjKSBkID0gYSwgYiA9IGM7ZWxzZSB0aHJvdyBFcnJvcigiVW5rbm93biBjYWxsIGZvcm1hdCB0byBwYXRjaF9tYWtlLiIpOwoKICBpZiAoMCA9PT0gYi5sZW5ndGgpIHJldHVybiBbXTsKICBjID0gW107CiAgYSA9IG5ldyBkaWZmX21hdGNoX3BhdGNoLnBhdGNoX29iaigpOwoKICBmb3IgKHZhciBlID0gMCwgZiA9IDAsIGcgPSAwLCBoID0gZCwgbCA9IDA7IGwgPCBiLmxlbmd0aDsgbCsrKSB7CiAgICB2YXIgayA9IGJbbF1bMF0sCiAgICAgICAgbSA9IGJbbF1bMV07CiAgICBlIHx8IGsgPT09IERJRkZfRVFVQUwgfHwgKGEuc3RhcnQxID0gZiwgYS5zdGFydDIgPSBnKTsKCiAgICBzd2l0Y2ggKGspIHsKICAgICAgY2FzZSBESUZGX0lOU0VSVDoKICAgICAgICBhLmRpZmZzW2UrK10gPSBiW2xdOwogICAgICAgIGEubGVuZ3RoMiArPSBtLmxlbmd0aDsKICAgICAgICBkID0gZC5zdWJzdHJpbmcoMCwgZykgKyBtICsgZC5zdWJzdHJpbmcoZyk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIERJRkZfREVMRVRFOgogICAgICAgIGEubGVuZ3RoMSArPSBtLmxlbmd0aDsKICAgICAgICBhLmRpZmZzW2UrK10gPSBiW2xdOwogICAgICAgIGQgPSBkLnN1YnN0cmluZygwLCBnKSArIGQuc3Vic3RyaW5nKGcgKyBtLmxlbmd0aCk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIERJRkZfRVFVQUw6CiAgICAgICAgbS5sZW5ndGggPD0gMiAqIHRoaXMuUGF0Y2hfTWFyZ2luICYmIGUgJiYgYi5sZW5ndGggIT0gbCArIDEgPyAoYS5kaWZmc1tlKytdID0gYltsXSwgYS5sZW5ndGgxICs9IG0ubGVuZ3RoLCBhLmxlbmd0aDIgKz0gbS5sZW5ndGgpIDogbS5sZW5ndGggPj0gMiAqIHRoaXMuUGF0Y2hfTWFyZ2luICYmIGUgJiYgKHRoaXMucGF0Y2hfYWRkQ29udGV4dF8oYSwgaCksIGMucHVzaChhKSwgYSA9IG5ldyBkaWZmX21hdGNoX3BhdGNoLnBhdGNoX29iaigpLCBlID0gMCwgaCA9IGQsIGYgPSBnKTsKICAgIH0KCiAgICBrICE9PSBESUZGX0lOU0VSVCAmJiAoZiArPSBtLmxlbmd0aCk7CiAgICBrICE9PSBESUZGX0RFTEVURSAmJiAoZyArPSBtLmxlbmd0aCk7CiAgfQoKICBlICYmICh0aGlzLnBhdGNoX2FkZENvbnRleHRfKGEsIGgpLCBjLnB1c2goYSkpOwogIHJldHVybiBjOwp9OwoKZGlmZl9tYXRjaF9wYXRjaC5wcm90b3R5cGUucGF0Y2hfZGVlcENvcHkgPSBmdW5jdGlvbiAoYSkgewogIGZvciAodmFyIGIgPSBbXSwgYyA9IDA7IGMgPCBhLmxlbmd0aDsgYysrKSB7CiAgICB2YXIgZCA9IGFbY10sCiAgICAgICAgZSA9IG5ldyBkaWZmX21hdGNoX3BhdGNoLnBhdGNoX29iaigpOwogICAgZS5kaWZmcyA9IFtdOwoKICAgIGZvciAodmFyIGYgPSAwOyBmIDwgZC5kaWZmcy5sZW5ndGg7IGYrKykgZS5kaWZmc1tmXSA9IG5ldyBkaWZmX21hdGNoX3BhdGNoLkRpZmYoZC5kaWZmc1tmXVswXSwgZC5kaWZmc1tmXVsxXSk7CgogICAgZS5zdGFydDEgPSBkLnN0YXJ0MTsKICAgIGUuc3RhcnQyID0gZC5zdGFydDI7CiAgICBlLmxlbmd0aDEgPSBkLmxlbmd0aDE7CiAgICBlLmxlbmd0aDIgPSBkLmxlbmd0aDI7CiAgICBiW2NdID0gZTsKICB9CgogIHJldHVybiBiOwp9OwoKZGlmZl9tYXRjaF9wYXRjaC5wcm90b3R5cGUucGF0Y2hfYXBwbHkgPSBmdW5jdGlvbiAoYSwgYikgewogIGlmICgwID09IGEubGVuZ3RoKSByZXR1cm4gW2IsIFtdXTsKICBhID0gdGhpcy5wYXRjaF9kZWVwQ29weShhKTsKICB2YXIgYyA9IHRoaXMucGF0Y2hfYWRkUGFkZGluZyhhKTsKICBiID0gYyArIGIgKyBjOwogIHRoaXMucGF0Y2hfc3BsaXRNYXgoYSk7CgogIGZvciAodmFyIGQgPSAwLCBlID0gW10sIGYgPSAwOyBmIDwgYS5sZW5ndGg7IGYrKykgewogICAgdmFyIGcgPSBhW2ZdLnN0YXJ0MiArIGQsCiAgICAgICAgaCA9IHRoaXMuZGlmZl90ZXh0MShhW2ZdLmRpZmZzKSwKICAgICAgICBsID0gLTE7CgogICAgaWYgKGgubGVuZ3RoID4gdGhpcy5NYXRjaF9NYXhCaXRzKSB7CiAgICAgIHZhciBrID0gdGhpcy5tYXRjaF9tYWluKGIsIGguc3Vic3RyaW5nKDAsIHRoaXMuTWF0Y2hfTWF4Qml0cyksIGcpOwogICAgICAtMSAhPSBrICYmIChsID0gdGhpcy5tYXRjaF9tYWluKGIsIGguc3Vic3RyaW5nKGgubGVuZ3RoIC0gdGhpcy5NYXRjaF9NYXhCaXRzKSwgZyArIGgubGVuZ3RoIC0gdGhpcy5NYXRjaF9NYXhCaXRzKSwgLTEgPT0gbCB8fCBrID49IGwpICYmIChrID0gLTEpOwogICAgfSBlbHNlIGsgPSB0aGlzLm1hdGNoX21haW4oYiwgaCwgZyk7CgogICAgaWYgKC0xID09IGspIGVbZl0gPSAhMSwgZCAtPSBhW2ZdLmxlbmd0aDIgLSBhW2ZdLmxlbmd0aDE7ZWxzZSBpZiAoZVtmXSA9ICEwLCBkID0gayAtIGcsIGcgPSAtMSA9PSBsID8gYi5zdWJzdHJpbmcoaywgayArIGgubGVuZ3RoKSA6IGIuc3Vic3RyaW5nKGssIGwgKyB0aGlzLk1hdGNoX01heEJpdHMpLCBoID09IGcpIGIgPSBiLnN1YnN0cmluZygwLCBrKSArIHRoaXMuZGlmZl90ZXh0MihhW2ZdLmRpZmZzKSArIGIuc3Vic3RyaW5nKGsgKyBoLmxlbmd0aCk7ZWxzZSBpZiAoZyA9IHRoaXMuZGlmZl9tYWluKGgsIGcsICExKSwgaC5sZW5ndGggPiB0aGlzLk1hdGNoX01heEJpdHMgJiYgdGhpcy5kaWZmX2xldmVuc2h0ZWluKGcpIC8gaC5sZW5ndGggPiB0aGlzLlBhdGNoX0RlbGV0ZVRocmVzaG9sZCkgZVtmXSA9ICExO2Vsc2UgewogICAgICB0aGlzLmRpZmZfY2xlYW51cFNlbWFudGljTG9zc2xlc3MoZyk7CiAgICAgIGggPSAwOwogICAgICB2YXIgbTsKCiAgICAgIGZvciAobCA9IDA7IGwgPCBhW2ZdLmRpZmZzLmxlbmd0aDsgbCsrKSB7CiAgICAgICAgdmFyIHAgPSBhW2ZdLmRpZmZzW2xdOwogICAgICAgIHBbMF0gIT09IERJRkZfRVFVQUwgJiYgKG0gPSB0aGlzLmRpZmZfeEluZGV4KGcsIGgpKTsKICAgICAgICBwWzBdID09PSBESUZGX0lOU0VSVCA/IGIgPSBiLnN1YnN0cmluZygwLCBrICsgbSkgKyBwWzFdICsgYi5zdWJzdHJpbmcoayArIG0pIDogcFswXSA9PT0gRElGRl9ERUxFVEUgJiYgKGIgPSBiLnN1YnN0cmluZygwLCBrICsgbSkgKyBiLnN1YnN0cmluZyhrICsgdGhpcy5kaWZmX3hJbmRleChnLCBoICsgcFsxXS5sZW5ndGgpKSk7CiAgICAgICAgcFswXSAhPT0gRElGRl9ERUxFVEUgJiYgKGggKz0gcFsxXS5sZW5ndGgpOwogICAgICB9CiAgICB9CiAgfQoKICBiID0gYi5zdWJzdHJpbmcoYy5sZW5ndGgsIGIubGVuZ3RoIC0gYy5sZW5ndGgpOwogIHJldHVybiBbYiwgZV07Cn07CgpkaWZmX21hdGNoX3BhdGNoLnByb3RvdHlwZS5wYXRjaF9hZGRQYWRkaW5nID0gZnVuY3Rpb24gKGEpIHsKICBmb3IgKHZhciBiID0gdGhpcy5QYXRjaF9NYXJnaW4sIGMgPSAiIiwgZCA9IDE7IGQgPD0gYjsgZCsrKSBjICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoZCk7CgogIGZvciAoZCA9IDA7IGQgPCBhLmxlbmd0aDsgZCsrKSBhW2RdLnN0YXJ0MSArPSBiLCBhW2RdLnN0YXJ0MiArPSBiOwoKICBkID0gYVswXTsKICB2YXIgZSA9IGQuZGlmZnM7CiAgaWYgKDAgPT0gZS5sZW5ndGggfHwgZVswXVswXSAhPSBESUZGX0VRVUFMKSBlLnVuc2hpZnQobmV3IGRpZmZfbWF0Y2hfcGF0Y2guRGlmZihESUZGX0VRVUFMLCBjKSksIGQuc3RhcnQxIC09IGIsIGQuc3RhcnQyIC09IGIsIGQubGVuZ3RoMSArPSBiLCBkLmxlbmd0aDIgKz0gYjtlbHNlIGlmIChiID4gZVswXVsxXS5sZW5ndGgpIHsKICAgIHZhciBmID0gYiAtIGVbMF1bMV0ubGVuZ3RoOwogICAgZVswXVsxXSA9IGMuc3Vic3RyaW5nKGVbMF1bMV0ubGVuZ3RoKSArIGVbMF1bMV07CiAgICBkLnN0YXJ0MSAtPSBmOwogICAgZC5zdGFydDIgLT0gZjsKICAgIGQubGVuZ3RoMSArPSBmOwogICAgZC5sZW5ndGgyICs9IGY7CiAgfQogIGQgPSBhW2EubGVuZ3RoIC0gMV07CiAgZSA9IGQuZGlmZnM7CiAgMCA9PSBlLmxlbmd0aCB8fCBlW2UubGVuZ3RoIC0gMV1bMF0gIT0gRElGRl9FUVVBTCA/IChlLnB1c2gobmV3IGRpZmZfbWF0Y2hfcGF0Y2guRGlmZihESUZGX0VRVUFMLCBjKSksIGQubGVuZ3RoMSArPSBiLCBkLmxlbmd0aDIgKz0gYikgOiBiID4gZVtlLmxlbmd0aCAtIDFdWzFdLmxlbmd0aCAmJiAoZiA9IGIgLSBlW2UubGVuZ3RoIC0gMV1bMV0ubGVuZ3RoLCBlW2UubGVuZ3RoIC0gMV1bMV0gKz0gYy5zdWJzdHJpbmcoMCwgZiksIGQubGVuZ3RoMSArPSBmLCBkLmxlbmd0aDIgKz0gZik7CiAgcmV0dXJuIGM7Cn07CgpkaWZmX21hdGNoX3BhdGNoLnByb3RvdHlwZS5wYXRjaF9zcGxpdE1heCA9IGZ1bmN0aW9uIChhKSB7CiAgZm9yICh2YXIgYiA9IHRoaXMuTWF0Y2hfTWF4Qml0cywgYyA9IDA7IGMgPCBhLmxlbmd0aDsgYysrKSBpZiAoIShhW2NdLmxlbmd0aDEgPD0gYikpIHsKICAgIHZhciBkID0gYVtjXTsKICAgIGEuc3BsaWNlKGMtLSwgMSk7CgogICAgZm9yICh2YXIgZSA9IGQuc3RhcnQxLCBmID0gZC5zdGFydDIsIGcgPSAiIjsgMCAhPT0gZC5kaWZmcy5sZW5ndGg7KSB7CiAgICAgIHZhciBoID0gbmV3IGRpZmZfbWF0Y2hfcGF0Y2gucGF0Y2hfb2JqKCksCiAgICAgICAgICBsID0gITA7CiAgICAgIGguc3RhcnQxID0gZSAtIGcubGVuZ3RoOwogICAgICBoLnN0YXJ0MiA9IGYgLSBnLmxlbmd0aDsKICAgICAgIiIgIT09IGcgJiYgKGgubGVuZ3RoMSA9IGgubGVuZ3RoMiA9IGcubGVuZ3RoLCBoLmRpZmZzLnB1c2gobmV3IGRpZmZfbWF0Y2hfcGF0Y2guRGlmZihESUZGX0VRVUFMLCBnKSkpOwoKICAgICAgZm9yICg7IDAgIT09IGQuZGlmZnMubGVuZ3RoICYmIGgubGVuZ3RoMSA8IGIgLSB0aGlzLlBhdGNoX01hcmdpbjspIHsKICAgICAgICBnID0gZC5kaWZmc1swXVswXTsKICAgICAgICB2YXIgayA9IGQuZGlmZnNbMF1bMV07CiAgICAgICAgZyA9PT0gRElGRl9JTlNFUlQgPyAoaC5sZW5ndGgyICs9IGsubGVuZ3RoLCBmICs9IGsubGVuZ3RoLCBoLmRpZmZzLnB1c2goZC5kaWZmcy5zaGlmdCgpKSwgbCA9ICExKSA6IGcgPT09IERJRkZfREVMRVRFICYmIDEgPT0gaC5kaWZmcy5sZW5ndGggJiYgaC5kaWZmc1swXVswXSA9PSBESUZGX0VRVUFMICYmIGsubGVuZ3RoID4gMiAqIGIgPyAoaC5sZW5ndGgxICs9IGsubGVuZ3RoLCBlICs9IGsubGVuZ3RoLCBsID0gITEsIGguZGlmZnMucHVzaChuZXcgZGlmZl9tYXRjaF9wYXRjaC5EaWZmKGcsIGspKSwgZC5kaWZmcy5zaGlmdCgpKSA6IChrID0gay5zdWJzdHJpbmcoMCwgYiAtIGgubGVuZ3RoMSAtIHRoaXMuUGF0Y2hfTWFyZ2luKSwgaC5sZW5ndGgxICs9IGsubGVuZ3RoLCBlICs9IGsubGVuZ3RoLCBnID09PSBESUZGX0VRVUFMID8gKGgubGVuZ3RoMiArPSBrLmxlbmd0aCwgZiArPSBrLmxlbmd0aCkgOiBsID0gITEsIGguZGlmZnMucHVzaChuZXcgZGlmZl9tYXRjaF9wYXRjaC5EaWZmKGcsIGspKSwgayA9PSBkLmRpZmZzWzBdWzFdID8gZC5kaWZmcy5zaGlmdCgpIDogZC5kaWZmc1swXVsxXSA9IGQuZGlmZnNbMF1bMV0uc3Vic3RyaW5nKGsubGVuZ3RoKSk7CiAgICAgIH0KCiAgICAgIGcgPSB0aGlzLmRpZmZfdGV4dDIoaC5kaWZmcyk7CiAgICAgIGcgPSBnLnN1YnN0cmluZyhnLmxlbmd0aCAtIHRoaXMuUGF0Y2hfTWFyZ2luKTsKICAgICAgayA9IHRoaXMuZGlmZl90ZXh0MShkLmRpZmZzKS5zdWJzdHJpbmcoMCwgdGhpcy5QYXRjaF9NYXJnaW4pOwogICAgICAiIiAhPT0gayAmJiAoaC5sZW5ndGgxICs9IGsubGVuZ3RoLCBoLmxlbmd0aDIgKz0gay5sZW5ndGgsIDAgIT09IGguZGlmZnMubGVuZ3RoICYmIGguZGlmZnNbaC5kaWZmcy5sZW5ndGggLSAxXVswXSA9PT0gRElGRl9FUVVBTCA/IGguZGlmZnNbaC5kaWZmcy5sZW5ndGggLSAxXVsxXSArPSBrIDogaC5kaWZmcy5wdXNoKG5ldyBkaWZmX21hdGNoX3BhdGNoLkRpZmYoRElGRl9FUVVBTCwgaykpKTsKICAgICAgbCB8fCBhLnNwbGljZSgrK2MsIDAsIGgpOwogICAgfQogIH0KfTsKCmRpZmZfbWF0Y2hfcGF0Y2gucHJvdG90eXBlLnBhdGNoX3RvVGV4dCA9IGZ1bmN0aW9uIChhKSB7CiAgZm9yICh2YXIgYiA9IFtdLCBjID0gMDsgYyA8IGEubGVuZ3RoOyBjKyspIGJbY10gPSBhW2NdOwoKICByZXR1cm4gYi5qb2luKCIiKTsKfTsKCmRpZmZfbWF0Y2hfcGF0Y2gucHJvdG90eXBlLnBhdGNoX2Zyb21UZXh0ID0gZnVuY3Rpb24gKGEpIHsKICB2YXIgYiA9IFtdOwogIGlmICghYSkgcmV0dXJuIGI7CiAgYSA9IGEuc3BsaXQoIlxuIik7CgogIGZvciAodmFyIGMgPSAwLCBkID0gL15AQCAtKFxkKyksPyhcZCopIFwrKFxkKyksPyhcZCopIEBAJC87IGMgPCBhLmxlbmd0aDspIHsKICAgIHZhciBlID0gYVtjXS5tYXRjaChkKTsKICAgIGlmICghZSkgdGhyb3cgRXJyb3IoIkludmFsaWQgcGF0Y2ggc3RyaW5nOiAiICsgYVtjXSk7CiAgICB2YXIgZiA9IG5ldyBkaWZmX21hdGNoX3BhdGNoLnBhdGNoX29iaigpOwogICAgYi5wdXNoKGYpOwogICAgZi5zdGFydDEgPSBwYXJzZUludChlWzFdLCAxMCk7CiAgICAiIiA9PT0gZVsyXSA/IChmLnN0YXJ0MS0tLCBmLmxlbmd0aDEgPSAxKSA6ICIwIiA9PSBlWzJdID8gZi5sZW5ndGgxID0gMCA6IChmLnN0YXJ0MS0tLCBmLmxlbmd0aDEgPSBwYXJzZUludChlWzJdLCAxMCkpOwogICAgZi5zdGFydDIgPSBwYXJzZUludChlWzNdLCAxMCk7CiAgICAiIiA9PT0gZVs0XSA/IChmLnN0YXJ0Mi0tLCBmLmxlbmd0aDIgPSAxKSA6ICIwIiA9PSBlWzRdID8gZi5sZW5ndGgyID0gMCA6IChmLnN0YXJ0Mi0tLCBmLmxlbmd0aDIgPSBwYXJzZUludChlWzRdLCAxMCkpOwoKICAgIGZvciAoYysrOyBjIDwgYS5sZW5ndGg7KSB7CiAgICAgIGUgPSBhW2NdLmNoYXJBdCgwKTsKCiAgICAgIHRyeSB7CiAgICAgICAgdmFyIGcgPSBkZWNvZGVVUkkoYVtjXS5zdWJzdHJpbmcoMSkpOwogICAgICB9IGNhdGNoIChoKSB7CiAgICAgICAgdGhyb3cgRXJyb3IoIklsbGVnYWwgZXNjYXBlIGluIHBhdGNoX2Zyb21UZXh0OiAiICsgZyk7CiAgICAgIH0KCiAgICAgIGlmICgiLSIgPT0gZSkgZi5kaWZmcy5wdXNoKG5ldyBkaWZmX21hdGNoX3BhdGNoLkRpZmYoRElGRl9ERUxFVEUsIGcpKTtlbHNlIGlmICgiKyIgPT0gZSkgZi5kaWZmcy5wdXNoKG5ldyBkaWZmX21hdGNoX3BhdGNoLkRpZmYoRElGRl9JTlNFUlQsIGcpKTtlbHNlIGlmICgiICIgPT0gZSkgZi5kaWZmcy5wdXNoKG5ldyBkaWZmX21hdGNoX3BhdGNoLkRpZmYoRElGRl9FUVVBTCwgZykpO2Vsc2UgaWYgKCJAIiA9PSBlKSBicmVhaztlbHNlIGlmICgiIiAhPT0gZSkgdGhyb3cgRXJyb3IoJ0ludmFsaWQgcGF0Y2ggbW9kZSAiJyArIGUgKyAnIiBpbjogJyArIGcpOwogICAgICBjKys7CiAgICB9CiAgfQoKICByZXR1cm4gYjsKfTsKCmRpZmZfbWF0Y2hfcGF0Y2gucGF0Y2hfb2JqID0gZnVuY3Rpb24gKCkgewogIHRoaXMuZGlmZnMgPSBbXTsKICB0aGlzLnN0YXJ0MiA9IHRoaXMuc3RhcnQxID0gbnVsbDsKICB0aGlzLmxlbmd0aDIgPSB0aGlzLmxlbmd0aDEgPSAwOwp9OwoKZGlmZl9tYXRjaF9wYXRjaC5wYXRjaF9vYmoucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewogIGZvciAodmFyIGEgPSBbIkBAIC0iICsgKDAgPT09IHRoaXMubGVuZ3RoMSA/IHRoaXMuc3RhcnQxICsgIiwwIiA6IDEgPT0gdGhpcy5sZW5ndGgxID8gdGhpcy5zdGFydDEgKyAxIDogdGhpcy5zdGFydDEgKyAxICsgIiwiICsgdGhpcy5sZW5ndGgxKSArICIgKyIgKyAoMCA9PT0gdGhpcy5sZW5ndGgyID8gdGhpcy5zdGFydDIgKyAiLDAiIDogMSA9PSB0aGlzLmxlbmd0aDIgPyB0aGlzLnN0YXJ0MiArIDEgOiB0aGlzLnN0YXJ0MiArIDEgKyAiLCIgKyB0aGlzLmxlbmd0aDIpICsgIiBAQFxuIl0sIGIsIGMgPSAwOyBjIDwgdGhpcy5kaWZmcy5sZW5ndGg7IGMrKykgewogICAgc3dpdGNoICh0aGlzLmRpZmZzW2NdWzBdKSB7CiAgICAgIGNhc2UgRElGRl9JTlNFUlQ6CiAgICAgICAgYiA9ICIrIjsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgRElGRl9ERUxFVEU6CiAgICAgICAgYiA9ICItIjsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgRElGRl9FUVVBTDoKICAgICAgICBiID0gIiAiOwogICAgfQoKICAgIGFbYyArIDFdID0gYiArIGVuY29kZVVSSSh0aGlzLmRpZmZzW2NdWzFdKSArICJcbiI7CiAgfQoKICByZXR1cm4gYS5qb2luKCIiKS5yZXBsYWNlKC8lMjAvZywgIiAiKTsKfTsKCnRoaXMuZGlmZl9tYXRjaF9wYXRjaCA9IGRpZmZfbWF0Y2hfcGF0Y2g7CnRoaXMuRElGRl9ERUxFVEUgPSBESUZGX0RFTEVURTsKdGhpcy5ESUZGX0lOU0VSVCA9IERJRkZfSU5TRVJUOwp0aGlzLkRJRkZfRVFVQUwgPSBESUZGX0VRVUFMOwp3aW5kb3cuZGlmZl9tYXRjaF9wYXRjaCA9IGRpZmZfbWF0Y2hfcGF0Y2g7CndpbmRvdy5ESUZGX0lOU0VSVCA9IERJRkZfSU5TRVJUOwp3aW5kb3cuRElGRl9ERUxFVEUgPSBESUZGX0RFTEVURTsKd2luZG93LkRJRkZfRVFVQUwgPSBESUZGX0VRVUFMOw=="},null]}