{"remainingRequest":"/wiki/node_modules/babel-loader/lib/index.js??ref--0-1!/wiki/node_modules/vue-loader/lib/index.js??vue-loader-options!/wiki/client/components/editor/editor-markdown.vue?vue&type=script&lang=js&","dependencies":[{"path":"/wiki/client/components/editor/editor-markdown.vue","mtime":1716084843880},{"path":"/wiki/.babelrc","mtime":1716084843827},{"path":"/wiki/node_modules/cache-loader/dist/cjs.js","mtime":1716088090639},{"path":"/wiki/node_modules/babel-loader/lib/index.js","mtime":1716088089693},{"path":"/wiki/node_modules/vue-loader/lib/index.js","mtime":1716088146939}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9zZXQgZnJvbSAibG9kYXNoL3NldCI7CmltcG9ydCBfZmluZExhc3QgZnJvbSAibG9kYXNoL2ZpbmRMYXN0IjsKaW1wb3J0IF9sYXN0IGZyb20gImxvZGFzaC9sYXN0IjsKaW1wb3J0IF9mbGF0dGVuIGZyb20gImxvZGFzaC9mbGF0dGVuIjsKaW1wb3J0IF9nZXQgZnJvbSAibG9kYXNoL2dldCI7CmltcG9ydCBfdGltZXMgZnJvbSAibG9kYXNoL3RpbWVzIjsKaW1wb3J0IF9zdGFydHNXaXRoIGZyb20gImxvZGFzaC9zdGFydHNXaXRoIjsKaW1wb3J0IF9kZWJvdW5jZSBmcm9tICJsb2Rhc2gvZGVib3VuY2UiOwppbXBvcnQgX2VzY2FwZSBmcm9tICJsb2Rhc2gvZXNjYXBlIjsKaW1wb3J0IHsgZ2V0LCBzeW5jIH0gZnJvbSAndnVleC1wYXRoaWZ5JzsKaW1wb3J0IG1hcmtkb3duSGVscCBmcm9tICcuL21hcmtkb3duL2hlbHAudnVlJzsKaW1wb3J0IERPTVB1cmlmeSBmcm9tICdkb21wdXJpZnknOwovKiBnbG9iYWwgc2l0ZUNvbmZpZywgc2l0ZUxhbmdzICovCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gSU1QT1JUUwovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIENvZGUgTWlycm9yCgppbXBvcnQgQ29kZU1pcnJvciBmcm9tICdjb2RlbWlycm9yJzsKaW1wb3J0ICdjb2RlbWlycm9yL2xpYi9jb2RlbWlycm9yLmNzcyc7IC8vIExhbmd1YWdlCgppbXBvcnQgJ2NvZGVtaXJyb3IvbW9kZS9tYXJrZG93bi9tYXJrZG93bi5qcyc7IC8vIEFkZG9ucwoKaW1wb3J0ICdjb2RlbWlycm9yL2FkZG9uL3NlbGVjdGlvbi9hY3RpdmUtbGluZS5qcyc7CmltcG9ydCAnY29kZW1pcnJvci9hZGRvbi9kaXNwbGF5L2Z1bGxzY3JlZW4uanMnOwppbXBvcnQgJ2NvZGVtaXJyb3IvYWRkb24vZGlzcGxheS9mdWxsc2NyZWVuLmNzcyc7CmltcG9ydCAnY29kZW1pcnJvci9hZGRvbi9zZWxlY3Rpb24vbWFyay1zZWxlY3Rpb24uanMnOwppbXBvcnQgJ2NvZGVtaXJyb3IvYWRkb24vc2VhcmNoL3NlYXJjaGN1cnNvci5qcyc7CmltcG9ydCAnY29kZW1pcnJvci9hZGRvbi9oaW50L3Nob3ctaGludC5qcyc7CmltcG9ydCAnY29kZW1pcnJvci9hZGRvbi9mb2xkL2ZvbGRjb2RlLmpzJzsKaW1wb3J0ICdjb2RlbWlycm9yL2FkZG9uL2ZvbGQvZm9sZGd1dHRlci5qcyc7CmltcG9ydCAnY29kZW1pcnJvci9hZGRvbi9mb2xkL2ZvbGRndXR0ZXIuY3NzJzsgLy8gTWFya2Rvd24taXQKCmltcG9ydCBNYXJrZG93bkl0IGZyb20gJ21hcmtkb3duLWl0JzsKaW1wb3J0IG1kQXR0cnMgZnJvbSAnbWFya2Rvd24taXQtYXR0cnMnOwppbXBvcnQgbWREZWNvcmF0ZSBmcm9tICdtYXJrZG93bi1pdC1kZWNvcmF0ZSc7CmltcG9ydCB7IGZ1bGwgYXMgbWRFbW9qaSB9IGZyb20gJ21hcmtkb3duLWl0LWVtb2ppJzsKaW1wb3J0IG1kVGFza0xpc3RzIGZyb20gJ21hcmtkb3duLWl0LXRhc2stbGlzdHMnOwppbXBvcnQgbWRFeHBhbmRUYWJzIGZyb20gJ21hcmtkb3duLWl0LWV4cGFuZC10YWJzJzsKaW1wb3J0IG1kQWJiciBmcm9tICdtYXJrZG93bi1pdC1hYmJyJzsKaW1wb3J0IG1kU3VwIGZyb20gJ21hcmtkb3duLWl0LXN1cCc7CmltcG9ydCBtZFN1YiBmcm9tICdtYXJrZG93bi1pdC1zdWInOwppbXBvcnQgbWRNYXJrIGZyb20gJ21hcmtkb3duLWl0LW1hcmsnOwppbXBvcnQgbWRNdWx0aVRhYmxlIGZyb20gJ21hcmtkb3duLWl0LW11bHRpbWQtdGFibGUnOwppbXBvcnQgbWRGb290bm90ZSBmcm9tICdtYXJrZG93bi1pdC1mb290bm90ZSc7CmltcG9ydCBtZEltc2l6ZSBmcm9tICdtYXJrZG93bi1pdC1pbXNpemUnOwppbXBvcnQga2F0ZXggZnJvbSAna2F0ZXgnOwppbXBvcnQgdW5kZXJsaW5lIGZyb20gJy4uLy4uL2xpYnMvbWFya2Rvd24taXQtdW5kZXJsaW5lJzsKaW1wb3J0ICdrYXRleC9kaXN0L2NvbnRyaWIvbWhjaGVtJzsKaW1wb3J0IHR3ZW1vamkgZnJvbSAndHdlbW9qaSc7CmltcG9ydCBwbGFudHVtbCBmcm9tICcuL21hcmtkb3duL3BsYW50dW1sJzsgLy8gUHJpc20gKFN5bnRheCBIaWdobGlnaHRpbmcpCgppbXBvcnQgUHJpc20gZnJvbSAicHJpc21qcy9jb21wb25lbnRzL3ByaXNtLWNvcmUiOyAvLyBNZXJtYWlkCgppbXBvcnQgInByaXNtanMvY29tcG9uZW50cy9wcmlzbS1jbGlrZSI7CmltcG9ydCAicHJpc21qcy9jb21wb25lbnRzL3ByaXNtLW1hcmt1cCI7CmltcG9ydCAicHJpc21qcy9wbHVnaW5zL2xpbmUtbnVtYmVycy9wcmlzbS1saW5lLW51bWJlcnMuY3NzIjsKaW1wb3J0ICJwcmlzbWpzL3BsdWdpbnMvbGluZS1udW1iZXJzL3ByaXNtLWxpbmUtbnVtYmVycyI7CmltcG9ydCAicHJpc21qcy9wbHVnaW5zL2F1dG9sb2FkZXIvcHJpc20tYXV0b2xvYWRlciI7CmltcG9ydCAicHJpc21qcy9wbHVnaW5zL25vcm1hbGl6ZS13aGl0ZXNwYWNlL3ByaXNtLW5vcm1hbGl6ZS13aGl0ZXNwYWNlIjsKaW1wb3J0ICJwcmlzbWpzL3BsdWdpbnMvdG9vbGJhci9wcmlzbS10b29sYmFyLmNzcyI7CmltcG9ydCAicHJpc21qcy9wbHVnaW5zL3Rvb2xiYXIvcHJpc20tdG9vbGJhciI7CmltcG9ydCAicHJpc21qcy9wbHVnaW5zL2NvcHktdG8tY2xpcGJvYXJkL3ByaXNtLWNvcHktdG8tY2xpcGJvYXJkIjsKaW1wb3J0ICJwcmlzbWpzL3RoZW1lcy9wcmlzbS10d2lsaWdodC5jc3MiOwppbXBvcnQgbWVybWFpZCBmcm9tICdtZXJtYWlkJzsgLy8gSGVscGVycwoKaW1wb3J0IGthdGV4SGVscGVyIGZyb20gJy4vY29tbW9uL2thdGV4JzsKaW1wb3J0IHRhYnNldEhlbHBlciBmcm9tICcuL21hcmtkb3duL3RhYnNldCc7CmltcG9ydCBjbUZvbGQgZnJvbSAnLi9jb21tb24vY21Gb2xkJzsgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBJTklUCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gUGxhdGZvcm0gZGV0ZWN0aW9uCgpjb25zdCBDdHJsS2V5ID0gL01hYy8udGVzdChuYXZpZ2F0b3IucGxhdGZvcm0pID8gJ0NtZCcgOiAnQ3RybCc7IC8vIFByaXNtIENvbmZpZwoKUHJpc20ucGx1Z2lucy5hdXRvbG9hZGVyLmxhbmd1YWdlc19wYXRoID0gJy9fYXNzZXRzL2pzL3ByaXNtLyc7ClByaXNtLnBsdWdpbnMuTm9ybWFsaXplV2hpdGVzcGFjZS5zZXREZWZhdWx0cyh7CiAgJ3JlbW92ZS10cmFpbGluZyc6IHRydWUsCiAgJ3JlbW92ZS1pbmRlbnQnOiB0cnVlLAogICdsZWZ0LXRyaW0nOiB0cnVlLAogICdyaWdodC10cmltJzogdHJ1ZSwKICAncmVtb3ZlLWluaXRpYWwtbGluZS1mZWVkJzogdHJ1ZSwKICAndGFicy10by1zcGFjZXMnOiAyCn0pOyAvLyBNYXJrZG93biBJbnN0YW5jZQoKY29uc3QgbWQgPSBuZXcgTWFya2Rvd25JdCh7CiAgaHRtbDogdHJ1ZSwKICBicmVha3M6IHRydWUsCiAgbGlua2lmeTogdHJ1ZSwKICB0eXBvZ3JhcGh5OiB0cnVlLAoKICBoaWdobGlnaHQoc3RyLCBsYW5nKSB7CiAgICBpZiAobGFuZyA9PT0gJ2RpYWdyYW0nKSB7CiAgICAgIHJldHVybiBgPHByZSBjbGFzcz0iZGlhZ3JhbSI+YCArIEJ1ZmZlci5mcm9tKHN0ciwgJ2Jhc2U2NCcpLnRvU3RyaW5nKCkgKyBgPC9wcmU+YDsKICAgIH0gZWxzZSBpZiAoWydtZXJtYWlkJywgJ3BsYW50dW1sJ10uaW5jbHVkZXMobGFuZykpIHsKICAgICAgcmV0dXJuIGA8cHJlIGNsYXNzPSJjb2RlYmxvY2stJHtsYW5nfSI+PGNvZGU+JHtfZXNjYXBlKHN0cil9PC9jb2RlPjwvcHJlPmA7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gYDxwcmUgY2xhc3M9ImxpbmUtbnVtYmVycyI+PGNvZGUgY2xhc3M9Imxhbmd1YWdlLSR7bGFuZ30iPiR7X2VzY2FwZShzdHIpfTwvY29kZT48L3ByZT5gOwogICAgfQogIH0KCn0pLnVzZShtZEF0dHJzLCB7CiAgYWxsb3dlZEF0dHJpYnV0ZXM6IFsnaWQnLCAnY2xhc3MnLCAndGFyZ2V0J10KfSkudXNlKG1kRGVjb3JhdGUpLnVzZSh1bmRlcmxpbmUpLnVzZShtZEVtb2ppKS51c2UobWRUYXNrTGlzdHMsIHsKICBsYWJlbDogZmFsc2UsCiAgbGFiZWxBZnRlcjogZmFsc2UKfSkudXNlKG1kRXhwYW5kVGFicykudXNlKG1kQWJicikudXNlKG1kU3VwKS51c2UobWRTdWIpLnVzZShtZE11bHRpVGFibGUsIHsKICBtdWx0aWxpbmU6IHRydWUsCiAgcm93c3BhbjogdHJ1ZSwKICBoZWFkZXJsZXNzOiB0cnVlCn0pLnVzZShtZE1hcmspLnVzZShtZEZvb3Rub3RlKS51c2UobWRJbXNpemUpOyAvLyBET01QdXJpZnkgZml4IGZvciBkcmF3LmlvCgpET01QdXJpZnkuYWRkSG9vaygndXBvblNhbml0aXplRWxlbWVudCcsIGVsbSA9PiB7CiAgaWYgKGVsbS5xdWVyeVNlbGVjdG9yQWxsKSB7CiAgICBjb25zdCBicmVha3MgPSBlbG0ucXVlcnlTZWxlY3RvckFsbCgnZm9yZWlnbk9iamVjdCBiciwgZm9yZWlnbk9iamVjdCBwJyk7CgogICAgaWYgKGJyZWFrcyAmJiBicmVha3MubGVuZ3RoKSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYnJlYWtzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgYnJlYWtzW2ldLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpLCBicmVha3NbaV0pOwogICAgICB9CiAgICB9CiAgfQp9KTsgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBIRUxQRVIgRlVOQ1RJT05TCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gSW5qZWN0IGxpbmUgbnVtYmVycyBmb3IgcHJldmlldyBzY3JvbGwgc3luYwoKbGV0IGxpbmVzTWFwID0gW107CgpmdW5jdGlvbiBpbmplY3RMaW5lTnVtYmVycyh0b2tlbnMsIGlkeCwgb3B0aW9ucywgZW52LCBzbGYpIHsKICBsZXQgbGluZTsKCiAgaWYgKHRva2Vuc1tpZHhdLm1hcCAmJiB0b2tlbnNbaWR4XS5sZXZlbCA9PT0gMCkgewogICAgbGluZSA9IHRva2Vuc1tpZHhdLm1hcFswXTsKICAgIHRva2Vuc1tpZHhdLmF0dHJKb2luKCdjbGFzcycsICdsaW5lJyk7CiAgICB0b2tlbnNbaWR4XS5hdHRyU2V0KCdkYXRhLWxpbmUnLCBTdHJpbmcobGluZSkpOwogICAgbGluZXNNYXAucHVzaChsaW5lKTsKICB9CgogIHJldHVybiBzbGYucmVuZGVyVG9rZW4odG9rZW5zLCBpZHgsIG9wdGlvbnMsIGVudiwgc2xmKTsKfQoKbWQucmVuZGVyZXIucnVsZXMucGFyYWdyYXBoX29wZW4gPSBpbmplY3RMaW5lTnVtYmVyczsKbWQucmVuZGVyZXIucnVsZXMuaGVhZGluZ19vcGVuID0gaW5qZWN0TGluZU51bWJlcnM7Cm1kLnJlbmRlcmVyLnJ1bGVzLmJsb2NrcXVvdGVfb3BlbiA9IGluamVjdExpbmVOdW1iZXJzOwpjbUZvbGQucmVnaXN0ZXIoJ21hcmtkb3duJyk7IC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gUExBTlRVTUwKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBUT0RPOiBVc2Ugc2FtZSBvcHRpb25zIGFzIGRlZmluZWQgaW4gYmFja2VuZAoKcGxhbnR1bWwuaW5pdChtZCwge30pOyAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIEtBVEVYCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCmNvbnN0IG1hY3JvcyA9IHt9OwptZC5pbmxpbmUucnVsZXIuYWZ0ZXIoJ2VzY2FwZScsICdrYXRleF9pbmxpbmUnLCBrYXRleEhlbHBlci5rYXRleElubGluZSk7CgptZC5yZW5kZXJlci5ydWxlcy5rYXRleF9pbmxpbmUgPSAodG9rZW5zLCBpZHgpID0+IHsKICB0cnkgewogICAgcmV0dXJuIGthdGV4LnJlbmRlclRvU3RyaW5nKHRva2Vuc1tpZHhdLmNvbnRlbnQsIHsKICAgICAgZGlzcGxheU1vZGU6IGZhbHNlLAogICAgICBtYWNyb3MKICAgIH0pOwogIH0gY2F0Y2ggKGVycikgewogICAgY29uc29sZS53YXJuKGVycik7CiAgICByZXR1cm4gdG9rZW5zW2lkeF0uY29udGVudDsKICB9Cn07CgptZC5ibG9jay5ydWxlci5hZnRlcignYmxvY2txdW90ZScsICdrYXRleF9ibG9jaycsIGthdGV4SGVscGVyLmthdGV4QmxvY2ssIHsKICBhbHQ6IFsncGFyYWdyYXBoJywgJ3JlZmVyZW5jZScsICdibG9ja3F1b3RlJywgJ2xpc3QnXQp9KTsKCm1kLnJlbmRlcmVyLnJ1bGVzLmthdGV4X2Jsb2NrID0gKHRva2VucywgaWR4KSA9PiB7CiAgdHJ5IHsKICAgIHJldHVybiBgPHA+YCArIGthdGV4LnJlbmRlclRvU3RyaW5nKHRva2Vuc1tpZHhdLmNvbnRlbnQsIHsKICAgICAgZGlzcGxheU1vZGU6IHRydWUsCiAgICAgIG1hY3JvcwogICAgfSkgKyBgPC9wPmA7CiAgfSBjYXRjaCAoZXJyKSB7CiAgICBjb25zb2xlLndhcm4oZXJyKTsKICAgIHJldHVybiB0b2tlbnNbaWR4XS5jb250ZW50OwogIH0KfTsgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBUV0VNT0pJCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCgptZC5yZW5kZXJlci5ydWxlcy5lbW9qaSA9ICh0b2tlbiwgaWR4KSA9PiB7CiAgcmV0dXJuIHR3ZW1vamkucGFyc2UodG9rZW5baWR4XS5jb250ZW50LCB7CiAgICBjYWxsYmFjayhpY29uLCBvcHRzKSB7CiAgICAgIHJldHVybiBgL19hc3NldHMvc3ZnL3R3ZW1vamkvJHtpY29ufS5zdmdgOwogICAgfQoKICB9KTsKfTsgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBWdWUgQ29tcG9uZW50Ci8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCgpsZXQgbWVybWFpZElkID0gMDsKZXhwb3J0IGRlZmF1bHQgewogIGNvbXBvbmVudHM6IHsKICAgIG1hcmtkb3duSGVscAogIH0sCiAgcHJvcHM6IHsKICAgIHNhdmU6IHsKICAgICAgdHlwZTogRnVuY3Rpb24sCiAgICAgIGRlZmF1bHQ6ICgpID0+IHt9CiAgICB9CiAgfSwKCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGZhYkluc2VydE1lbnU6IGZhbHNlLAogICAgICBjbTogbnVsbCwKICAgICAgY3Vyc29yUG9zOiB7CiAgICAgICAgY2g6IDAsCiAgICAgICAgbGluZTogMQogICAgICB9LAogICAgICBwcmV2aWV3U2hvd246IHRydWUsCiAgICAgIHByZXZpZXdIVE1MOiAnJywKICAgICAgaGVscFNob3duOiBmYWxzZSwKICAgICAgc3BlbGxNb2RlQWN0aXZlOiBmYWxzZSwKICAgICAgaW5zZXJ0TGlua0RpYWxvZzogZmFsc2UKICAgIH07CiAgfSwKCiAgY29tcHV0ZWQ6IHsKICAgIGlzTW9iaWxlKCkgewogICAgICByZXR1cm4gdGhpcy4kdnVldGlmeS5icmVha3BvaW50LnNtQW5kRG93bjsKICAgIH0sCgogICAgaXNNb2RhbFNob3duKCkgewogICAgICByZXR1cm4gdGhpcy5oZWxwU2hvd24gfHwgdGhpcy5hY3RpdmVNb2RhbCAhPT0gJyc7CiAgICB9LAoKICAgIGxvY2FsZTogZ2V0KCdwYWdlL2xvY2FsZScpLAogICAgcGF0aDogZ2V0KCdwYWdlL3BhdGgnKSwKICAgIG1vZGU6IGdldCgnZWRpdG9yL21vZGUnKSwKICAgIGFjdGl2ZU1vZGFsOiBzeW5jKCdlZGl0b3IvYWN0aXZlTW9kYWwnKQogIH0sCiAgd2F0Y2g6IHsKICAgIHByZXZpZXdTaG93bihuZXdWYWx1ZSwgb2xkVmFsdWUpIHsKICAgICAgaWYgKG5ld1ZhbHVlICYmICFvbGRWYWx1ZSkgewogICAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsKICAgICAgICAgIHRoaXMucmVuZGVyTWVybWFpZERpYWdyYW1zKCk7CiAgICAgICAgICBQcmlzbS5oaWdobGlnaHRBbGxVbmRlcih0aGlzLiRyZWZzLmVkaXRvclByZXZpZXcpOwogICAgICAgICAgQXJyYXkuZnJvbSh0aGlzLiRyZWZzLmVkaXRvclByZXZpZXcucXVlcnlTZWxlY3RvckFsbCgncHJlLmxpbmUtbnVtYmVycycpKS5mb3JFYWNoKHByZSA9PiBwcmUuY2xhc3NMaXN0LmFkZCgncHJpc21qcycpKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKCiAgICBzcGVsbE1vZGVBY3RpdmUobmV3VmFsdWUsIG9sZFZhbHVlKSB7CiAgICAgIGlmIChuZXdWYWx1ZSkgewogICAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsKICAgICAgICAgIHRoaXMuJHJlZnMuZWRpdG9yUHJldmlldy5mb2N1cygpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9CgogIH0sCiAgbWV0aG9kczogewogICAgdG9nZ2xlTW9kYWwoa2V5KSB7CiAgICAgIHRoaXMuYWN0aXZlTW9kYWwgPSB0aGlzLmFjdGl2ZU1vZGFsID09PSBrZXkgPyAnJyA6IGtleTsKICAgICAgdGhpcy5oZWxwU2hvd24gPSBmYWxzZTsKICAgIH0sCgogICAgY2xvc2VBbGxNb2RhbCgpIHsKICAgICAgdGhpcy5hY3RpdmVNb2RhbCA9ICcnOwogICAgICB0aGlzLmhlbHBTaG93biA9IGZhbHNlOwogICAgfSwKCiAgICBvbkNtSW5wdXQ6IF9kZWJvdW5jZShmdW5jdGlvbiAobmV3Q29udGVudCkgewogICAgICB0aGlzLnByb2Nlc3NDb250ZW50KG5ld0NvbnRlbnQpOwogICAgfSwgNjAwKSwKCiAgICBvbkNtUGFzdGUoY20sIGV2KSB7Ly8gY29uc3QgY2xpcEl0ZW1zID0gKGV2LmNsaXBib2FyZERhdGEgfHwgZXYub3JpZ2luYWxFdmVudC5jbGlwYm9hcmREYXRhKS5pdGVtcwogICAgICAvLyBmb3IgKGxldCBjbGlwSXRlbSBvZiBjbGlwSXRlbXMpIHsKICAgICAgLy8gICBpZiAoXy5zdGFydHNXaXRoKGNsaXBJdGVtLnR5cGUsICdpbWFnZS8nKSkgewogICAgICAvLyAgICAgY29uc3QgZmlsZSA9IGNsaXBJdGVtLmdldEFzRmlsZSgpCiAgICAgIC8vICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpCiAgICAgIC8vICAgICByZWFkZXIub25sb2FkID0gZXZ0ID0+IHsKICAgICAgLy8gICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KGBsb2FkaW5nU3RhcnRgLCAnZWRpdG9yLXBhc3RlLWltYWdlJykKICAgICAgLy8gICAgICAgdGhpcy5pbnNlcnRBZnRlcih7CiAgICAgIC8vICAgICAgICAgY29udGVudDogYCFbJHtmaWxlLm5hbWV9XSgke2V2dC50YXJnZXQucmVzdWx0fSlgLAogICAgICAvLyAgICAgICAgIG5ld0xpbmU6IHRydWUKICAgICAgLy8gICAgICAgfSkKICAgICAgLy8gICAgIH0KICAgICAgLy8gICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpCiAgICAgIC8vICAgfQogICAgICAvLyB9CiAgICB9LAoKICAgIHByb2Nlc3NDb250ZW50KG5ld0NvbnRlbnQpIHsKICAgICAgbGluZXNNYXAgPSBbXTsgLy8gdGhpcy4kc3RvcmUuc2V0KCdlZGl0b3IvY29udGVudCcsIG5ld0NvbnRlbnQpCgogICAgICB0aGlzLnByb2Nlc3NNYXJrZXJzKHRoaXMuY20uZmlyc3RMaW5lKCksIHRoaXMuY20ubGFzdExpbmUoKSk7CiAgICAgIHRoaXMucHJldmlld0hUTUwgPSBET01QdXJpZnkuc2FuaXRpemUobWQucmVuZGVyKG5ld0NvbnRlbnQpLCB7CiAgICAgICAgQUREX1RBR1M6IFsnZm9yZWlnbk9iamVjdCddCiAgICAgIH0pOwogICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7CiAgICAgICAgdGFic2V0SGVscGVyLmZvcm1hdCgpOwogICAgICAgIHRoaXMucmVuZGVyTWVybWFpZERpYWdyYW1zKCk7CiAgICAgICAgUHJpc20uaGlnaGxpZ2h0QWxsVW5kZXIodGhpcy4kcmVmcy5lZGl0b3JQcmV2aWV3KTsKICAgICAgICBBcnJheS5mcm9tKHRoaXMuJHJlZnMuZWRpdG9yUHJldmlldy5xdWVyeVNlbGVjdG9yQWxsKCdwcmUubGluZS1udW1iZXJzJykpLmZvckVhY2gocHJlID0+IHByZS5jbGFzc0xpc3QuYWRkKCdwcmlzbWpzJykpOwogICAgICAgIHRoaXMuc2Nyb2xsU3luYyh0aGlzLmNtKTsKICAgICAgfSk7CiAgICB9LAoKICAgIC8qKgogICAgICogVXBkYXRlIGN1cnNvciBzdGF0ZQogICAgICovCiAgICBwb3NpdGlvblN5bmMoY20pIHsKICAgICAgdGhpcy5jdXJzb3JQb3MgPSBjbS5nZXRDdXJzb3IoJ2hlYWQnKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBXcmFwIHNlbGVjdGlvbiB3aXRoIHN0YXJ0IC8gZW5kIHRhZ3MKICAgICAqLwogICAgdG9nZ2xlTWFya3VwKHsKICAgICAgc3RhcnQsCiAgICAgIGVuZAogICAgfSkgewogICAgICBpZiAoIWVuZCkgewogICAgICAgIGVuZCA9IHN0YXJ0OwogICAgICB9CgogICAgICBpZiAoIXRoaXMuY20uZG9jLnNvbWV0aGluZ1NlbGVjdGVkKCkpIHsKICAgICAgICByZXR1cm4gdGhpcy4kc3RvcmUuY29tbWl0KCdzaG93Tm90aWZpY2F0aW9uJywgewogICAgICAgICAgbWVzc2FnZTogdGhpcy4kdCgnZWRpdG9yOm1hcmt1cC5ub1NlbGVjdGlvbkVycm9yJyksCiAgICAgICAgICBzdHlsZTogJ3dhcm5pbmcnLAogICAgICAgICAgaWNvbjogJ3dhcm5pbmcnCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHRoaXMuY20uZG9jLnJlcGxhY2VTZWxlY3Rpb25zKHRoaXMuY20uZG9jLmdldFNlbGVjdGlvbnMoKS5tYXAocyA9PiBzdGFydCArIHMgKyBlbmQpKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBTZXQgY3VycmVudCBsaW5lIGFzIGhlYWRlcgogICAgICovCiAgICBzZXRIZWFkZXJMaW5lKGx2bCkgewogICAgICBjb25zdCBjdXJMaW5lID0gdGhpcy5jbS5kb2MuZ2V0Q3Vyc29yKCdoZWFkJykubGluZTsKICAgICAgbGV0IGxpbmVDb250ZW50ID0gdGhpcy5jbS5kb2MuZ2V0TGluZShjdXJMaW5lKTsKICAgICAgY29uc3QgbGluZUxlbmd0aCA9IGxpbmVDb250ZW50Lmxlbmd0aDsKCiAgICAgIGlmIChfc3RhcnRzV2l0aChsaW5lQ29udGVudCwgJyMnKSkgewogICAgICAgIGxpbmVDb250ZW50ID0gbGluZUNvbnRlbnQucmVwbGFjZSgvXigjKyApLywgJycpOwogICAgICB9CgogICAgICBsaW5lQ29udGVudCA9IF90aW1lcyhsdmwsIG4gPT4gJyMnKS5qb2luKCcnKSArIGAgYCArIGxpbmVDb250ZW50OwogICAgICB0aGlzLmNtLmRvYy5yZXBsYWNlUmFuZ2UobGluZUNvbnRlbnQsIHsKICAgICAgICBsaW5lOiBjdXJMaW5lLAogICAgICAgIGNoOiAwCiAgICAgIH0sIHsKICAgICAgICBsaW5lOiBjdXJMaW5lLAogICAgICAgIGNoOiBsaW5lTGVuZ3RoCiAgICAgIH0pOwogICAgfSwKCiAgICAvKioKICAgICAqIEdldCB0aGUgaGVhZGVyIGxldmVyIG9mIHRoZSBjdXJyZW50IGxpbmUKICAgICAqLwogICAgZ2V0SGVhZGVyTGV2ZWwoY20pIHsKICAgICAgY29uc3QgY3VyTGluZSA9IHRoaXMuY20uZG9jLmdldEN1cnNvcignaGVhZCcpLmxpbmU7CiAgICAgIGxldCBsaW5lQ29udGVudCA9IHRoaXMuY20uZG9jLmdldExpbmUoY3VyTGluZSk7CiAgICAgIGxldCBsdmwgPSAwOwogICAgICBjb25zdCByZXN1bHQgPSBsaW5lQ29udGVudC5tYXRjaCgvXigjKykgLyk7CgogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgbHZsID0gX2dldChyZXN1bHQsICdbMV0nLCAnJykubGVuZ3RoOwogICAgICB9CgogICAgICByZXR1cm4gbHZsOwogICAgfSwKCiAgICAvKioKICAgICAqIEluc2VydCBjb250ZW50IGF0IGN1cnNvcgogICAgICovCiAgICBpbnNlcnRBdEN1cnNvcih7CiAgICAgIGNvbnRlbnQKICAgIH0pIHsKICAgICAgY29uc3QgY3Vyc29yID0gdGhpcy5jbS5kb2MuZ2V0Q3Vyc29yKCdoZWFkJyk7CiAgICAgIHRoaXMuY20uZG9jLnJlcGxhY2VSYW5nZShjb250ZW50LCBjdXJzb3IpOwogICAgfSwKCiAgICAvKioKICAgICAqIEluc2VydCBjb250ZW50IGFmdGVyIGN1cnJlbnQgbGluZQogICAgICovCiAgICBpbnNlcnRBZnRlcih7CiAgICAgIGNvbnRlbnQsCiAgICAgIG5ld0xpbmUKICAgIH0pIHsKICAgICAgY29uc3QgY3VyTGluZSA9IHRoaXMuY20uZG9jLmdldEN1cnNvcigndG8nKS5saW5lOwogICAgICBjb25zdCBsaW5lTGVuZ3RoID0gdGhpcy5jbS5kb2MuZ2V0TGluZShjdXJMaW5lKS5sZW5ndGg7CiAgICAgIHRoaXMuY20uZG9jLnJlcGxhY2VSYW5nZShuZXdMaW5lID8gYFxuJHtjb250ZW50fVxuYCA6IGNvbnRlbnQsIHsKICAgICAgICBsaW5lOiBjdXJMaW5lLAogICAgICAgIGNoOiBsaW5lTGVuZ3RoICsgMQogICAgICB9KTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBJbnNlcnQgY29udGVudCBiZWZvcmUgY3VycmVudCBsaW5lCiAgICAgKi8KICAgIGluc2VydEJlZm9yZUVhY2hMaW5lKHsKICAgICAgY29udGVudCwKICAgICAgYWZ0ZXIKICAgIH0pIHsKICAgICAgbGV0IGxpbmVzID0gW107CgogICAgICBpZiAoIXRoaXMuY20uZG9jLnNvbWV0aGluZ1NlbGVjdGVkKCkpIHsKICAgICAgICBsaW5lcy5wdXNoKHRoaXMuY20uZG9jLmdldEN1cnNvcignaGVhZCcpLmxpbmUpOwogICAgICB9IGVsc2UgewogICAgICAgIGxpbmVzID0gX2ZsYXR0ZW4odGhpcy5jbS5kb2MubGlzdFNlbGVjdGlvbnMoKS5tYXAoc2wgPT4gewogICAgICAgICAgY29uc3QgcmFuZ2UgPSBNYXRoLmFicyhzbC5hbmNob3IubGluZSAtIHNsLmhlYWQubGluZSkgKyAxOwogICAgICAgICAgY29uc3QgbG93ZXN0TGluZSA9IHNsLmFuY2hvci5saW5lID4gc2wuaGVhZC5saW5lID8gc2wuaGVhZC5saW5lIDogc2wuYW5jaG9yLmxpbmU7CiAgICAgICAgICByZXR1cm4gX3RpbWVzKHJhbmdlLCBsID0+IGwgKyBsb3dlc3RMaW5lKTsKICAgICAgICB9KSk7CiAgICAgIH0KCiAgICAgIGxpbmVzLmZvckVhY2gobG4gPT4gewogICAgICAgIGxldCBsaW5lQ29udGVudCA9IHRoaXMuY20uZG9jLmdldExpbmUobG4pOwogICAgICAgIGNvbnN0IGxpbmVMZW5ndGggPSBsaW5lQ29udGVudC5sZW5ndGg7CgogICAgICAgIGlmIChfc3RhcnRzV2l0aChsaW5lQ29udGVudCwgY29udGVudCkpIHsKICAgICAgICAgIGxpbmVDb250ZW50ID0gbGluZUNvbnRlbnQuc3Vic3RyaW5nKGNvbnRlbnQubGVuZ3RoKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuY20uZG9jLnJlcGxhY2VSYW5nZShjb250ZW50ICsgbGluZUNvbnRlbnQsIHsKICAgICAgICAgIGxpbmU6IGxuLAogICAgICAgICAgY2g6IDAKICAgICAgICB9LCB7CiAgICAgICAgICBsaW5lOiBsbiwKICAgICAgICAgIGNoOiBsaW5lTGVuZ3RoCiAgICAgICAgfSk7CiAgICAgIH0pOwoKICAgICAgaWYgKGFmdGVyKSB7CiAgICAgICAgY29uc3QgbGFzdExpbmUgPSBfbGFzdChsaW5lcyk7CgogICAgICAgIHRoaXMuY20uZG9jLnJlcGxhY2VSYW5nZShgXG4ke2FmdGVyfVxuYCwgewogICAgICAgICAgbGluZTogbGFzdExpbmUsCiAgICAgICAgICBjaDogdGhpcy5jbS5kb2MuZ2V0TGluZShsYXN0TGluZSkubGVuZ3RoICsgMQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogVXBkYXRlIHNjcm9sbCBzeW5jCiAgICAgKi8KICAgIHNjcm9sbFN5bmM6IF9kZWJvdW5jZShmdW5jdGlvbiAoY20pIHsKICAgICAgaWYgKCF0aGlzLnByZXZpZXdTaG93biB8fCBjbS5zb21ldGhpbmdTZWxlY3RlZCgpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBsZXQgY3VycmVudExpbmUgPSBjbS5nZXRDdXJzb3IoKS5saW5lOwoKICAgICAgaWYgKGN1cnJlbnRMaW5lIDwgMykgewogICAgICAgIHRoaXMuVmVsb2NpdHkodGhpcy4kcmVmcy5lZGl0b3JQcmV2aWV3LCAnc3RvcCcsIHRydWUpOwogICAgICAgIHRoaXMuVmVsb2NpdHkodGhpcy4kcmVmcy5lZGl0b3JQcmV2aWV3LmZpcnN0Q2hpbGQsICdzY3JvbGwnLCB7CiAgICAgICAgICBvZmZzZXQ6ICctNTAnLAogICAgICAgICAgZHVyYXRpb246IDEwMDAsCiAgICAgICAgICBjb250YWluZXI6IHRoaXMuJHJlZnMuZWRpdG9yUHJldmlld0NvbnRhaW5lcgogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIGxldCBjbG9zZXN0TGluZSA9IF9maW5kTGFzdChsaW5lc01hcCwgbiA9PiBuIDw9IGN1cnJlbnRMaW5lKTsKCiAgICAgICAgbGV0IGRlc3RFbG0gPSB0aGlzLiRyZWZzLmVkaXRvclByZXZpZXcucXVlcnlTZWxlY3RvcihgW2RhdGEtbGluZT0nJHtjbG9zZXN0TGluZX0nXWApOwoKICAgICAgICBpZiAoZGVzdEVsbSkgewogICAgICAgICAgdGhpcy5WZWxvY2l0eSh0aGlzLiRyZWZzLmVkaXRvclByZXZpZXcsICdzdG9wJywgdHJ1ZSk7CiAgICAgICAgICB0aGlzLlZlbG9jaXR5KGRlc3RFbG0sICdzY3JvbGwnLCB7CiAgICAgICAgICAgIG9mZnNldDogJy0xMDAnLAogICAgICAgICAgICBkdXJhdGlvbjogMTAwMCwKICAgICAgICAgICAgY29udGFpbmVyOiB0aGlzLiRyZWZzLmVkaXRvclByZXZpZXdDb250YWluZXIKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfSwgNTAwKSwKCiAgICB0b2dnbGVIZWxwKCkgewogICAgICB0aGlzLmhlbHBTaG93biA9ICF0aGlzLmhlbHBTaG93bjsKICAgICAgdGhpcy5hY3RpdmVNb2RhbCA9ICcnOwogICAgfSwKCiAgICB0b2dnbGVGdWxsc2NyZWVuKCkgewogICAgICB0aGlzLmNtLnNldE9wdGlvbignZnVsbFNjcmVlbicsIHRydWUpOwogICAgfSwKCiAgICByZWZyZXNoKCkgewogICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7CiAgICAgICAgdGhpcy5jbS5yZWZyZXNoKCk7CiAgICAgIH0pOwogICAgfSwKCiAgICByZW5kZXJNZXJtYWlkRGlhZ3JhbXMoKSB7CiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5lZGl0b3ItbWFya2Rvd24tcHJldmlldyBwcmUuY29kZWJsb2NrLW1lcm1haWQgPiBjb2RlJykuZm9yRWFjaChlbG0gPT4gewogICAgICAgIG1lcm1haWRJZCsrOwogICAgICAgIGNvbnN0IG1lcm1haWREZWYgPSBlbG0uaW5uZXJUZXh0OwogICAgICAgIGNvbnN0IG1tRWxtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgbW1FbG0uaW5uZXJIVE1MID0gYDxkaXYgaWQ9Im1lcm1haWQtaWQtJHttZXJtYWlkSWR9Ij4ke21lcm1haWQucmVuZGVyKGBtZXJtYWlkLWlkLSR7bWVybWFpZElkfWAsIG1lcm1haWREZWYpfTwvZGl2PmA7CiAgICAgICAgZWxtLnBhcmVudEVsZW1lbnQucmVwbGFjZVdpdGgobW1FbG0pOwogICAgICB9KTsKICAgIH0sCgogICAgYXV0b2NvbXBsZXRlKGNtLCBjaGFuZ2UpIHsKICAgICAgaWYgKGNtLmdldE1vZGVBdChjbS5nZXRDdXJzb3IoKSkubmFtZSAhPT0gJ21hcmtkb3duJykgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBMaW5rcwoKCiAgICAgIGlmIChjaGFuZ2UudGV4dFswXSA9PT0gJygnKSB7CiAgICAgICAgY29uc3QgY3VyTGluZSA9IGNtLmdldExpbmUoY2hhbmdlLmZyb20ubGluZSkuc3Vic3RyaW5nKDAsIGNoYW5nZS5mcm9tLmNoKTsKCiAgICAgICAgaWYgKGN1ckxpbmVbY3VyTGluZS5sZW5ndGggLSAxXSA9PT0gJ10nKSB7CiAgICAgICAgICBjbS5zaG93SGludCh7CiAgICAgICAgICAgIGhpbnQ6IGFzeW5jIChjbSwgb3B0aW9ucykgPT4gewogICAgICAgICAgICAgIGNvbnN0IGN1ciA9IGNtLmdldEN1cnNvcigpOwogICAgICAgICAgICAgIGNvbnN0IGN1ckxpbmUgPSBjbS5nZXRMaW5lKGN1ci5saW5lKS5zdWJzdHJpbmcoMCwgY3VyLmNoKTsKICAgICAgICAgICAgICBjb25zdCBxdWVyeVN0cmluZyA9IGN1ckxpbmUuc3Vic3RyaW5nKGN1ckxpbmUubGFzdEluZGV4T2YoJ1snKSArIDEsIGN1ckxpbmUubGVuZ3RoIC0gMik7CiAgICAgICAgICAgICAgY29uc3QgdG9rZW4gPSBjbS5nZXRUb2tlbkF0KGN1cik7CgogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb25zdCByZXNwUmF3ID0gYXdhaXQgdGhpcy4kYXBvbGxvLnF1ZXJ5KHsKICAgICAgICAgICAgICAgICAgcXVlcnk6IHsKICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJEb2N1bWVudCIsCiAgICAgICAgICAgICAgICAgICAgImRlZmluaXRpb25zIjogW3sKICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk9wZXJhdGlvbkRlZmluaXRpb24iLAogICAgICAgICAgICAgICAgICAgICAgIm9wZXJhdGlvbiI6ICJxdWVyeSIsCiAgICAgICAgICAgICAgICAgICAgICAidmFyaWFibGVEZWZpbml0aW9ucyI6IFt7CiAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIlZhcmlhYmxlRGVmaW5pdGlvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgICJ2YXJpYWJsZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJWYXJpYWJsZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICJxdWVyeSIKICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICJ0eXBlIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5vbk51bGxUeXBlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAidHlwZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5hbWVkVHlwZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiTmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAiZGlyZWN0aXZlcyI6IFtdCiAgICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIlZhcmlhYmxlRGVmaW5pdGlvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgICJ2YXJpYWJsZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJWYXJpYWJsZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICJsb2NhbGUiCiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAidHlwZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lZFR5cGUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICJuYW1lIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiTmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgImRpcmVjdGl2ZXMiOiBbXQogICAgICAgICAgICAgICAgICAgICAgfV0sCiAgICAgICAgICAgICAgICAgICAgICAiZGlyZWN0aXZlcyI6IFtdLAogICAgICAgICAgICAgICAgICAgICAgInNlbGVjdGlvblNldCI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiU2VsZWN0aW9uU2V0IiwKICAgICAgICAgICAgICAgICAgICAgICAgInNlbGVjdGlvbnMiOiBbewogICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIkZpZWxkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogInBhZ2VzIgogICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgImFyZ3VtZW50cyI6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICJkaXJlY3RpdmVzIjogW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgInNlbGVjdGlvblNldCI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIlNlbGVjdGlvblNldCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAic2VsZWN0aW9ucyI6IFt7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIkZpZWxkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiTmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogInNlYXJjaCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImFyZ3VtZW50cyI6IFt7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiQXJndW1lbnQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJuYW1lIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiTmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAicXVlcnkiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJWYXJpYWJsZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiTmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICJxdWVyeSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJBcmd1bWVudCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICJsb2NhbGUiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJWYXJpYWJsZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiTmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICJsb2NhbGUiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImRpcmVjdGl2ZXMiOiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInNlbGVjdGlvblNldCI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJTZWxlY3Rpb25TZXQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzZWxlY3Rpb25zIjogW3sKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIkZpZWxkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJuYW1lIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogInJlc3VsdHMiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImFyZ3VtZW50cyI6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImRpcmVjdGl2ZXMiOiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzZWxlY3Rpb25TZXQiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIlNlbGVjdGlvblNldCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzZWxlY3Rpb25zIjogW3sKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJGaWVsZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICJ0aXRsZSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJhcmd1bWVudHMiOiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZGlyZWN0aXZlcyI6IFtdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJGaWVsZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICJwYXRoIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImFyZ3VtZW50cyI6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJkaXJlY3RpdmVzIjogW10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIkZpZWxkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogImxvY2FsZSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJhcmd1bWVudHMiOiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZGlyZWN0aXZlcyI6IFtdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1dCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiRmllbGQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAidG90YWxIaXRzIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJhcmd1bWVudHMiOiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJkaXJlY3RpdmVzIjogW10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9XSwKICAgICAgICAgICAgICAgICAgICAibG9jIjogewogICAgICAgICAgICAgICAgICAgICAgInN0YXJ0IjogMCwKICAgICAgICAgICAgICAgICAgICAgICJlbmQiOiA0NDksCiAgICAgICAgICAgICAgICAgICAgICAic291cmNlIjogewogICAgICAgICAgICAgICAgICAgICAgICAiYm9keSI6ICJcbiAgICAgICAgICAgICAgICAgICAgcXVlcnkgKCRxdWVyeTogU3RyaW5nISwgJGxvY2FsZTogU3RyaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgcGFnZXMge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoKHF1ZXJ5OiRxdWVyeSwgbG9jYWxlOiRsb2NhbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0cyB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxlXG4gICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxIaXRzXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAiLAogICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICJHcmFwaFFMIHJlcXVlc3QiLAogICAgICAgICAgICAgICAgICAgICAgICAibG9jYXRpb25PZmZzZXQiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgImxpbmUiOiAxLAogICAgICAgICAgICAgICAgICAgICAgICAgICJjb2x1bW4iOiAxCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIHZhcmlhYmxlczogewogICAgICAgICAgICAgICAgICAgIHF1ZXJ5OiBxdWVyeVN0cmluZywKICAgICAgICAgICAgICAgICAgICBsb2NhbGU6IHRoaXMubG9jYWxlCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIGZldGNoUG9saWN5OiAnY2FjaGUtZmlyc3QnCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBjb25zdCByZXNwID0gX2dldChyZXNwUmF3LCAnZGF0YS5wYWdlcy5zZWFyY2gnLCB7fSk7CgogICAgICAgICAgICAgICAgaWYgKHJlc3AgJiYgcmVzcC50b3RhbEhpdHMgPiAwKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgbGlzdDogcmVzcC5yZXN1bHRzLm1hcChyID0+ICh7CiAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnKCcgKyAoc2l0ZUxhbmdzLmxlbmd0aCA+IDAgPyBgLyR7ci5sb2NhbGV9LyR7ci5wYXRofWAgOiBgLyR7ci5wYXRofWApICsgJyknLAogICAgICAgICAgICAgICAgICAgICAgZGlzcGxheVRleHQ6IHNpdGVMYW5ncy5sZW5ndGggPiAwID8gYC8ke3IubG9jYWxlfS8ke3IucGF0aH0gLSAke3IudGl0bGV9YCA6IGAvJHtyLnBhdGh9IC0gJHtyLnRpdGxlfWAKICAgICAgICAgICAgICAgICAgICB9KSksCiAgICAgICAgICAgICAgICAgICAgZnJvbTogQ29kZU1pcnJvci5Qb3MoY3VyLmxpbmUsIHRva2VuLnN0YXJ0KSwKICAgICAgICAgICAgICAgICAgICB0bzogQ29kZU1pcnJvci5Qb3MoY3VyLmxpbmUsIHRva2VuLmVuZCkKICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHt9CgogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBsaXN0OiBbXSwKICAgICAgICAgICAgICAgIGZyb206IENvZGVNaXJyb3IuUG9zKGN1ci5saW5lLCB0b2tlbi5zdGFydCksCiAgICAgICAgICAgICAgICB0bzogQ29kZU1pcnJvci5Qb3MoY3VyLmxpbmUsIHRva2VuLmVuZCkKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCgogICAgaW5zZXJ0TGluaygpIHsKICAgICAgdGhpcy5pbnNlcnRMaW5rRGlhbG9nID0gdHJ1ZTsKICAgIH0sCgogICAgaW5zZXJ0TGlua0hhbmRsZXIoewogICAgICBsb2NhbGUsCiAgICAgIHBhdGgKICAgIH0pIHsKICAgICAgY29uc3QgbGFzdFBhcnQgPSBfbGFzdChwYXRoLnNwbGl0KCcvJykpOwoKICAgICAgdGhpcy5pbnNlcnRBdEN1cnNvcih7CiAgICAgICAgY29udGVudDogc2l0ZUxhbmdzLmxlbmd0aCA+IDAgPyBgWyR7bGFzdFBhcnR9XSgvJHtsb2NhbGV9LyR7cGF0aH0pYCA6IGBbJHtsYXN0UGFydH1dKC8ke3BhdGh9KWAKICAgICAgfSk7CiAgICB9LAoKICAgIHByb2Nlc3NNYXJrZXJzKGZyb20sIHRvKSB7CiAgICAgIGxldCBmb3VuZCA9IG51bGw7CiAgICAgIGxldCBmb3VuZFN0YXJ0ID0gMDsKICAgICAgdGhpcy5jbS5kb2MuZ2V0QWxsTWFya3MoKS5mb3JFYWNoKG1rID0+IHsKICAgICAgICBpZiAobWsuX19raW5kKSB7CiAgICAgICAgICBtay5jbGVhcigpOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHRoaXMuY20uZWFjaExpbmUoZnJvbSwgdG8sIGxuID0+IHsKICAgICAgICBjb25zdCBsaW5lID0gbG4ubGluZU5vKCk7CgogICAgICAgIGlmIChsbi50ZXh0LnN0YXJ0c1dpdGgoJ2BgYGRpYWdyYW0nKSkgewogICAgICAgICAgZm91bmQgPSAnZGlhZ3JhbSc7CiAgICAgICAgICBmb3VuZFN0YXJ0ID0gbGluZTsKICAgICAgICB9IGVsc2UgaWYgKGxuLnRleHQgPT09ICdgYGAnICYmIGZvdW5kKSB7CiAgICAgICAgICBzd2l0Y2ggKGZvdW5kKSB7CiAgICAgICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgICAgICAvLyAtPiBESUFHUkFNCiAgICAgICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgICAgICBjYXNlICdkaWFncmFtJzoKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAobGluZSAtIGZvdW5kU3RhcnQgIT09IDIpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMuYWRkTWFya2VyKHsKICAgICAgICAgICAgICAgICAga2luZDogJ2RpYWdyYW0nLAogICAgICAgICAgICAgICAgICBmcm9tOiB7CiAgICAgICAgICAgICAgICAgICAgbGluZTogZm91bmRTdGFydCwKICAgICAgICAgICAgICAgICAgICBjaDogMwogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICB0bzogewogICAgICAgICAgICAgICAgICAgIGxpbmU6IGZvdW5kU3RhcnQsCiAgICAgICAgICAgICAgICAgICAgY2g6IDEwCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIHRleHQ6ICdFZGl0IERpYWdyYW0nLAogICAgICAgICAgICAgICAgICBhY3Rpb246ICgoc3RhcnQsIGVuZCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJldHVybiBldiA9PiB7CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNtLmRvYy5zZXRTZWxlY3Rpb24oewogICAgICAgICAgICAgICAgICAgICAgICBsaW5lOiBzdGFydCwKICAgICAgICAgICAgICAgICAgICAgICAgY2g6IDAKICAgICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGluZTogZW5kLAogICAgICAgICAgICAgICAgICAgICAgICBjaDogMwogICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmF3ID0gdGhpcy5jbS5kb2MuZ2V0TGluZShlbmQgLSAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kc3RvcmUuc2V0KCdlZGl0b3IvYWN0aXZlTW9kYWxEYXRhJywgQnVmZmVyLmZyb20ocmF3LCAnYmFzZTY0JykudG9TdHJpbmcoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudG9nZ2xlTW9kYWwoYGVkaXRvck1vZGFsRHJhd2lvYCk7CiAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLmNvbW1pdCgnc2hvd05vdGlmaWNhdGlvbicsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIHByb2Nlc3MgZGlhZ3JhbSBkYXRhLicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU6ICd3YXJuaW5nJywKICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uOiAnd2FybmluZycKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgfSkoZm91bmRTdGFydCwgbGluZSkKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmIChsbi5oZWlnaHQgPiAwKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuY20uZm9sZENvZGUoZm91bmRTdGFydCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGZvdW5kID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKCiAgICBhZGRNYXJrZXIoewogICAgICBraW5kLAogICAgICBmcm9tLAogICAgICB0bywKICAgICAgdGV4dCwKICAgICAgYWN0aW9uCiAgICB9KSB7CiAgICAgIGNvbnN0IG1hcmtlckVsbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTsKICAgICAgbWFya2VyRWxtLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHRleHQpKTsKICAgICAgbWFya2VyRWxtLmNsYXNzTmFtZSA9ICdDb2RlTWlycm9yLWJ1dHRvbm1hcmtlcic7CiAgICAgIG1hcmtlckVsbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFjdGlvbik7CiAgICAgIHRoaXMuY20ubWFya1RleHQoZnJvbSwgdG8sIHsKICAgICAgICByZXBsYWNlZFdpdGg6IG1hcmtlckVsbSwKICAgICAgICBfX2tpbmQ6IGtpbmQKICAgICAgfSk7CiAgICB9CgogIH0sCgogIG1vdW50ZWQoKSB7CiAgICB0aGlzLiRzdG9yZS5zZXQoJ2VkaXRvci9lZGl0b3JLZXknLCAnbWFya2Rvd24nKTsKCiAgICBpZiAodGhpcy5tb2RlID09PSAnY3JlYXRlJyAmJiAhdGhpcy4kc3RvcmUuZ2V0KCdlZGl0b3IvY29udGVudCcpKSB7CiAgICAgIHRoaXMuJHN0b3JlLnNldCgnZWRpdG9yL2NvbnRlbnQnLCAnIyBIZWFkZXJcbllvdXIgY29udGVudCBoZXJlJyk7CiAgICB9IC8vIEluaXRpYWxpemUgTWVybWFpZCBBUEkKCgogICAgbWVybWFpZC5pbml0aWFsaXplKHsKICAgICAgc3RhcnRPbkxvYWQ6IGZhbHNlLAogICAgICB0aGVtZTogdGhpcy4kdnVldGlmeS50aGVtZS5kYXJrID8gYGRhcmtgIDogYGRlZmF1bHRgCiAgICB9KTsgLy8gSW5pdGlhbGl6ZSBDb2RlTWlycm9yCgogICAgdGhpcy5jbSA9IENvZGVNaXJyb3IuZnJvbVRleHRBcmVhKHRoaXMuJHJlZnMuY20sIHsKICAgICAgdGFiU2l6ZTogMiwKICAgICAgbW9kZTogJ3RleHQvbWFya2Rvd24nLAogICAgICB0aGVtZTogJ3dpa2lqcy1kYXJrJywKICAgICAgbGluZU51bWJlcnM6IHRydWUsCiAgICAgIGxpbmVXcmFwcGluZzogdHJ1ZSwKICAgICAgbGluZTogdHJ1ZSwKICAgICAgc3R5bGVBY3RpdmVMaW5lOiB0cnVlLAogICAgICBoaWdobGlnaHRTZWxlY3Rpb25NYXRjaGVzOiB7CiAgICAgICAgYW5ub3RhdGVTY3JvbGxiYXI6IHRydWUKICAgICAgfSwKICAgICAgdmlld3BvcnRNYXJnaW46IDUwLAogICAgICBpbnB1dFN0eWxlOiAnY29udGVudGVkaXRhYmxlJywKICAgICAgYWxsb3dEcm9wRmlsZVR5cGVzOiBbJ2ltYWdlL2pwZycsICdpbWFnZS9wbmcnLCAnaW1hZ2Uvc3ZnJywgJ2ltYWdlL2pwZWcnLCAnaW1hZ2UvZ2lmJ10sCiAgICAgIGRpcmVjdGlvbjogc2l0ZUNvbmZpZy5ydGwgPyAncnRsJyA6ICdsdHInLAogICAgICBmb2xkR3V0dGVyOiB0cnVlLAogICAgICBndXR0ZXJzOiBbJ0NvZGVNaXJyb3ItbGluZW51bWJlcnMnLCAnQ29kZU1pcnJvci1mb2xkZ3V0dGVyJ10KICAgIH0pOwogICAgdGhpcy5jbS5zZXRWYWx1ZSh0aGlzLiRzdG9yZS5nZXQoJ2VkaXRvci9jb250ZW50JykpOwogICAgdGhpcy5jbS5vbignY2hhbmdlJywgYyA9PiB7CiAgICAgIHRoaXMuJHN0b3JlLnNldCgnZWRpdG9yL2NvbnRlbnQnLCBjLmdldFZhbHVlKCkpOwogICAgICB0aGlzLm9uQ21JbnB1dCh0aGlzLiRzdG9yZS5nZXQoJ2VkaXRvci9jb250ZW50JykpOwogICAgfSk7CgogICAgaWYgKHRoaXMuJHZ1ZXRpZnkuYnJlYWtwb2ludC5tZEFuZFVwKSB7CiAgICAgIHRoaXMuY20uc2V0U2l6ZShudWxsLCAnY2FsYygxMDB2aCAtIDExMnB4IC0gMjRweCknKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuY20uc2V0U2l6ZShudWxsLCAnY2FsYygxMDB2aCAtIDExMnB4IC0gMTZweCknKTsKICAgIH0gLy8gU2V0IEtleWJpbmRpbmdzCgoKICAgIGNvbnN0IGtleUJpbmRpbmdzID0gewogICAgICAnRjExJyhjKSB7CiAgICAgICAgYy5zZXRPcHRpb24oJ2Z1bGxTY3JlZW4nLCAhYy5nZXRPcHRpb24oJ2Z1bGxTY3JlZW4nKSk7CiAgICAgIH0sCgogICAgICAnRXNjJyhjKSB7CiAgICAgICAgaWYgKGMuZ2V0T3B0aW9uKCdmdWxsU2NyZWVuJykpIGMuc2V0T3B0aW9uKCdmdWxsU2NyZWVuJywgZmFsc2UpOwogICAgICB9CgogICAgfTsKCiAgICBfc2V0KGtleUJpbmRpbmdzLCBgJHtDdHJsS2V5fS1TYCwgYyA9PiB7CiAgICAgIHRoaXMuc2F2ZSgpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9KTsKCiAgICBfc2V0KGtleUJpbmRpbmdzLCBgJHtDdHJsS2V5fS1CYCwgYyA9PiB7CiAgICAgIHRoaXMudG9nZ2xlTWFya3VwKHsKICAgICAgICBzdGFydDogYCoqYAogICAgICB9KTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSk7CgogICAgX3NldChrZXlCaW5kaW5ncywgYCR7Q3RybEtleX0tSWAsIGMgPT4gewogICAgICB0aGlzLnRvZ2dsZU1hcmt1cCh7CiAgICAgICAgc3RhcnQ6IGAqYAogICAgICB9KTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSk7CgogICAgX3NldChrZXlCaW5kaW5ncywgYCR7Q3RybEtleX0tQWx0LVJpZ2h0YCwgYyA9PiB7CiAgICAgIGxldCBsdmwgPSB0aGlzLmdldEhlYWRlckxldmVsKGMpOwoKICAgICAgaWYgKGx2bCA+PSA2KSB7CiAgICAgICAgbHZsID0gNTsKICAgICAgfQoKICAgICAgdGhpcy5zZXRIZWFkZXJMaW5lKGx2bCArIDEpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9KTsKCiAgICBfc2V0KGtleUJpbmRpbmdzLCBgJHtDdHJsS2V5fS1BbHQtTGVmdGAsIGMgPT4gewogICAgICBsZXQgbHZsID0gdGhpcy5nZXRIZWFkZXJMZXZlbChjKTsKCiAgICAgIGlmIChsdmwgPD0gMSkgewogICAgICAgIGx2bCA9IDI7CiAgICAgIH0KCiAgICAgIHRoaXMuc2V0SGVhZGVyTGluZShsdmwgLSAxKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSk7CgogICAgdGhpcy5jbS5zZXRPcHRpb24oJ2V4dHJhS2V5cycsIGtleUJpbmRpbmdzKTsKICAgIHRoaXMuY20ub24oJ2lucHV0UmVhZCcsIHRoaXMuYXV0b2NvbXBsZXRlKTsgLy8gSGFuZGxlIGN1cnNvciBtb3ZlbWVudAoKICAgIHRoaXMuY20ub24oJ2N1cnNvckFjdGl2aXR5JywgYyA9PiB7CiAgICAgIHRoaXMucG9zaXRpb25TeW5jKGMpOwogICAgICB0aGlzLnNjcm9sbFN5bmMoYyk7CiAgICB9KTsgLy8gSGFuZGxlIHNwZWNpYWwgcGFzdGUKCiAgICB0aGlzLmNtLm9uKCdwYXN0ZScsIHRoaXMub25DbVBhc3RlKTsgLy8gUmVuZGVyIGluaXRpYWwgcHJldmlldwoKICAgIHRoaXMucHJvY2Vzc0NvbnRlbnQodGhpcy4kc3RvcmUuZ2V0KCdlZGl0b3IvY29udGVudCcpKTsKICAgIHRoaXMucmVmcmVzaCgpOwogICAgdGhpcy4kcm9vdC4kb24oJ2VkaXRvckluc2VydCcsIG9wdHMgPT4gewogICAgICBzd2l0Y2ggKG9wdHMua2luZCkgewogICAgICAgIGNhc2UgJ0lNQUdFJzoKICAgICAgICAgIGxldCBpbWcgPSBgIVske29wdHMudGV4dH1dKCR7b3B0cy5wYXRofSlgOwoKICAgICAgICAgIGlmIChvcHRzLmFsaWduICYmIG9wdHMuYWxpZ24gIT09ICcnKSB7CiAgICAgICAgICAgIGltZyArPSBgey5hbGlnbi0ke29wdHMuYWxpZ259fWA7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5pbnNlcnRBdEN1cnNvcih7CiAgICAgICAgICAgIGNvbnRlbnQ6IGltZwogICAgICAgICAgfSk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAnQklOQVJZJzoKICAgICAgICAgIHRoaXMuaW5zZXJ0QXRDdXJzb3IoewogICAgICAgICAgICBjb250ZW50OiBgWyR7b3B0cy50ZXh0fV0oJHtvcHRzLnBhdGh9KWAKICAgICAgICAgIH0pOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgJ0RJQUdSQU0nOgogICAgICAgICAgY29uc3Qgc2VsU3RhcnRMaW5lID0gdGhpcy5jbS5nZXRDdXJzb3IoJ2Zyb20nKS5saW5lOwogICAgICAgICAgY29uc3Qgc2VsRW5kTGluZSA9IHRoaXMuY20uZ2V0Q3Vyc29yKCd0bycpLmxpbmUgKyAxOwogICAgICAgICAgdGhpcy5jbS5kb2MucmVwbGFjZVNlbGVjdGlvbignYGBgZGlhZ3JhbVxuJyArIG9wdHMudGV4dCArICdcbmBgYFxuJywgJ3N0YXJ0Jyk7CiAgICAgICAgICB0aGlzLnByb2Nlc3NNYXJrZXJzKHNlbFN0YXJ0TGluZSwgc2VsRW5kTGluZSk7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfSk7IC8vIEhhbmRsZSBzYXZlIGNvbmZsaWN0CgogICAgdGhpcy4kcm9vdC4kb24oJ3NhdmVDb25mbGljdCcsICgpID0+IHsKICAgICAgdGhpcy50b2dnbGVNb2RhbChgZWRpdG9yTW9kYWxDb25mbGljdGApOwogICAgfSk7CiAgICB0aGlzLiRyb290LiRvbignb3ZlcndyaXRlRWRpdG9yQ29udGVudCcsICgpID0+IHsKICAgICAgdGhpcy5jbS5zZXRWYWx1ZSh0aGlzLiRzdG9yZS5nZXQoJ2VkaXRvci9jb250ZW50JykpOwogICAgfSk7CiAgfSwKCiAgYmVmb3JlRGVzdHJveSgpIHsKICAgIHRoaXMuJHJvb3QuJG9mZignZWRpdG9ySW5zZXJ0Jyk7CiAgfQoKfTs="},null]}